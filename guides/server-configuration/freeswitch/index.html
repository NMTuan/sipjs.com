<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta http-equiv="imagetoolbar" content="false" />
  <meta name="MSSmartTagsPreventParsing" content="true" />
  <meta name="description" content="Easily install & configure FreeSWITCH with letsencrypt to work with SIP.js" />
  <meta name="viewport" content="initial-scale=1" />
  <title>Install & Configure FreeSWITCH | SIP.js</title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="/changes.atom" />
  <link href='//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round' rel='stylesheet' type='text/css'>
  <link href="/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css" />
    
  <link href="/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css" />
  
  <script src="/shared/js/jquery.js" type="text/javascript"></script>
  <script src="/shared/js/documentation.js" type="text/javascript"></script>
  <link rel="shortcut icon" type="image/x-icon" href="/shared/img/favicon-7.ico"/>
</head>


<body class="guides">
  <div id="dev"></div>
<header id="siteHeader">
  <div class="wrapper">
    <nav id="mainNav">
      <a id="logo-link" href="/"><img id="logo" src="/shared/img/logo.png" alt="sip.js"></a>
      <ul id="full-nav" class="horizontal mobile-hide">
        <li><a href="https://github.com/onsip/SIP.js/releases">Download</a></li>
        <li><a id="api-nav" href="https://github.com/onsip/SIP.js/blob/master/docs/README.md">API</a></li>
        <li><a href="/guides/">Guides</a></li>
        <li><a href="https://github.com/onsip/sip.js" target="_blank">Github</a></li>
        <li><a href="/aboutus/" class="nav-aboutus">About Us</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/sip_js" target="_blank">Support</a></li>
        <li><a href="/faq/">FAQ</a></li>
      </ul>
    </nav>
  </div>
</header>


  <article id="main" class="wrapper group">
    <header id="sectionHeader">
      <h1><a href="/guides/">Guides</a></h1>
    </header>
    <div id="content">
      
<h1 id="configure-freeswitch">Configure FreeSWITCH</h1>

<p>SIP.js has been tested with <a href="https://freeswitch.org/confluence/display/FREESWITCH/CentOS+7+and+RHEL+7">FreeSWITCH 1.6.14</a> without any modification to the source code of SIP.js or FreeSWITCH. Later versions of FreeSWITCH will require similar configuration. Letsencrypt is required for wss.</p>

<h2 id="system-setup">System Setup</h2>

<p>FreeSWITCH and SIP.js were tested using the following setup:</p>

<ul>
  <li><a href="http://isoredirect.centos.org/centos/7/isos/x86_64/">CentOS 7.2 minimal (x86_64)</a></li>
  <li><a href="https://freeswitch.org/confluence/display/FREESWITCH/CentOS+7+and+RHEL+7#CentOS7andRHEL7-CentOS7andRHEL7-Stable">FreeSWITCH 1.10.2</a></li>
  <li>A public IP address to avoid NAT scenarios on the server side.</li>
  <li>(Optional) A DNS address for letsencrypt certificate.</li>
</ul>

<h2 id="install-freeswitch">Install FreeSWITCH</h2>

<p>Installation insutructions are for FreeSWITCH 1.10.2 and adopted from <a href="https://freeswitch.org/confluence/display/FREESWITCH/CentOS+7+and+RHEL+7#CentOS7andRHEL7-CentOS7andRHEL7-Stable">FreeSWITCH’s CENTOS documentation</a>.</p>

<pre><code class="language-bash">yum install -y https://files.freeswitch.org/repo/yum/centos-release/freeswitch-release-repo-0-1.noarch.rpm epel-release
yum install -y freeswitch-config-vanilla freeswitch-lang-* freeswitch-sounds-*
systemctl <span class="nb">enable</span> freeswitch
systemctl start freeswitch</code></pre>

<h2 id="setup-dtls-certificates">Setup DTLS Certificates</h2>

<p>A self signed SSL certificate is acceptable for development and is included with FreeSWITCH, but it will not work in a production environment. <a href="https://letsencrypt.org/">Let’s Encrypt</a> is a great way to get a free certificate.</p>

<h2 id="configure-freeswitch-1">Configure FreeSWITCH</h2>

<p>FreeSWITCH 1.10.2 is configured to work with SIP.js by default. The default configuration location is <code>/usr/local/freeswitch/conf</code>. It is recommended that you use FreeSWITCH with a publicly accessible IP adress. This guide does not cover how to interop SIP.js with FreeSWITCH through a Firewall or NAT.</p>

<h2 id="configure-sipjs">Configure SIP.js</h2>

<p>SIP.js works with FreeSWITCH without any special configuration parameters. The following Simple User is configured to connect to a default FreeSWITCH configuration. See the full <a href="https://github.com/onsip/SIP.js/blob/master/docs/api/sip.js.md">API reference</a> for using the full API.</p>

<p>Replace <code>127.0.0.1</code> with the IP address of your FreeSWITCH server. If you have changed the FreeSWITCH configuration you may need to update the user details below. The example provided will register to FreeSWITCH as user <code>1000</code> and will place a call to user <code>1001</code>.</p>

<p>You may need a valid SSL Certificate for FreeSWITCH to function properly with WebRTC.</p>

<pre><code class="language-html"><span class="p">&lt;</span><span class="nt">audio</span> <span class="na">id</span><span class="o">=</span><span class="s">"remoteAudio"</span> <span class="na">controls</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your browser doesn't support HTML5 audio.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">audio</span><span class="p">&gt;</span></code></pre>

<pre><code class="language-javascript"><span class="k">import</span> <span class="p">{</span> <span class="nx">SimpleUser</span><span class="p">,</span> <span class="nx">SimpleUserOptions</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">"sip.js/lib/platform/web"</span><span class="p">;</span>

<span class="c1">// Helper function to get an HTML audio element</span>
<span class="kd">function</span> <span class="nx">getAudioElement</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">HTMLAudioElement</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">el</span> <span class="k">instanceof</span> <span class="nx">HTMLAudioElement</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`Element "</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">" not found or not an audio element.`</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">el</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Helper function to wait</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">wait</span><span class="p">(</span><span class="nx">ms</span><span class="o">:</span> <span class="nx">number</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">ms</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Main function</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>

  <span class="c1">// SIP over WebSocket Server URL</span>
  <span class="c1">// The URL of a SIP over WebSocket server which will complete the call.</span>
  <span class="c1">// FreeSwitch is an example of a server which supports SIP over WebSocket.</span>
  <span class="c1">// SIP over WebSocket is an internet standard the details of which are</span>
  <span class="c1">// outside the scope of this documentation, but there are many resources</span>
  <span class="c1">// available. See: https://tools.ietf.org/html/rfc7118 for the specification.</span>
  <span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="s2">"wss://127.0.0.1:5066"</span><span class="p">;</span>

  <span class="c1">// SIP Request URI</span>
  <span class="c1">// The SIP Request URI of the destination. It's "Who you wanna call?"</span>
  <span class="c1">// SIP is an internet standard the details of which are outside the</span>
  <span class="c1">// scope of this documentation, but there are many resources available.</span>
  <span class="c1">// See: https://tools.ietf.org/html/rfc3261 for the specification.</span>
  <span class="kd">const</span> <span class="nx">destination</span> <span class="o">=</span> <span class="s2">"sip:1001@127.0.0.1"</span><span class="p">;</span>

  <span class="c1">// SIP Address of Record (AOR)</span>
  <span class="c1">// This is the user's SIP address. It's "Where people can reach you."</span>
  <span class="c1">// SIP is an internet standard the details of which are outside the</span>
  <span class="c1">// scope of this documentation, but there are many resources available.</span>
  <span class="c1">// See: https://tools.ietf.org/html/rfc3261 for the specification.</span>
  <span class="kd">const</span> <span class="nx">aor</span> <span class="o">=</span> <span class="s2">"sip:1000@127.0.0.1"</span><span class="p">;</span>

  <span class="c1">// SIP Authorization Username</span>
  <span class="c1">// This is the user's authorization username used for authorizing requests.</span>
  <span class="c1">// SIP is an internet standard the details of which are outside the</span>
  <span class="c1">// scope of this documentation, but there are many resources available.</span>
  <span class="c1">// See: https://tools.ietf.org/html/rfc3261 for the specification.</span>
  <span class="kd">const</span> <span class="nx">authorizationUsername</span> <span class="o">=</span> <span class="s1">'1000'</span><span class="p">;</span>

  <span class="c1">// SIP Authorization Password</span>
  <span class="c1">// This is the user's authorization password used for authorizing requests.</span>
  <span class="c1">// SIP is an internet standard the details of which are outside the</span>
  <span class="c1">// scope of this documentation, but there are many resources available.</span>
  <span class="c1">// See: https://tools.ietf.org/html/rfc3261 for the specification.</span>
  <span class="kd">const</span> <span class="nx">authorizationPassword</span> <span class="o">=</span> <span class="s1">'1234'</span><span class="p">;</span>

  <span class="c1">// Configuration Options</span>
  <span class="c1">// These are configuration options for the `SimpleUser` instance.</span>
  <span class="c1">// Here we are setting the HTML audio element we want to use to</span>
  <span class="c1">// play the audio received from the remote end of the call.</span>
  <span class="c1">// An audio element is needed to play the audio received from the</span>
  <span class="c1">// remote end of the call. Once the call is established, a `MediaStream`</span>
  <span class="c1">// is attached to the provided audio element's `src` attribute.</span>
  <span class="kd">const</span> <span class="nx">options</span><span class="o">:</span> <span class="nx">SimpleUserOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">aor</span><span class="p">,</span>
    <span class="nx">media</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">remote</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="o">:</span> <span class="nx">getAudioElement</span><span class="p">(</span><span class="s2">"remoteAudio"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">userAgentOptions</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">authorizationPassword</span><span class="p">,</span>
      <span class="nx">authorizationUsername</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// Construct a SimpleUser instance</span>
  <span class="kd">const</span> <span class="nx">simpleUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleUser</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

  <span class="c1">// Supply delegate to handle inbound calls (optional)</span>
  <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">onCallReceived</span><span class="o">:</span> <span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">answer</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// Connect to server</span>
  <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

  <span class="c1">// Register to receive inbound calls (optional)</span>
  <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">register</span><span class="p">();</span>

  <span class="c1">// Place call to the destination</span>
  <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">destination</span><span class="p">);</span>

  <span class="c1">// Wait some number of milliseconds</span>
  <span class="k">await</span> <span class="nx">wait</span><span class="p">(</span><span class="mf">5000</span><span class="p">);</span>

  <span class="c1">// Hangup call</span>
  <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">hangup</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Run it</span>
<span class="nx">main</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Success`</span><span class="p">))</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="o">:</span> <span class="nb">Error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Failure`</span><span class="p">,</span> <span class="nx">error</span><span class="p">));</span></code></pre>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>It is known that SIP.js and FreeSWITCH might not interop well if you have the following option enabled on FreeSWITCH:</p>

<pre><code class="language-xml"><span class="nt">&lt;variable</span> <span class="na">name=</span><span class="s">"sip-force-contact"</span> <span class="na">value=</span><span class="s">"NDLB-connectile-dysfunction"</span><span class="nt">/&gt;</span></code></pre>

<p>FreeSWITCH has a confluence article on <a href="https://freeswitch.org/confluence/display/FREESWITCH/WebRTC">WebRTC support</a>.</p>

<h1 id="configure-web-socket-secure-wss-with-letsencrypt">Configure Web Socket Secure (WSS) with Letsencrypt</h1>

<p>Browsers are more forcibly requiring secure connections to enable WebRTC features. To enable WSS to work with most modern browsers you will need a real SSL certificate, which can be obtained from <a href="https://letsencrypt.org/">letsencrypt</a> for free. This guide covers the initial acquisition of the certificate for testing. Renewing the certificate or other issues are outside the scope of this guide.</p>

<h2 id="troubleshooting-1">Troubleshooting</h2>

<p>If the browser is silently failing to connect to FreeSWITCH securely it is most likely a bad certificate. Browsers will silently fail on this and SIP.js has no control over this.</p>

<p>FreeSWITCH has a confluence article on <a href="https://freeswitch.org/confluence/display/FREESWITCH/WebRTC">WebRTC support</a></p>

    </div>

    <nav id="sideNav">
  <ul>
    <li><a href="/guides/">Overview</a></li>
    <li class="parent">
      <a class="parent" href="/guides/server-configuration/">Server Configuration</a>
      <ul>
        <li><a href="/guides/server-configuration/freeswitch/">FreeSWITCH</a></li>
        <li><a href="/guides/server-configuration/asterisk/">Asterisk</a></li>
        <li><a href="/guides/server-configuration/onsip-network/">OnSIP</a></li>
      </ul>
    </li>
    <li><a href="/guides/simple-user/">Simple User</a></li>
    <li><a href="/guides/user-agent/">User Agent</a></li>
    <li><a href="/guides/make-call/">Make a Call</a></li>
    <li><a href="/guides/receive-call/">Receive a Call</a></li>
    <li><a href="/guides/end-call/">End a Call</a></li>
    <li><a href="/guides/attach-media/">Attach Media</a></li>
    <li><a href="/guides/send-dtmf/">Send DTMF</a></li>
    <li><a href="/guides/send-message/">Send Message</a></li>
    <li><a href="/guides/transfer/">Make a Transfer</a></li>
    <li><a class="last" href="/guides/full-demo-app/">Application Demo</a></li>
  </ul>
</nav>


  </article>

  <footer class="light-gray-bg">
  <div class="wrapper">
    <div id="onsip-stamp">
      <span id="made-by-prefix">made by</span>
      <a href="http://developer.onsip.com" id="onsip"></a>
    </div>
    <nav class="left">
      <ul class="horizontal">
        <li><a href="https://groups.google.com/forum/#!forum/sip_js" target="_blank">Mailing List</a></li>
        <li><a href="https://github.com/onsip/sip.js/issues" target="_blank">Report Issues</a></li>
        <li><a href="/license/">License</a></li>
      </ul>
    </nav>
    <nav class="right">
      <ul class="horizontal">
        <li><a href="https://travis-ci.org/onsip/SIP.js"><img src="https://travis-ci.org/onsip/SIP.js.png?branch=master"/></a></li>
        <li><a href="http://onsip.com/blog" target="_blank">Blog</a></li>
        <li><a href="/aboutus/">About</a></li>
        <li><a href="/faq/">FAQ</a></li>
      </ul>
    </nav>
    <div class="clearfix"></div>
  </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1008379-16', 'sipjs.com');
  ga('send', 'pageview');
</script>
<script>
  // Remove all 'no-js-hide' classes because Javascript is working
  $(function () {
      $('.no-js-hide').each(function (i, e) {
          $(e).removeClass('no-js-hide');
      });
      $('.no-js-block').each(function (i, e) {
          $(e).removeClass('no-js-block');
      });
  });
</script>


</body>
</html>
