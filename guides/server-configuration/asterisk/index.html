<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta http-equiv="imagetoolbar" content="false" />
  <meta name="MSSmartTagsPreventParsing" content="true" />
  <meta name="description" content="Easily install & configure Asterisk to work with SIP.js" />
  <meta name="viewport" content="initial-scale=1" />
  <title>Asterisk Installation & Configuration | SIP.js</title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="/changes.atom" />
  <link href='//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round' rel='stylesheet' type='text/css'>
  <link href="/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css" />
    
  <link href="/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css" />
  
  <script src="/shared/js/jquery.js" type="text/javascript"></script>
  <script src="/shared/js/documentation.js" type="text/javascript"></script>
  <link rel="shortcut icon" type="image/x-icon" href="/shared/img/favicon-7.ico"/>
</head>


<body class="guides">
  <div id="dev"></div>
<header id="siteHeader">
  <div class="wrapper">
    <nav id="mainNav">
      <a id="logo-link" href="/"><img id="logo" src="/shared/img/logo.png" alt="sip.js"></a>
      <ul id="full-nav" class="horizontal mobile-hide">
        <li><a href="https://github.com/onsip/SIP.js/releases">Download</a></li>
        <li><a id="api-nav" href="https://github.com/onsip/SIP.js/blob/master/docs/README.md">API</a></li>
        <li><a href="/guides/">Guides</a></li>
        <li><a href="https://github.com/onsip/sip.js" target="_blank">Github</a></li>
        <li><a href="/aboutus/" class="nav-aboutus">About Us</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/sip_js" target="_blank">Support</a></li>
        <li><a href="/faq/">FAQ</a></li>
      </ul>
    </nav>
  </div>
</header>


  <article id="main" class="wrapper group">
    <header id="sectionHeader">
      <h1><a href="/guides/">Guides</a></h1>
    </header>
    <div id="content">
      
<section class="callout">
<h3>Tired of fighting with configs?</h3>
<p>Try <a href="/">SIP.js</a> and <a href="http://developer.onsip.com/">OnSIP</a> — a perfect pairing for WebRTC!</p>
</section>

<h1 id="configure-asterisk">Configure Asterisk</h1>

<p>SIP.js has been tested with <a href="https://downloads.asterisk.org/pub/telephony/asterisk/asterisk-16.9.0.tar.gz">Asterisk 16.9.0</a> without any modification to the source code of SIP.js or Asterisk. Similar configuration should also work for other versions of Asterisk. If you have questions about WebRTC compatibility with a particular version of Asterisk, please direct those questions to appropriate Asterisk support forums.</p>

<h2 id="system-setup">System Setup</h2>

<p>Asterisk and SIP.js were tested using the following setup:</p>

<ul>
  <li>
<a href="http://isoredirect.centos.org/centos/7/isos/x86_64/">CentOS 7.2 minimal (x86_64)</a>.
<a href="https://downloads.asterisk.org/pub/telephony/asterisk/asterisk-16.9.0.tar.gz">Asterisk 16.9.0</a>.</li>
  <li>OpenSSL 1.0.1e-fips 11 Feb 2013 or later.</li>
  <li>A public IP address to avoid NAT scenarios on the server side.</li>
</ul>

<h2 id="disable-selinux">Disable SELinux</h2>

<h2 id="required-packages">Required Packages</h2>

<p>Install the following dependencies:</p>

<ul>
  <li>wget</li>
  <li>gcc</li>
  <li>gcc-c++</li>
  <li>ncurses-devel</li>
  <li>libxml2-devel</li>
  <li>sqlite-devel</li>
  <li>libsrtp-devel</li>
  <li>libuuid-devel</li>
  <li>openssl-devel</li>
</ul>

<p>Using YUM, all dependencies can be installed with:</p>

<p>`yum install wget gcc gcc-c++ ncurses-devel libuuid-devel jansson-devel libxml2-devel sqlite-devel libsrtp-devel openssl-devel</p>

<h2 id="install-asterisk">Install Asterisk</h2>

<ol>
  <li>
<code>cd /usr/local/src/</code>.</li>
  <li>Download Asterisk with <code>wget https://downloads.asterisk.org/pub/telephony/asterisk/asterisk-16.9.0.tar.gz</code>.</li>
  <li>Extract Asterisk: <code>tar zxvf asterisk*</code>.</li>
  <li>Enter the Asterisk directory: <code>cd /usr/local/src/asterisk*</code>.</li>
  <li>Run the Asterisk configure script: <code>./configure --with-jansson-bundled</code>.</li>
  <li>Run the Asterisk menuselect tool: <code>make menuselect</code>.</li>
  <li>In the menuselect, go to the resources option and ensure that res_srtp and pjproject is enabled. If there are 3 x’s next to res_srtp, there is a problem with the srtp library and you must reinstall it. Save the configuration (press x).</li>
  <li>Compile and install Asterisk: <code>make &amp;&amp; make install</code>.</li>
  <li>If you need the sample configs you can run <code>make samples</code> to install the sample configs. If you need to install the Asterisk startup script you can run <code>make config</code>.</li>
</ol>

<h2 id="setup-dtls-certificates">Setup DTLS Certificates</h2>

<p>A self signed SSL certificate is acceptable for development, but it will not work in a production environment. <a href="https://letsencrypt.org/">Let’s Encrypt</a> is a great way to get a free certificate.</p>

<h3 id="self-signed-certificate">Self Signed Certificate</h3>

<ol>
  <li><code>mkdir /etc/asterisk/keys</code></li>
  <li>Enter the Asterisk scripts directory: <code>cd /usr/local/src/asterisk*/contrib/scripts</code>.</li>
  <li>Create the DTLS certificates (replace pbx.mycompany.com with your ip address or dns name, replace My Super Company with your company name): <code>./ast_tls_cert -C pbx.mycompany.com -O "My Super Company" -d /etc/asterisk/keys</code>.</li>
</ol>

<h2 id="configure-asterisk-for-webrtc">Configure Asterisk For WebRTC</h2>

<p>For WebRTC, a lot of the settings that are needed MUST be in the <strong>peer settings</strong>. The global settings do not flow down into the peer settings very well.
By default, Asterisk config files are located in <code>/etc/asterisk/</code>.
Start by editing <code>http.conf</code> and make sure that the following lines are uncommented:</p>

<pre><code class="language-text">;http.conf
[general]
enabled=yes
bindaddr=127.0.0.1 ; Replace this with your IP address
bindport=8088 ; Replace this with the port you want to listen on
tlsenable=yes
tlsbindaddr=127.0.0.1:8089 ; Replace this with your IP address
tlscertfile=/etc/asterisk/keys/asterisk.pem</code></pre>

<p>Change the IP address and port to the IP address of your server and the port that you would like Asterisk to listen for web socket connections on.</p>

<p>Next, edit <code>sip.conf</code>. Here you will set up two peers, one for a WebRTC client and one for a non-WebRTC SIP client. The WebRTC peer requires encryption, avpf, and icesupport to be enabled. In most cases, directmedia should be disabled. Also under the WebRTC client, the transport needs to be listed as ‘ws’ to allow websocket connections. All of these config lines should be under the peer itself; setting these config lines globally might not work.</p>

<pre><code class="language-text">;sip.conf
[general]
realm=127.0.0.1 ; Replace this with your IP address
udpbindaddr=127.0.0.1 ; Replace this with your IP address
transport=udp

[1060] ; This will be WebRTC client
type=friend
username=1060 ; The Auth user for SIP.js
host=dynamic ; Allows any host to register
secret=password ; The SIP Password for SIP.js
encryption=yes ; Tell Asterisk to use encryption for this peer
avpf=yes ; Tell Asterisk to use AVPF for this peer
icesupport=yes ; Tell Asterisk to use ICE for this peer
context=default ; Tell Asterisk which context to use when this peer is dialing
directmedia=no ; Asterisk will relay media for this peer
transport=udp,ws,wss ; Asterisk will allow this peer to register on UDP or WebSockets
force_avp=yes ; Force Asterisk to use avp. Introduced in Asterisk 11.11
dtlsenable=yes ; Tell Asterisk to enable DTLS for this peer
dtlsverify=fingerprint ; Tell Asterisk to verify DTLS fingerprint
dtlscertfile=/etc/asterisk/keys/asterisk.pem ; Tell Asterisk where your DTLS cert file is
dtlssetup=actpass ; Tell Asterisk to use actpass SDP parameter when setting up DTLS
rtcp_mux=yes ; Tell Asterisk to do RTCP mux

[1061] ; This will be the legacy SIP client
type=friend
username=1061
host=dynamic
secret=password
context=default</code></pre>

<p>Lastly, set up <code>extensions.conf</code> to allow the two peers to call each other.</p>

<pre><code class="language-text">;extensions.conf
[default]
exten =&gt; 1060,1,Dial(SIP/1060) ; Dialing 1060 will call the SIP client registered to 1060
exten =&gt; 1061,1,Dial(SIP/1061) ; Dialing 1061 will call the SIP client registered to 1061</code></pre>

<p>Restart Asterisk using <code>service asterisk restart</code> to ensure that the new settings take effect.</p>

<h2 id="configure-sipjs">Configure SIP.js</h2>

<p>If you used a self signed certificate in the earlier steps, you will need to navigate to <code>https://&lt;your_ip_address&gt;:8089/ws</code> and add the certificate exception.</p>

<p>This guide will only work with audio calls, Asterisk will reject video calls.</p>

<p>The following configuration example creates a Simple User for the Asterisk configuration above. Replace the values with the values from your config.</p>

<pre><code class="language-html"><span class="p">&lt;</span><span class="nt">audio</span> <span class="na">id</span><span class="o">=</span><span class="s">"remoteAudio"</span> <span class="na">controls</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your browser doesn't support HTML5 audio.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">audio</span><span class="p">&gt;</span></code></pre>

<pre><code class="language-javascript"><span class="k">import</span> <span class="p">{</span> <span class="nx">SimpleUser</span><span class="p">,</span> <span class="nx">SimpleUserOptions</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">"sip.js/lib/platform/web"</span><span class="p">;</span>

<span class="c1">// Helper function to get an HTML audio element</span>
<span class="kd">function</span> <span class="nx">getAudioElement</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span> <span class="nx">string</span><span class="p">)</span><span class="o">:</span> <span class="nx">HTMLAudioElement</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">el</span> <span class="k">instanceof</span> <span class="nx">HTMLAudioElement</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="sb">`Element "</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">" not found or not an audio element.`</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">el</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Helper function to wait</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">wait</span><span class="p">(</span><span class="nx">ms</span><span class="o">:</span> <span class="nx">number</span><span class="p">)</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">ms</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Main function</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span><span class="o">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>

  <span class="c1">// SIP over WebSocket Server URL</span>
  <span class="c1">// The URL of a SIP over WebSocket server which will complete the call.</span>
  <span class="c1">// FreeSwitch is an example of a server which supports SIP over WebSocket.</span>
  <span class="c1">// SIP over WebSocket is an internet standard the details of which are</span>
  <span class="c1">// outside the scope of this documentation, but there are many resources</span>
  <span class="c1">// available. See: https://tools.ietf.org/html/rfc7118 for the specification.</span>
  <span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="s2">"wss://127.0.0.1:5066"</span><span class="p">;</span>

  <span class="c1">// SIP Request URI</span>
  <span class="c1">// The SIP Request URI of the destination. It's "Who you wanna call?"</span>
  <span class="c1">// SIP is an internet standard the details of which are outside the</span>
  <span class="c1">// scope of this documentation, but there are many resources available.</span>
  <span class="c1">// See: https://tools.ietf.org/html/rfc3261 for the specification.</span>
  <span class="kd">const</span> <span class="nx">destination</span> <span class="o">=</span> <span class="s2">"sip:1061@127.0.0.1"</span><span class="p">;</span>

  <span class="c1">// SIP Address of Record (AOR)</span>
  <span class="c1">// This is the user's SIP address. It's "Where people can reach you."</span>
  <span class="c1">// SIP is an internet standard the details of which are outside the</span>
  <span class="c1">// scope of this documentation, but there are many resources available.</span>
  <span class="c1">// See: https://tools.ietf.org/html/rfc3261 for the specification.</span>
  <span class="kd">const</span> <span class="nx">aor</span> <span class="o">=</span> <span class="s2">"sip:1060@127.0.0.1"</span><span class="p">;</span>

  <span class="c1">// SIP Authorization Username</span>
  <span class="c1">// This is the user's authorization username used for authorizing requests.</span>
  <span class="c1">// SIP is an internet standard the details of which are outside the</span>
  <span class="c1">// scope of this documentation, but there are many resources available.</span>
  <span class="c1">// See: https://tools.ietf.org/html/rfc3261 for the specification.</span>
  <span class="kd">const</span> <span class="nx">authorizationUsername</span> <span class="o">=</span> <span class="s1">'1060'</span><span class="p">;</span>

  <span class="c1">// SIP Authorization Password</span>
  <span class="c1">// This is the user's authorization password used for authorizing requests.</span>
  <span class="c1">// SIP is an internet standard the details of which are outside the</span>
  <span class="c1">// scope of this documentation, but there are many resources available.</span>
  <span class="c1">// See: https://tools.ietf.org/html/rfc3261 for the specification.</span>
  <span class="kd">const</span> <span class="nx">authorizationPassword</span> <span class="o">=</span> <span class="s1">'1234'</span><span class="p">;</span>

  <span class="c1">// Configuration Options</span>
  <span class="c1">// These are configuration options for the `SimpleUser` instance.</span>
  <span class="c1">// Here we are setting the HTML audio element we want to use to</span>
  <span class="c1">// play the audio received from the remote end of the call.</span>
  <span class="c1">// An audio element is needed to play the audio received from the</span>
  <span class="c1">// remote end of the call. Once the call is established, a `MediaStream`</span>
  <span class="c1">// is attached to the provided audio element's `src` attribute.</span>
  <span class="kd">const</span> <span class="nx">options</span><span class="o">:</span> <span class="nx">SimpleUserOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">aor</span><span class="p">,</span>
    <span class="nx">media</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">remote</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="o">:</span> <span class="nx">getAudioElement</span><span class="p">(</span><span class="s2">"remoteAudio"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">userAgentOptions</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">authorizationPassword</span><span class="p">,</span>
      <span class="nx">authorizationUsername</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// Construct a SimpleUser instance</span>
  <span class="kd">const</span> <span class="nx">simpleUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleUser</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

  <span class="c1">// Supply delegate to handle inbound calls (optional)</span>
  <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">onCallReceived</span><span class="o">:</span> <span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">answer</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// Connect to server</span>
  <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

  <span class="c1">// Register to receive inbound calls (optional)</span>
  <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">register</span><span class="p">();</span>

  <span class="c1">// Place call to the destination</span>
  <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">destination</span><span class="p">);</span>

  <span class="c1">// Wait some number of milliseconds</span>
  <span class="k">await</span> <span class="nx">wait</span><span class="p">(</span><span class="mf">5000</span><span class="p">);</span>

  <span class="c1">// Hangup call</span>
  <span class="k">await</span> <span class="nx">simpleUser</span><span class="p">.</span><span class="nx">hangup</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Run it</span>
<span class="nx">main</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Success`</span><span class="p">))</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="o">:</span> <span class="nb">Error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Failure`</span><span class="p">,</span> <span class="nx">error</span><span class="p">));</span></code></pre>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>This <a href="http://forums.digium.com/viewtopic.php?f=1&amp;t=90167&amp;sid=66fdf8cc4be5d955ba584e989a23442f">forum post</a> on troubleshooting WebRTC issues is a great guide for trouble shooting problems with Asterisk.</p>

<p><a href="https://wiki.asterisk.org/wiki/display/AST/Secure+Calling+Tutorial">Asterisk Secure Calling Guide</a> can help you setup dtls certificates.</p>

<p><a href="https://wiki.asterisk.org/wiki/display/AST/WebRTC+tutorial+using+SIPML5">Asterisk WebRTC tutorial</a></p>

    </div>

    <nav id="sideNav">
  <ul>
    <li><a href="/guides/">Overview</a></li>
    <li class="parent">
      <a class="parent" href="/guides/server-configuration/">Server Configuration</a>
      <ul>
        <li><a href="/guides/server-configuration/freeswitch/">FreeSWITCH</a></li>
        <li><a href="/guides/server-configuration/asterisk/">Asterisk</a></li>
        <li><a href="/guides/server-configuration/onsip-network/">OnSIP</a></li>
      </ul>
    </li>
    <li><a href="/guides/simple-user/">Simple User</a></li>
    <li><a href="/guides/user-agent/">User Agent</a></li>
    <li><a href="/guides/make-call/">Make a Call</a></li>
    <li><a href="/guides/receive-call/">Receive a Call</a></li>
    <li><a href="/guides/end-call/">End a Call</a></li>
    <li><a href="/guides/attach-media/">Attach Media</a></li>
    <li><a href="/guides/send-dtmf/">Send DTMF</a></li>
    <li><a href="/guides/send-message/">Send Message</a></li>
    <li><a href="/guides/transfer/">Make a Transfer</a></li>
    <li><a class="last" href="/guides/full-demo-app/">Application Demo</a></li>
  </ul>
</nav>


  </article>

  <footer class="light-gray-bg">
  <div class="wrapper">
    <div id="onsip-stamp">
      <span id="made-by-prefix">made by</span>
      <a href="http://developer.onsip.com" id="onsip"></a>
    </div>
    <nav class="left">
      <ul class="horizontal">
        <li><a href="https://groups.google.com/forum/#!forum/sip_js" target="_blank">Mailing List</a></li>
        <li><a href="https://github.com/onsip/sip.js/issues" target="_blank">Report Issues</a></li>
        <li><a href="/license/">License</a></li>
      </ul>
    </nav>
    <nav class="right">
      <ul class="horizontal">
        <li><a href="https://travis-ci.org/onsip/SIP.js"><img src="https://travis-ci.org/onsip/SIP.js.png?branch=master"/></a></li>
        <li><a href="http://onsip.com/blog" target="_blank">Blog</a></li>
        <li><a href="/aboutus/">About</a></li>
        <li><a href="/faq/">FAQ</a></li>
      </ul>
    </nav>
    <div class="clearfix"></div>
  </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1008379-16', 'sipjs.com');
  ga('send', 'pageview');
</script>
<script>
  // Remove all 'no-js-hide' classes because Javascript is working
  $(function () {
      $('.no-js-hide').each(function (i, e) {
          $(e).removeClass('no-js-hide');
      });
      $('.no-js-block').each(function (i, e) {
          $(e).removeClass('no-js-block');
      });
  });
</script>


</body>
</html>
