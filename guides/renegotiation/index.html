<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta http-equiv="imagetoolbar" content="false" />
  <meta name="MSSmartTagsPreventParsing" content="true" />
  <meta name="description" content="How to renegotiation with SIP.js." />
  <meta name="viewport" content="initial-scale=1" />
  <title>Renegotiation | SIP.js</title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="/changes.atom" />
  <link href='//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round' rel='stylesheet' type='text/css'>
  <link href="/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css" />
    
  <link href="/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css" />
  
  <script src="/shared/js/jquery.js" type="text/javascript"></script>
  <script src="/shared/js/documentation.js" type="text/javascript"></script>
  <link rel="shortcut icon" type="image/x-icon" href="/shared/img/favicon-7.ico"/>
</head>


<body class="guides">
  <div id="dev"></div>
<header id="siteHeader">
  <div class="wrapper">
    <nav id="mainNav">
      <a id="logo-link" href="/"><img id="logo" src="/shared/img/logo.png" alt="sip.js"></a>
      <ul id="full-nav" class="horizontal mobile-hide">
        <li><a href="/download/">Download</a></li>
        <li><a id="api-nav" href="/api/0.15.0/">API</a></li>
        <li><a href="/guides/">Guides</a></li>
        <li><a href="https://github.com/onsip/sip.js" target="_blank">Github</a></li>
        <li><a href="/aboutus/" class="nav-aboutus">About Us</a></li>
        <li><a href="https://groups.google.com/forum/#!forum/sip_js" target="_blank">Support</a></li>
        <li><a href="/faq/">FAQ</a></li>
      </ul>
    </nav>
  </div>
</header>


  <article id="main" class="wrapper group">
    <header id="sectionHeader">
      <h1><a href="/guides/">Guides</a></h1>
    </header>
    <div id="content">
      
<h1 id="renegotiation">Renegotiation</h1>

<p>As of SIP.js 0.8.0 renegotiation is supported through the <a href="../../api/0.15.0/session/#reinvite"><code>reinvite()</code></a> and <a href="../../api/0.15.0/session/#hold"><code>hold()</code></a> functions. Renegotiation allows you to do things such as add video in the middle of a call, put a call on hold, or change codecs that you are using. This guide will go over starting an audio only call and then adding video to it. This is not an extensive guide as to what can be accomplished with renegotition, but merely a starting point.</p>

<ul>
  <li>SIP.js 0.9.1 adds support for receiving a re-invite without SDP</li>
</ul>

<p>As of SIP.js 0.9.1, you can now be the target of Music On Hold <a href="https://tools.ietf.org/html/rfc7088">RFC 7088</a>. There is still no support for sending re-invites without SDP or putting someone on Music On Hold. This will be added in a later release. SIP.js will automatically accept and process re-invites without SDP in the same manner as a re-invite with SDP.</p>

<h2 id="setup">Setup</h2>

<p>This guide will cover the user that is initiating the renegotiation. Once a session is established, if the other endpoint can renegotiate it should automatically accept the reinvite. SIP.js will automatically accept reinvites.</p>

<p>First, a user agent and call will need to be set up to do audio only.</p>

<pre><code class="language-javascript">  <span class="c1">// Create a user agent using the default settings of SIP.js</span>
  <span class="kd">var</span> <span class="nx">userAgent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UA</span><span class="p">();</span>

  <span class="c1">// Make a call to 'test@example.onsip.com' with audio only</span>
  <span class="nx">session</span> <span class="o">=</span> <span class="nx">userAgent</span><span class="p">.</span><span class="nx">invite</span><span class="p">(</span><span class="s1">'test@example.onsip.com'</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">sessionDescriptionHandlerOptions</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">constraints</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">video</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span></code></pre>

<h2 id="sending-a-reinvite">Sending a Reinvite</h2>

<p>Once the session is established a reinvite can be sent to enable video. A target is not used for reinvite because the messages are sent in an already established session.</p>

<pre><code class="language-javascript">  <span class="nx">session</span><span class="p">.</span><span class="nx">reinvite</span><span class="p">({</span>
    <span class="nx">sessionDescriptionHandlerOptions</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">constraints</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">video</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span></code></pre>

<h2 id="handling-a-reinvite">Handling a Reinvite</h2>

<p>SIP.js will automatically handle a reinvite if it can. There is no user action required.</p>

    </div>

    <nav id="sideNav">
  <ul>
    <li><a href="/guides/">Overview</a></li>
    <li class="parent">
      <a class="parent" href="/guides/server-configuration/">Server Configuration</a>
      <ul>
        <li><a href="/guides/server-configuration/freeswitch/">FreeSWITCH</a></li>
        <li><a href="/guides/server-configuration/asterisk/">Asterisk</a></li>
        <li><a href="/guides/server-configuration/onsip-network/">OnSIP</a></li>
      </ul>
    </li>
    <li><a href="/guides/simple-user/">Simple User</a></li>
    <li><a href="/guides/user-agent/">User Agent</a></li>
    <li><a href="/guides/make-call/">Make a Call</a></li>
    <li><a href="/guides/receive-call/">Receive a Call</a></li>
    <li><a href="/guides/end-call/">End a Call</a></li>
    <li><a href="/guides/attach-media/">Attach Media</a></li>
    <li><a href="/guides/send-dtmf/">Send DTMF</a></li>
    <li><a href="/guides/send-message/">Send Message</a></li>
    <li><a href="/guides/transfer/">Make a Transfer</a></li>
    <li><a class="last" href="/guides/full-demo-app/">Application Demo</a></li>
  </ul>
</nav>


  </article>

  <footer class="light-gray-bg">
  <div class="wrapper">
    <div id="onsip-stamp">
      <span id="made-by-prefix">made by</span>
      <a href="http://developer.onsip.com" id="onsip"></a>
    </div>
    <nav class="left">
      <ul class="horizontal">
        <li><a href="https://groups.google.com/forum/#!forum/sip_js" target="_blank">Mailing List</a></li>
        <li><a href="https://github.com/onsip/sip.js/issues" target="_blank">Report Issues</a></li>
        <li><a href="/license/">License</a></li>
      </ul>
    </nav>
    <nav class="right">
      <ul class="horizontal">
        <li><a href="https://travis-ci.org/onsip/SIP.js"><img src="https://travis-ci.org/onsip/SIP.js.png?branch=master"/></a></li>
        <li><a href="http://onsip.com/blog" target="_blank">Blog</a></li>
        <li><a href="/aboutus/">About</a></li>
        <li><a href="/faq/">FAQ</a></li>
      </ul>
    </nav>
    <div class="clearfix"></div>
  </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1008379-16', 'sipjs.com');
  ga('send', 'pageview');
</script>
<script>
  // Remove all 'no-js-hide' classes because Javascript is working
  $(function () {
      $('.no-js-hide').each(function (i, e) {
          $(e).removeClass('no-js-hide');
      });
      $('.no-js-block').each(function (i, e) {
          $(e).removeClass('no-js-block');
      });
  });
</script>


</body>
</html>
