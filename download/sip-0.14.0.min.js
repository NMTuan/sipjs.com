!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SIP=t():e.SIP=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=64)}([function(e,t,r){var n;e.exports=(n=n||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],i=function(t){var t=t,r=987654321,n=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=i(4294967296*(r||e.random()));r=987654071*a(),n.push(4294967296*a()|0)}return new s.init(n,t)}}),a=n.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new s.init(r,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(r,t)}},d=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,a=4*o,c=i/a,u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*o,d=e.min(4*u,i);if(u){for(var h=0;h<u;h+=o)this._doProcessBlock(n,h);var p=n.splice(0,u);r.sigBytes-=d}return new s.init(p,d)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),p=(i.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math),n)},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(28)),n(r(43)),n(r(90)),n(r(91)),n(r(92)),n(r(43)),n(r(30)),n(r(20)),n(r(29))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(36);!function(e){e.USER_AGENT=n.title+"/"+n.version,e.SIP="sip",e.SIPS="sips",function(e){e.CONNECTION_ERROR="Connection Error",e.INTERNAL_ERROR="Internal Error",e.REQUEST_TIMEOUT="Request Timeout",e.SIP_FAILURE_CODE="SIP Failure Code",e.ADDRESS_INCOMPLETE="Address Incomplete",e.AUTHENTICATION_ERROR="Authentication Error",e.BUSY="Busy",e.DIALOG_ERROR="Dialog Error",e.INCOMPATIBLE_SDP="Incompatible SDP",e.NOT_FOUND="Not Found",e.REDIRECTED="Redirected",e.REJECTED="Rejected",e.UNAVAILABLE="Unavailable",e.BAD_MEDIA_DESCRIPTION="Bad Media Description",e.CANCELED="Canceled",e.EXPIRES="Expires",e.NO_ACK="No ACK",e.NO_ANSWER="No Answer",e.NO_PRACK="No PRACK",e.RTP_TIMEOUT="RTP Timeout",e.USER_DENIED_MEDIA_ACCESS="User Denied Media Access",e.WEBRTC_ERROR="WebRTC Error",e.WEBRTC_NOT_SUPPORTED="WebRTC Not Supported"}(e.causes||(e.causes={})),function(e){e.REQUIRED="required",e.SUPPORTED="supported",e.UNSUPPORTED="none"}(e.supported||(e.supported={})),e.SIP_ERROR_CAUSES={ADDRESS_INCOMPLETE:[484],AUTHENTICATION_ERROR:[401,407],BUSY:[486,600],INCOMPATIBLE_SDP:[488,606],NOT_FOUND:[404,604],REDIRECTED:[300,301,302,305,380],REJECTED:[403,603],UNAVAILABLE:[480,410,408,430]},e.ACK="ACK",e.BYE="BYE",e.CANCEL="CANCEL",e.INFO="INFO",e.INVITE="INVITE",e.MESSAGE="MESSAGE",e.NOTIFY="NOTIFY",e.OPTIONS="OPTIONS",e.REGISTER="REGISTER",e.UPDATE="UPDATE",e.SUBSCRIBE="SUBSCRIBE",e.PUBLISH="PUBLISH",e.REFER="REFER",e.PRACK="PRACK",e.REASON_PHRASE={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},e.OPTION_TAGS={"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},function(e){e.INFO="info",e.RTP="rtp"}(e.dtmfType||(e.dtmfType={}))}(t.C||(t.C={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.STATUS_EARLY=1]="STATUS_EARLY",e[e.STATUS_CONFIRMED=2]="STATUS_CONFIRMED"}(t.DialogStatus||(t.DialogStatus={})),function(e){e[e.STATUS_NULL=0]="STATUS_NULL",e[e.STATUS_INVITE_SENT=1]="STATUS_INVITE_SENT",e[e.STATUS_1XX_RECEIVED=2]="STATUS_1XX_RECEIVED",e[e.STATUS_INVITE_RECEIVED=3]="STATUS_INVITE_RECEIVED",e[e.STATUS_WAITING_FOR_ANSWER=4]="STATUS_WAITING_FOR_ANSWER",e[e.STATUS_ANSWERED=5]="STATUS_ANSWERED",e[e.STATUS_WAITING_FOR_PRACK=6]="STATUS_WAITING_FOR_PRACK",e[e.STATUS_WAITING_FOR_ACK=7]="STATUS_WAITING_FOR_ACK",e[e.STATUS_CANCELED=8]="STATUS_CANCELED",e[e.STATUS_TERMINATED=9]="STATUS_TERMINATED",e[e.STATUS_ANSWERED_WAITING_FOR_PRACK=10]="STATUS_ANSWERED_WAITING_FOR_PRACK",e[e.STATUS_EARLY_MEDIA=11]="STATUS_EARLY_MEDIA",e[e.STATUS_CONFIRMED=12]="STATUS_CONFIRMED"}(t.SessionStatus||(t.SessionStatus={})),function(e){e[e.ClientContext=0]="ClientContext",e[e.ConfigurationError=1]="ConfigurationError",e[e.Dialog=2]="Dialog",e[e.DigestAuthentication=3]="DigestAuthentication",e[e.DTMF=4]="DTMF",e[e.IncomingMessage=5]="IncomingMessage",e[e.IncomingRequest=6]="IncomingRequest",e[e.IncomingResponse=7]="IncomingResponse",e[e.InvalidStateError=8]="InvalidStateError",e[e.InviteClientContext=9]="InviteClientContext",e[e.InviteServerContext=10]="InviteServerContext",e[e.Logger=11]="Logger",e[e.LoggerFactory=12]="LoggerFactory",e[e.MethodParameterError=13]="MethodParameterError",e[e.NameAddrHeader=14]="NameAddrHeader",e[e.NotSupportedError=15]="NotSupportedError",e[e.OutgoingRequest=16]="OutgoingRequest",e[e.Parameters=17]="Parameters",e[e.PublishContext=18]="PublishContext",e[e.ReferClientContext=19]="ReferClientContext",e[e.ReferServerContext=20]="ReferServerContext",e[e.RegisterContext=21]="RegisterContext",e[e.RenegotiationError=22]="RenegotiationError",e[e.RequestSender=23]="RequestSender",e[e.ServerContext=24]="ServerContext",e[e.Session=25]="Session",e[e.SessionDescriptionHandler=26]="SessionDescriptionHandler",e[e.SessionDescriptionHandlerError=27]="SessionDescriptionHandlerError",e[e.SessionDescriptionHandlerObserver=28]="SessionDescriptionHandlerObserver",e[e.Subscription=29]="Subscription",e[e.Transport=30]="Transport",e[e.UA=31]="UA",e[e.URI=32]="URI"}(t.TypeStrings||(t.TypeStrings={})),function(e){e[e.STATUS_INIT=0]="STATUS_INIT",e[e.STATUS_STARTING=1]="STATUS_STARTING",e[e.STATUS_READY=2]="STATUS_READY",e[e.STATUS_USER_CLOSED=3]="STATUS_USER_CLOSED",e[e.STATUS_NOT_READY=4]="STATUS_NOT_READY"}(t.UAStatus||(t.UAStatus={}))},function(e,t,r){var n;e.exports=(n=r(0),r(13),void(n.lib.Cipher||function(e){var t=n,r=t.lib,i=r.Base,o=r.WordArray,s=r.BufferedBlockAlgorithm,a=t.enc,c=(a.Utf8,a.Base64),u=t.algo,d=u.EvpKDF,h=r.Cipher=s.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?_:T}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()}),p=(r.StreamCipher=h.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),t.mode={}),l=r.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=p.CBC=function(){var t=l.extend();function r(t,r,n){var i=this._iv;if(i){var o=i;this._iv=e}else var o=this._prevBlock;for(var s=0;s<n;s++)t[r+s]^=o[s]}return t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;r.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),t.Decryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,o=e.slice(t,t+i);n.decryptBlock(e,t),r.call(this,e,t,i),this._prevBlock=o}}),t}(),g=t.pad={},v=g.Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,s=[],a=0;a<n;a+=4)s.push(i);var c=o.create(s,n);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},m=(r.BlockCipher=h.extend({cfg:h.cfg.extend({mode:f,padding:v}),reset:function(){h.reset.call(this);var e=this.cfg,t=e.iv,r=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=r.createEncryptor;else{var n=r.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==n?this._mode.init(this,t&&t.words):(this._mode=n.call(r,this,t&&t.words),this._mode.__creator=n)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{var t=this._process(!0);e.unpad(t)}return t},blockSize:4}),r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),y=t.format={},S=y.OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;if(r)var n=o.create([1398893684,1701076831]).concat(r).concat(t);else var n=t;return n.toString(c)},parse:function(e){var t=c.parse(e),r=t.words;if(1398893684==r[0]&&1701076831==r[1]){var n=o.create(r.slice(2,4));r.splice(0,4),t.sigBytes-=16}return m.create({ciphertext:t,salt:n})}},T=r.SerializableCipher=i.extend({cfg:i.extend({format:S}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),o=i.finalize(t),s=i.cfg;return m.create({ciphertext:o,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=e.createDecryptor(r,n).finalize(t.ciphertext);return i},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),C=t.kdf={},b=C.OpenSSL={execute:function(e,t,r,n){n||(n=o.random(8));var i=d.create({keySize:t+r}).compute(e,n),s=o.create(i.words.slice(t),4*r);return i.sigBytes=4*t,m.create({key:i,iv:s,salt:n})}},_=r.PasswordBasedCipher=T.extend({cfg:T.cfg.extend({kdf:b}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=i.iv;var o=T.encrypt.call(this,e,t,i.key,n);return o.mixIn(i),o},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);n.iv=i.iv;var o=T.decrypt.call(this,e,t,i.key,n);return o}})}()))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(3),o=r(11);!function(e){e.defer=function(){var e={};return e.promise=new Promise(function(t,r){e.resolve=t,e.reject=r}),e},e.reducePromises=function(e,t){return e.reduce(function(e,t){return e=e.then(t)},Promise.resolve(t))},e.str_utf8_length=function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},e.generateFakeSDP=function(e){if(e){var t=e.indexOf("o="),r=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,r)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},e.isDecimal=function(e){var t=parseInt(e,10);return!isNaN(t)&&parseFloat(e)===t},e.createRandomToken=function(e,t){void 0===t&&(t=32);for(var r="",n=0;n<e;n++)r+=Math.floor(Math.random()*t).toString(t);return r},e.newTag=function(){return e.createRandomToken(10)},e.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.floor(16*Math.random());return("x"===e?t:t%4+8).toString(16)})},e.normalizeTarget=function(t,r){if(t){if(t.type===i.TypeStrings.URI)return t;if("string"==typeof t){var s=t.split("@"),a=void 0,c=void 0;switch(s.length){case 1:if(!r)return;a=t,c=r;break;case 2:a=s[0],c=s[1];break;default:a=s.slice(0,s.length-1).join("@"),c=s[s.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,"")),t=n.C.SIP+":"+e.escapeUser(a)+"@"+c,o.Grammar.URIParse(t)}}},e.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},e.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),n=r.length,i="",o=0;o<n;o++)0!==o&&(i+="-"),i+=r[o].charAt(0).toUpperCase()+r[o].substring(1);return t[i]&&(i=t[i]),i},e.sipErrorCause=function(e){for(var t in n.C.SIP_ERROR_CAUSES)if(-1!==n.C.SIP_ERROR_CAUSES[t].indexOf(e))return n.C.causes[t];return n.C.causes.SIP_FAILURE_CODE},e.getReasonPhrase=function(e,t){return t||n.C.REASON_PHRASE[e]||""},e.getReasonHeaderValue=function(t,r){return"SIP;cause="+t+';text="'+(r=e.getReasonPhrase(t,r))+'"'},e.getCancelReason=function(t,r){if(t&&t<200||t>699)throw new TypeError("Invalid statusCode: "+t);if(t)return e.getReasonHeaderValue(t,r)},e.buildStatusLine=function(t,r){if(!t||t<100||t>699)throw new TypeError("Invalid statusCode: "+t);if(r&&"string"!=typeof r&&!(r instanceof String))throw new TypeError("Invalid reason: "+r);return"SIP/2.0 "+t+" "+(r=e.getReasonPhrase(t,r))+"\r\n"}}(t.Utils||(t.Utils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(8),o=r(1),s=function(){function e(e,t,r,n){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=n,this.challenged=!1,this.stale=!1,this.logger=this.loggerFactory.getLogger("sip.user-agent-client"),this.init()}return e.prototype.dispose=function(){this.transaction.dispose()},Object.defineProperty(e.prototype,"loggerFactory",{get:function(){return this.core.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transaction",{get:function(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction},enumerable:!0,configurable:!0}),e.prototype.cancel=function(t,r){var s=this;if(void 0===r&&(r={}),!this.transaction)throw new Error("Transaction undefined.");if(!this.message.to)throw new Error("To undefined.");if(!this.message.from)throw new Error("From undefined.");var a=new i.OutgoingRequest(n.C.CANCEL,this.message.ruri,this.message.ua,{toUri:this.message.to.uri,toTag:this.message.toTag,fromUri:this.message.from.uri,fromTag:this.message.fromTag,callId:this.message.callId,cseq:this.message.cseq},r.extraHeaders);if(a.callId=this.message.callId,a.cseq=this.message.cseq,a.branch=this.message.branch,this.message.headers.Route&&(a.headers.Route=this.message.headers.Route),t&&a.setHeader("Reason",t),this.transaction.state===o.TransactionState.Proceeding)new e(o.NonInviteClientTransaction,this.core,a);else this.transaction.once("stateChanged",function(){if(s.transaction&&s.transaction.state===o.TransactionState.Proceeding)new e(o.NonInviteClientTransaction,s.core,a)});return a},e.prototype.authenticationGuard=function(e){var t,r,n=e.statusCode;if(!n)throw new Error("Response status code undefined.");if(401!==n&&407!==n)return!0;if(401===n?(t=e.parseHeader("www-authenticate"),r="authorization"):(t=e.parseHeader("proxy-authenticate"),r="proxy-authorization"),!t)return this.logger.warn(n+" with wrong or missing challenge, cannot authenticate"),!0;if(this.challenged&&(this.stale||!0!==t.stale))return this.logger.warn(n+" apparently in authentication loop, cannot authenticate"),!0;if(!this.credentials&&(this.credentials=this.core.configuration.authenticationFactory(),!this.credentials))return this.logger.warn("Unable to obtain credentials, cannot authenticate"),!0;if(!this.credentials.authenticate(this.message,t))return!0;this.challenged=!0,t.stale&&(this.stale=!0);var i=this.message.cseq+=1;return this.message.setHeader("cseq",i+" "+this.message.method),this.message.setHeader(r,this.credentials.toString()),this.init(),!1},e.prototype.receiveResponse=function(e){if(this.authenticationGuard(e)){var t=e.statusCode?e.statusCode.toString():"";if(!t)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(t):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(t):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e});break;case/^2[0-9]{2}$/.test(t):this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e});break;case/^3[0-9]{2}$/.test(t):this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(t):this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error("Invalid status code "+t)}}},e.prototype.init=function(){var e=this,t={loggerFactory:this.loggerFactory,onRequestTimeout:function(){return e.onRequestTimeout()},onStateChange:function(t){t===o.TransactionState.Terminated&&(e.core.userAgentClients.delete(n),r===e._transaction&&e.dispose())},onTransportError:function(t){return e.onTransportError(t)},receiveResponse:function(t){return e.receiveResponse(t)}},r=new this.transactionConstructor(this.message,this.core.transport,t);this._transaction=r;var n=r.id+r.request.method;this.core.userAgentClients.set(n,this)},e.prototype.onRequestTimeout=function(){this.logger.warn("User agent client request timed out. Generating internal 408 Request Timeout.");var e=this.core.configuration.onRequestTimeoutResponseMessageFactory();this.receiveResponse(e)},e.prototype.onTransportError=function(e){this.logger.error(e.message),this.logger.error("User agent client request transport error. Generating internal 503 Service Unavailable.");var t=this.core.configuration.onTransportErrorResponseMessageFactory();this.receiveResponse(t)},e}();t.UserAgentClient=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),s=function(e){function t(t){var r=this.constructor,n=e.call(this,t)||this;return Object.setPrototypeOf(n,r.prototype),n}return i(t,e),t}(Error);t.Exception=s,function(e){var t=function(e){function t(t){return e.call(this,t||"Transaction state error.")||this}return i(t,e),t}(s);e.TransactionStateError=t;var r=function(e){function t(){return e.call(this,"The session description handler has closed.")||this}return i(t,e),t}(s);e.ClosedSessionDescriptionHandlerError=r;var n=function(e){function t(){return e.call(this,"The session has terminated.")||this}return i(t,e),t}(s);e.TerminatedSessionError=n;var o=function(e){function t(t){return e.call(this,t||"Unspecified transport error.")||this}return i(t,e),t}(s);e.TransportError=o;var a=function(e){function t(t){return e.call(this,t||"Unsupported session description content type.")||this}return i(t,e),t}(s);e.UnsupportedSessionDescriptionContentTypeError=a}(t.Exceptions||(t.Exceptions={}));var a=function(e){function t(t,r,n){var i=e.call(this,n)||this;return i.code=t,i.name=r,i.message=n,i}return i(t,e),t}(s);!function(e){var t=function(e){function t(t,r){var n=e.call(this,1,"CONFIGURATION_ERROR",r?"Invalid value "+JSON.stringify(r)+" for parameter '"+t+"'":"Missing parameter: "+t)||this;return n.type=o.TypeStrings.ConfigurationError,n.parameter=t,n.value=r,n}return i(t,e),t}(a);e.ConfigurationError=t;var r=function(e){function t(t){var r=e.call(this,2,"INVALID_STATE_ERROR","Invalid status: "+t)||this;return r.type=o.TypeStrings.InvalidStateError,r.status=t,r}return i(t,e),t}(a);e.InvalidStateError=r;var n=function(e){function t(t){var r=e.call(this,3,"NOT_SUPPORTED_ERROR",t)||this;return r.type=o.TypeStrings.NotSupportedError,r}return i(t,e),t}(a);e.NotSupportedError=n;var s=function(e){function t(t){var r=e.call(this,5,"RENEGOTIATION_ERROR",t)||this;return r.type=o.TypeStrings.RenegotiationError,r}return i(t,e),t}(a);e.RenegotiationError=s;var c=function(e){function t(t,r,n){var i=e.call(this,6,"METHOD_PARAMETER_ERROR",n?"Invalid value "+JSON.stringify(n)+" for parameter '"+r+"'":"Missing parameter: "+r)||this;return i.type=o.TypeStrings.MethodParameterError,i.method=t,i.parameter=r,i.value=n,i}return i(t,e),t}(a);e.MethodParameterError=c;var u=function(e){function t(t,r,n){var i=e.call(this,8,"SESSION_DESCRIPTION_HANDLER_ERROR",n||"Error with Session Description Handler")||this;return i.type=o.TypeStrings.SessionDescriptionHandlerError,i.method=t,i.error=r,i}return i(t,e),t}(a);e.SessionDescriptionHandlerError=u}(t.Exceptions||(t.Exceptions={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(3),a=r(11),c=r(5);t.getSupportedHeader=function(e){var t=[];e.method===o.C.REGISTER?t.push("path","gruu"):e.method===o.C.INVITE&&(e.ua.contact.pubGruu||e.ua.contact.tempGruu)&&t.push("gruu"),e.ua.configuration.rel100===o.C.supported.SUPPORTED&&t.push("100rel"),e.ua.configuration.replaces===o.C.supported.SUPPORTED&&t.push("replaces"),t.push("outbound"),t=t.concat(e.ua.configuration.extraSupported||[]);var r=e.ua.configuration.hackAllowUnregisteredOptionTags||!1,n={};return"Supported: "+(t=t.filter(function(e){var t=o.C.OPTION_TAGS[e],i=!n[e];return n[e]=!0,(t||r)&&i})).join(", ")+"\r\n"};var u=function(){function e(e,t,r,n,i,o){void 0===n&&(n={}),this.type=s.TypeStrings.OutgoingRequest,this.ua=r,this.headers={},this.method=e,this.ruri=t,this.body=o,this.extraHeaders=(i||[]).slice(),n.routeSet?this.setHeader("route",n.routeSet):r.configuration.usePreloadedRoute&&r.transport&&this.setHeader("route",r.transport.server.sipUri),this.setHeader("via",""),this.setHeader("max-forwards","70");var u=n.toUri||t;this.toTag=n.toTag;var d=n.toDisplayName||0===n.toDisplayName?'"'+n.toDisplayName+'" ':"";d+="<"+(u.type===s.TypeStrings.URI?u.toRaw():u)+">",d+=this.toTag?";tag="+this.toTag:"",this.to=a.Grammar.nameAddrHeaderParse(d),this.setHeader("to",d);var h,p=n.fromUri||r.configuration.uri||"";this.fromTag=n.fromTag||c.Utils.newTag(),h=n.fromDisplayName||0===n.fromDisplayName?'"'+n.fromDisplayName+'" ':r.configuration.displayName?'"'+r.configuration.displayName+'" ':"",h+="<"+(p.type===s.TypeStrings.URI?p.toRaw():p)+">;tag=",h+=this.fromTag,this.from=a.Grammar.nameAddrHeaderParse(h),this.setHeader("from",h),this.callId=n.callId||r.configuration.sipjsId+c.Utils.createRandomToken(15),this.setHeader("call-id",this.callId),this.cseq=n.cseq||Math.floor(1e4*Math.random()),this.setHeader("cseq",this.cseq+" "+e)}return e.prototype.getHeader=function(e){var t=this.headers[c.Utils.headerize(e)];if(t){if(t[0])return t[0]}else for(var r=new RegExp("^\\s*"+e+"\\s*:","i"),n=0,i=this.extraHeaders;n<i.length;n++){var o=i[n];if(r.test(o))return o.substring(o.indexOf(":")+1).trim()}},e.prototype.getHeaders=function(e){var t=[],r=this.headers[c.Utils.headerize(e)];if(r)for(var n=0,i=r;n<i.length;n++){var o=i[n];t.push(o)}else for(var s=new RegExp("^\\s*"+e+"\\s*:","i"),a=0,u=this.extraHeaders;a<u.length;a++){var d=u[a];s.test(d)&&t.push(d.substring(d.indexOf(":")+1).trim())}return t},e.prototype.hasHeader=function(e){if(this.headers[c.Utils.headerize(e)])return!0;for(var t=new RegExp("^\\s*"+e+"\\s*:","i"),r=0,n=this.extraHeaders;r<n.length;r++){var i=n[r];if(t.test(i))return!0}return!1},e.prototype.setHeader=function(e,t){this.headers[c.Utils.headerize(e)]=t instanceof Array?t:[t]},e.prototype.setViaHeader=function(e,t){var r="WSS";t.server&&t.server.scheme&&(r=t.server.scheme),this.ua.configuration.hackViaTcp&&(r="TCP");var n="SIP/2.0/"+r;n+=" "+this.ua.configuration.viaHost+";branch="+e,this.ua.configuration.forceRport&&(n+=";rport"),this.setHeader("via",n),this.branch=e},e.prototype.toString=function(){var e="";for(var r in e+=this.method+" "+(this.ruri.type===s.TypeStrings.URI?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n",this.headers)if(this.headers[r])for(var n=0,i=this.headers[r];n<i.length;n++){e+=r+": "+i[n]+"\r\n"}for(var o=0,a=this.extraHeaders;o<a.length;o++){e+=(r=a[o]).trim()+"\r\n"}return e+=t.getSupportedHeader(this),e+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(e+="Content-Length: "+c.Utils.str_utf8_length(this.body)+"\r\n\r\n",e+=this.body):this.body.body&&this.body.contentType?(e+="Content-Type: "+this.body.contentType+"\r\n",e+="Content-Length: "+c.Utils.str_utf8_length(this.body.body)+"\r\n\r\n",e+=this.body.body):e+="Content-Length: 0\r\n\r\n":e+="Content-Length: 0\r\n\r\n",e},e}();t.OutgoingRequest=u;var d=function(){function e(){this.type=s.TypeStrings.IncomingMessage,this.headers={}}return e.prototype.addHeader=function(e,t){var r={raw:t};e=c.Utils.headerize(e),this.headers[e]?this.headers[e].push(r):this.headers[e]=[r]},e.prototype.getHeader=function(e){var t=this.headers[c.Utils.headerize(e)];if(t)return t[0]?t[0].raw:void 0},e.prototype.getHeaders=function(e){var t=this.headers[c.Utils.headerize(e)],r=[];if(!t)return[];for(var n=0,i=t;n<i.length;n++){var o=i[n];r.push(o.raw)}return r},e.prototype.hasHeader=function(e){return!!this.headers[c.Utils.headerize(e)]},e.prototype.parseHeader=function(e,t){if(void 0===t&&(t=0),e=c.Utils.headerize(e),this.headers[e]&&!(t>=this.headers[e].length)){var r=this.headers[e][t],n=r.raw;if(r.parsed)return r.parsed;var i=a.Grammar.parse(n,e.replace(/-/g,"_"));return-1===i?void this.headers[e].splice(t,1):(r.parsed=i,i)}},e.prototype.s=function(e,t){return void 0===t&&(t=0),this.parseHeader(e,t)},e.prototype.setHeader=function(e,t){this.headers[c.Utils.headerize(e)]=[{raw:t}]},e.prototype.toString=function(){return this.data},e}();t.IncomingMessage=d;var h=function(e){function t(t){var r=e.call(this)||this;return r.ua=t,r.type=s.TypeStrings.IncomingRequest,r}return i(t,e),t}(d);t.IncomingRequest=h;var p=function(e){function t(t){var r=e.call(this)||this;return r.ua=t,r.type=s.TypeStrings.IncomingResponse,r.headers={},r}return i(t,e),t}(d);t.IncomingResponse=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(7),i=r(5),o=r(14),s=r(1),a=function(){function e(e,t,r,n){this.transactionConstructor=e,this.core=t,this.message=r,this.delegate=n,this.logger=this.loggerFactory.getLogger("sip.user-agent-server"),this.toTag=r.toTag?r.toTag:i.Utils.newTag(),this.init()}return e.prototype.dispose=function(){this.transaction.dispose()},Object.defineProperty(e.prototype,"loggerFactory",{get:function(){return this.core.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transaction",{get:function(){if(!this._transaction)throw new Error("Transaction undefined.");return this._transaction},enumerable:!0,configurable:!0}),e.prototype.accept=function(e){if(void 0===e&&(e={statusCode:200}),!this.acceptable)throw new n.Exceptions.TransactionStateError(this.message.method+" not acceptable in state "+this.transaction.state+".");var t=e.statusCode;if(t<200||t>299)throw new TypeError("Invalid statusCode: "+t);return this.reply(e)},e.prototype.progress=function(e){if(void 0===e&&(e={statusCode:180}),!this.progressable)throw new n.Exceptions.TransactionStateError(this.message.method+" not progressable in state "+this.transaction.state+".");var t=e.statusCode;if(t<101||t>199)throw new TypeError("Invalid statusCode: "+t);return this.reply(e)},e.prototype.redirect=function(e,t){if(void 0===t&&(t={statusCode:302}),!this.redirectable)throw new n.Exceptions.TransactionStateError(this.message.method+" not redirectable in state "+this.transaction.state+".");var r=t.statusCode;if(r<300||r>399)throw new TypeError("Invalid statusCode: "+r);var i=new Array;return e.forEach(function(e){return i.push("Contact: "+e.toString())}),t.extraHeaders=(t.extraHeaders||[]).concat(i),this.reply(t)},e.prototype.reject=function(e){if(void 0===e&&(e={statusCode:480}),!this.rejectable)throw new n.Exceptions.TransactionStateError(this.message.method+" not rejectable in state "+this.transaction.state+".");var t=e.statusCode;if(t<400||t>699)throw new TypeError("Invalid statusCode: "+t);return this.reply(e)},e.prototype.trying=function(e){if(!this.tryingable)throw new n.Exceptions.TransactionStateError(this.message.method+" not tryingable in state "+this.transaction.state+".");return this.reply({statusCode:100})},e.prototype.receiveCancel=function(e){this.delegate&&this.delegate.onCancel&&this.delegate.onCancel(e)},Object.defineProperty(e.prototype,"acceptable",{get:function(){if(this.transaction instanceof s.InviteServerTransaction)return this.transaction.state===s.TransactionState.Proceeding||this.transaction.state===s.TransactionState.Accepted;if(this.transaction instanceof s.NonInviteServerTransaction)return this.transaction.state===s.TransactionState.Trying||this.transaction.state===s.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"progressable",{get:function(){if(this.transaction instanceof s.InviteServerTransaction)return this.transaction.state===s.TransactionState.Proceeding;if(this.transaction instanceof s.NonInviteServerTransaction)return!1;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"redirectable",{get:function(){if(this.transaction instanceof s.InviteServerTransaction)return this.transaction.state===s.TransactionState.Proceeding;if(this.transaction instanceof s.NonInviteServerTransaction)return this.transaction.state===s.TransactionState.Trying||this.transaction.state===s.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rejectable",{get:function(){if(this.transaction instanceof s.InviteServerTransaction)return this.transaction.state===s.TransactionState.Proceeding;if(this.transaction instanceof s.NonInviteServerTransaction)return this.transaction.state===s.TransactionState.Trying||this.transaction.state===s.TransactionState.Proceeding;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tryingable",{get:function(){if(this.transaction instanceof s.InviteServerTransaction)return this.transaction.state===s.TransactionState.Proceeding;if(this.transaction instanceof s.NonInviteServerTransaction)return this.transaction.state===s.TransactionState.Trying;throw new Error("Unknown transaction type.")},enumerable:!0,configurable:!0}),e.prototype.reply=function(e){e.toTag||100===e.statusCode||(e.toTag=this.toTag),e.userAgent=e.userAgent||this.core.configuration.userAgentHeaderFieldValue;var t=o.constructOutgoingResponse(this.message,e);return this.transaction.receiveResponse(e.statusCode,t.message),t},e.prototype.init=function(){var e=this,t={loggerFactory:this.loggerFactory,onStateChange:function(t){t===s.TransactionState.Terminated&&(e.core.userAgentServers.delete(n),e.dispose())},onTransportError:function(t){e.logger.error(t.message),e.delegate&&e.delegate.onTransportError?e.delegate.onTransportError(t):e.logger.error("User agent server response transport error.")}},r=new this.transactionConstructor(this.message,this.core.transport,t);this._transaction=r;var n=r.id;this.core.userAgentServers.set(r.id,this)},e}();t.UserAgentServer=a},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var i,o,s,a;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function h(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):f(i,i.length)}function l(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,d=f(c,u);for(r=0;r<u;++r)o(d[r],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,o,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):l.call(e,t)},a.prototype.listenerCount=l,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(65);!function(e){e.parse=function(e,t){var r={startRule:t};try{n.parse(e,r)}catch(e){r.data=-1}return r.data},e.nameAddrHeaderParse=function(t){var r=e.parse(t,"Name_Addr_Header");return-1!==r?r:void 0},e.URIParse=function(t){var r=e.parse(t,"SIP_URI");return-1!==r?r:void 0}}(t.Grammar||(t.Grammar={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=500;t.Timers={T1:n,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},function(e,t,r){var n,i,o,s,a,c,u,d;e.exports=(n=r(0),r(25),r(26),o=(i=n).lib,s=o.Base,a=o.WordArray,c=i.algo,u=c.MD5,d=c.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:u,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=r.hasher.create(),i=a.create(),o=i.words,s=r.keySize,c=r.iterations;o.length<s;){u&&n.update(u);var u=n.update(e).finalize(t);n.reset();for(var d=1;d<c;d++)u=n.finalize(u),n.reset();i.concat(u)}return i.sigBytes=4*s,i}}),i.EvpKDF=function(e,t,r){return d.create(r).compute(e,t)},n.EvpKDF)},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(93)),n(r(94))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(2),a=r(3),c=r(8),u=r(5),d=function(e){function t(r,n,i,o){var s=e.call(this)||this;return s.data={},t.initializer(s,r,n,i,o),s}return i(t,e),t.initializer=function(e,t,r,n,i){if(e.type=a.TypeStrings.ClientContext,void 0===n)throw new TypeError("Not enough arguments");e.ua=t,e.logger=t.getLogger("sip.clientcontext"),e.method=r;var o=t.normalizeTarget(n);if(!o)throw new TypeError("Invalid target: "+n);if((i=Object.create(i||Object.prototype)).extraHeaders=(i.extraHeaders||[]).slice(),e.request=new c.OutgoingRequest(e.method,o,e.ua,i.params,i.extraHeaders),i.body){var s={body:i.body,contentType:i.contentType?i.contentType:"application/sdp"};e.body=s,e.request.body=s}e.request.from&&(e.localIdentity=e.request.from),e.request.to&&(e.remoteIdentity=e.request.to)},t.prototype.send=function(){var e=this;return this.ua.userAgentCore.request(this.request,{onAccept:function(t){return e.receiveResponse(t.message)},onProgress:function(t){return e.receiveResponse(t.message)},onRedirect:function(t){return e.receiveResponse(t.message)},onReject:function(t){return e.receiveResponse(t.message)},onTrying:function(t){return e.receiveResponse(t.message)}}),this},t.prototype.receiveResponse=function(e){var t=e.statusCode||0,r=u.Utils.getReasonPhrase(t);switch(!0){case/^1[0-9]{2}$/.test(t.toString()):this.emit("progress",e,r);break;case/^2[0-9]{2}$/.test(t.toString()):this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("accepted",e,r);break;default:this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("rejected",e,r),this.emit("failed",e,r)}},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR)},t}(o.EventEmitter);t.ClientContext=d},function(e,t,r){var n,i,o;e.exports=(n=r(0),o=(i=n).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<r;a++)i.push(n.charAt(s>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var s=r.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function(e,t,r){for(var n=[],i=0,s=0;s<t;s++)if(s%4){var a=r[e.charCodeAt(s-1)]<<s%4*2,c=r[e.charCodeAt(s)]>>>6-s%4*2;n[i>>>2]|=(a|c)<<24-i%4*8,i++}return o.create(n,i)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},function(e,t,r){var n;e.exports=(n=r(0),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,s=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=s.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,s=e[t+0],c=e[t+1],l=e[t+2],f=e[t+3],g=e[t+4],v=e[t+5],m=e[t+6],y=e[t+7],S=e[t+8],T=e[t+9],C=e[t+10],b=e[t+11],_=e[t+12],A=e[t+13],w=e[t+14],E=e[t+15],R=o[0],I=o[1],O=o[2],x=o[3];R=u(R,I,O,x,s,7,a[0]),x=u(x,R,I,O,c,12,a[1]),O=u(O,x,R,I,l,17,a[2]),I=u(I,O,x,R,f,22,a[3]),R=u(R,I,O,x,g,7,a[4]),x=u(x,R,I,O,v,12,a[5]),O=u(O,x,R,I,m,17,a[6]),I=u(I,O,x,R,y,22,a[7]),R=u(R,I,O,x,S,7,a[8]),x=u(x,R,I,O,T,12,a[9]),O=u(O,x,R,I,C,17,a[10]),I=u(I,O,x,R,b,22,a[11]),R=u(R,I,O,x,_,7,a[12]),x=u(x,R,I,O,A,12,a[13]),O=u(O,x,R,I,w,17,a[14]),R=d(R,I=u(I,O,x,R,E,22,a[15]),O,x,c,5,a[16]),x=d(x,R,I,O,m,9,a[17]),O=d(O,x,R,I,b,14,a[18]),I=d(I,O,x,R,s,20,a[19]),R=d(R,I,O,x,v,5,a[20]),x=d(x,R,I,O,C,9,a[21]),O=d(O,x,R,I,E,14,a[22]),I=d(I,O,x,R,g,20,a[23]),R=d(R,I,O,x,T,5,a[24]),x=d(x,R,I,O,w,9,a[25]),O=d(O,x,R,I,f,14,a[26]),I=d(I,O,x,R,S,20,a[27]),R=d(R,I,O,x,A,5,a[28]),x=d(x,R,I,O,l,9,a[29]),O=d(O,x,R,I,y,14,a[30]),R=h(R,I=d(I,O,x,R,_,20,a[31]),O,x,v,4,a[32]),x=h(x,R,I,O,S,11,a[33]),O=h(O,x,R,I,b,16,a[34]),I=h(I,O,x,R,w,23,a[35]),R=h(R,I,O,x,c,4,a[36]),x=h(x,R,I,O,g,11,a[37]),O=h(O,x,R,I,y,16,a[38]),I=h(I,O,x,R,C,23,a[39]),R=h(R,I,O,x,A,4,a[40]),x=h(x,R,I,O,s,11,a[41]),O=h(O,x,R,I,f,16,a[42]),I=h(I,O,x,R,m,23,a[43]),R=h(R,I,O,x,T,4,a[44]),x=h(x,R,I,O,_,11,a[45]),O=h(O,x,R,I,E,16,a[46]),R=p(R,I=h(I,O,x,R,l,23,a[47]),O,x,s,6,a[48]),x=p(x,R,I,O,y,10,a[49]),O=p(O,x,R,I,w,15,a[50]),I=p(I,O,x,R,v,21,a[51]),R=p(R,I,O,x,_,6,a[52]),x=p(x,R,I,O,f,10,a[53]),O=p(O,x,R,I,C,15,a[54]),I=p(I,O,x,R,c,21,a[55]),R=p(R,I,O,x,S,6,a[56]),x=p(x,R,I,O,E,10,a[57]),O=p(O,x,R,I,m,15,a[58]),I=p(I,O,x,R,A,21,a[59]),R=p(R,I,O,x,g,6,a[60]),x=p(x,R,I,O,b,10,a[61]),O=p(O,x,R,I,l,15,a[62]),I=p(I,O,x,R,T,21,a[63]),o[0]=o[0]+R|0,o[1]=o[1]+I|0,o[2]=o[2]+O|0,o[3]=o[3]+x|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),s=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var d=c[u];c[u]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,i,o,s){var a=e+(t&r|~t&n)+i+s;return(a<<o|a>>>32-o)+t}function d(e,t,r,n,i,o,s){var a=e+(t&n|r&~n)+i+s;return(a<<o|a>>>32-o)+t}function h(e,t,r,n,i,o,s){var a=e+(t^r^n)+i+s;return(a<<o|a>>>32-o)+t}function p(e,t,r,n,i,o,s){var a=e+(r^(t|~n))+i+s;return(a<<o|a>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),n.MD5)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),s=function(e){function t(t,r,n){var i=e.call(this,n)||this;if(i.type=o.TypeStrings.NameAddrHeader,!t||t.type!==o.TypeStrings.URI)throw new TypeError('missing or invalid "uri" parameter');return i.uri=t,i._displayName=r,i}return i(t,e),Object.defineProperty(t.prototype,"friendlyName",{get:function(){return this.displayName||this.uri.aor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._displayName},set:function(e){this._displayName=e},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.uri.clone(),this._displayName,JSON.parse(JSON.stringify(this.parameters)))},t.prototype.toString=function(){var e=this.displayName||"0"===this.displayName?'"'+this.displayName+'" ':"";for(var t in e+="<"+this.uri.toString()+">",this.parameters)this.parameters.hasOwnProperty(t)&&(e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]));return e},t}(r(19).Parameters);t.NameAddrHeader=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(3),a=function(){function e(e){for(var t in this.parameters={},this.type=s.TypeStrings.Parameters,e)e.hasOwnProperty(t)&&this.setParam(t,e[t])}return e.prototype.setParam=function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},e.prototype.getParam=function(e){if(e)return this.parameters[e.toLowerCase()]},e.prototype.hasParam=function(e){return!!e&&!!this.parameters.hasOwnProperty(e.toLowerCase())},e.prototype.deleteParam=function(e){if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e)){var t=this.parameters[e];return delete this.parameters[e],t}},e.prototype.clearParams=function(){this.parameters={}},e}();t.Parameters=a;var c=function(e){function t(t,r,n,i,a,c){var u=e.call(this,a)||this;if(u.headers={},u.type=s.TypeStrings.URI,!n)throw new TypeError('missing or invalid "host" parameter');for(var d in t=t||o.C.SIP,c)c.hasOwnProperty(d)&&u.setHeader(d,c[d]);return u.raw={scheme:t,user:r,host:n,port:i},u.normal={scheme:t.toLowerCase(),user:r,host:n.toLowerCase(),port:i},u}return i(t,e),Object.defineProperty(t.prototype,"_normal",{get:function(){return this.normal},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_raw",{get:function(){return this.raw},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scheme",{get:function(){return this.normal.scheme},set:function(e){this.raw.scheme=e,this.normal.scheme=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this.normal.user},set:function(e){this.normal.user=this.raw.user=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this.normal.host},set:function(e){this.raw.host=e,this.normal.host=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aor",{get:function(){return this.normal.user+"@"+this.normal.host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"port",{get:function(){return this.normal.port},set:function(e){this.normal.port=this.raw.port=e},enumerable:!0,configurable:!0}),t.prototype.setHeader=function(e,t){this.headers[this.headerize(e)]=t instanceof Array?t:[t]},t.prototype.getHeader=function(e){if(e)return this.headers[this.headerize(e)]},t.prototype.hasHeader=function(e){return!!e&&!!this.headers.hasOwnProperty(this.headerize(e))},t.prototype.deleteHeader=function(e){if(e=this.headerize(e),this.headers.hasOwnProperty(e)){var t=this.headers[e];return delete this.headers[e],t}},t.prototype.clearHeaders=function(){this.headers={}},t.prototype.clone=function(){return new t(this._raw.scheme,this._raw.user||"",this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},t.prototype.toRaw=function(){return this._toString(this._raw)},t.prototype.toString=function(){return this._toString(this._normal)},t.prototype._toString=function(e){var t=e.scheme+":";for(var r in e.scheme.toLowerCase().match("^sips?$")||(t+="//"),e.user&&(t+=this.escapeUser(e.user)+"@"),t+=e.host,(e.port||0===e.port)&&(t+=":"+e.port),this.parameters)this.parameters.hasOwnProperty(r)&&(t+=";"+r,null!==this.parameters[r]&&(t+="="+this.parameters[r]));var n=[];for(var i in this.headers)if(this.headers.hasOwnProperty(i))for(var o in this.headers[i])this.headers[i].hasOwnProperty(o)&&n.push(i+"="+this.headers[i][o]);return n.length>0&&(t+="?"+n.join("&")),t},t.prototype.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},t.prototype.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),n=r.length,i="",o=0;o<n;o++)0!==o&&(i+="-"),i+=r[o].charAt(0).toUpperCase()+r[o].substring(1);return t[i]&&(i=t[i]),i},t}(a);t.URI=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Accepted="Accepted",e.Calling="Calling",e.Completed="Completed",e.Confirmed="Confirmed",e.Proceeding="Proceeding",e.Terminated="Terminated",e.Trying="Trying"}(t.TransactionState||(t.TransactionState={}))},function(e,t,r){var n,i,o,s,a,c;e.exports=(n=r(0),o=(i=n).lib,s=o.Base,a=o.WordArray,(c=i.x64={}).Word=s.extend({init:function(e,t){this.high=e,this.low=t}}),c.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var i=e[n];r.push(i.high),r.push(i.low)}return a.create(r,this.sigBytes)},clone:function(){for(var e=s.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),n)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(2),a=r(14),c=r(3),u=r(11),d=r(5),h=function(e){function t(r,n){var i=e.call(this)||this;return i.incomingRequest=n,i.data={},t.initializer(i,r,n),i}return i(t,e),t.initializer=function(e,t,r){var n=r.message;if(e.type=c.TypeStrings.ServerContext,e.ua=t,e.logger=t.getLogger("sip.servercontext"),e.request=n,n.body&&(e.body=n.body),n.hasHeader("Content-Type")&&(e.contentType=n.getHeader("Content-Type")),e.method=n.method,e.localIdentity=n.to,e.remoteIdentity=n.from,n.hasHeader("P-Asserted-Identity")){var i=n.getHeader("P-Asserted-Identity");i&&(e.assertedIdentity=u.Grammar.nameAddrHeaderParse(i))}},t.prototype.progress=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||180,e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||200,e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||480,e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||100,n=e.minCode||100,i=e.maxCode||699,o=d.Utils.getReasonPhrase(r,e.reasonPhrase),s=e.extraHeaders||[],c=e.body?a.fromBodyLegacy(e.body):void 0,u=e.events||[];if(r<n||r>i)throw new TypeError("Invalid statusCode: "+r);var h,p={statusCode:r,reasonPhrase:o,extraHeaders:s,body:c},l=r.toString();switch(!0){case/^100$/.test(l):h=this.incomingRequest.trying(p).message;break;case/^1[0-9]{2}$/.test(l):h=this.incomingRequest.progress(p).message;break;case/^2[0-9]{2}$/.test(l):h=this.incomingRequest.accept(p).message;break;case/^3[0-9]{2}$/.test(l):h=this.incomingRequest.redirect([],p).message;break;case/^[4-6][0-9]{2}$/.test(l):h=this.incomingRequest.reject(p).message;break;default:throw new Error("Invalid status code "+r)}return u.forEach(function(e){t.emit(e,h,o)}),this},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR)},t}(o.EventEmitter);t.ServerContext=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);t.AllowedMethods=[n.C.ACK,n.C.BYE,n.C.CANCEL,n.C.INFO,n.C.INVITE,n.C.MESSAGE,n.C.NOTIFY,n.C.OPTIONS,n.C.PRACK,n.C.REFER,n.C.SUBSCRIBE]},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n,i,o,s,a,c,u,d;e.exports=(n=r(0),o=(i=n).lib,s=o.WordArray,a=o.Hasher,c=i.algo,u=[],d=c.SHA1=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],c=0;c<80;c++){if(c<16)u[c]=0|e[t+c];else{var d=u[c-3]^u[c-8]^u[c-14]^u[c-16];u[c]=d<<1|d>>>31}var h=(n<<5|n>>>27)+a+u[c];h+=c<20?1518500249+(i&o|~i&s):c<40?1859775393+(i^o^s):c<60?(i&o|i&s|o&s)-1894007588:(i^o^s)-899497514,a=s,s=o,o=i<<30|i>>>2,i=n,n=h}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),i.SHA1=a._createHelper(d),i.HmacSHA1=a._createHmacHelper(d),n.SHA1)},function(e,t,r){var n,i,o,s,a,c,u;e.exports=(n=r(0),o=(i=n).lib,s=o.Base,a=i.enc,c=a.Utf8,u=i.algo,void(u.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=c.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),s=i.words,a=o.words,u=0;u<r;u++)s[u]^=1549556828,a[u]^=909522486;i.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);t.reset();var n=t.finalize(this._oKey.clone().concat(r));return n}})))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(15),s=r(2),a=r(1),c=r(3),u=r(7),d=r(11),h=r(22),p=r(8),l=function(e){function t(t,r,n,i){void 0===i&&(i={});var o=this;if(void 0===t||void 0===r||void 0===n)throw new TypeError("Not enough arguments");return(o=e.call(this,t,s.C.REFER,r.remoteIdentity.uri.toString(),i)||this).type=c.TypeStrings.ReferClientContext,o.options=i,o.extraHeaders=(o.options.extraHeaders||[]).slice(),o.applicant=r,o.target=o.initReferTo(n),o.ua&&o.extraHeaders.push("Referred-By: <"+o.ua.configuration.uri+">"),o.extraHeaders.push("Contact: "+r.contact),o.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),o.extraHeaders.push("Refer-To: "+o.target),o.errorListener=o.onTransportError.bind(o),t.transport&&t.transport.on("transportError",o.errorListener),o}return i(t,e),t.prototype.refer=function(e){var t=this;void 0===e&&(e={});var r=(this.extraHeaders||[]).slice();return e.extraHeaders&&r.concat(e.extraHeaders),this.applicant.sendRequest(s.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(r){var n=r&&r.statusCode?r.statusCode.toString():"";/^1[0-9]{2}$/.test(n)?t.emit("referRequestProgress",t):/^2[0-9]{2}$/.test(n)?t.emit("referRequestAccepted",t):/^[4-6][0-9]{2}$/.test(n)&&t.emit("referRequestRejected",t),e.receiveResponse&&e.receiveResponse(r)}}),this},t.prototype.receiveNotify=function(e){var t=e.message.hasHeader("Content-Type")?e.message.getHeader("Content-Type"):void 0;if(t&&-1!==t.search(/^message\/sipfrag/)){var r=d.Grammar.parse(e.message.body,"sipfrag");if(-1===r)return void e.reject({statusCode:489,reasonPhrase:"Bad Event"});switch(!0){case/^1[0-9]{2}$/.test(r.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(r.status_code):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return e.accept(),void this.emit("notify",e.message)}e.reject({statusCode:489,reasonPhrase:"Bad Event"})},t.prototype.initReferTo=function(e){var t;if("string"==typeof e){var r=d.Grammar.parse(e,"Refer_To");t=r&&r.uri?r.uri:e;var n=this.ua.normalizeTarget(e);if(!n)throw new TypeError("Invalid target: "+e);t=n}else{if(!e.session)throw new Error("Session undefined.");var i=e.remoteIdentity.friendlyName,o=e.session.remoteTarget.toString(),s=e.session.callId,a=e.session.remoteTag,c=e.session.localTag;t='"'+i+'" <'+o+"?Replaces="+encodeURIComponent(s+";to-tag="+a+";from-tag="+c)+">"}return t},t}(o.ClientContext);t.ReferClientContext=l;var f=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.session=n,i.type=c.TypeStrings.ReferServerContext,i.ua=t,i.status=c.SessionStatus.STATUS_INVITE_RECEIVED,i.fromTag=i.request.fromTag,i.id=i.request.callId+i.fromTag,i.contact=i.ua.contact.toString(),i.logger=t.getLogger("sip.referservercontext",i.id),i.cseq=Math.floor(1e4*Math.random()),i.callId=i.request.callId,i.fromUri=i.request.to.uri,i.fromTag=i.request.to.parameters.tag,i.remoteTarget=i.request.headers.Contact[0].parsed.uri,i.toUri=i.request.from.uri,i.toTag=i.request.fromTag,i.routeSet=i.request.getHeaders("record-route"),i.request.hasHeader("refer-to")?(i.referTo=i.request.parseHeader("refer-to"),i.referredSession=i.ua.findSession(i.request),i.request.hasHeader("referred-by")&&(i.referredBy=i.request.getHeader("referred-by")),i.referTo.uri.hasHeader("replaces")&&(i.replaces=i.referTo.uri.getHeader("replaces")),i.errorListener=i.onTransportError.bind(i),t.transport&&t.transport.on("transportError",i.errorListener),i.status=c.SessionStatus.STATUS_WAITING_FOR_ANSWER,i):(i.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),i.reject(),i)}return i(t,e),t.prototype.progress=function(){if(this.status!==c.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new u.Exceptions.InvalidStateError(this.status);this.incomingRequest.trying()},t.prototype.reject=function(t){if(void 0===t&&(t={}),this.status===c.SessionStatus.STATUS_TERMINATED)throw new u.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=c.SessionStatus.STATUS_TERMINATED,e.prototype.reject.call(this,t),this.emit("referRequestRejected",this)},t.prototype.accept=function(e,t){var r=this;if(void 0===e&&(e={}),this.status!==c.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new u.Exceptions.InvalidStateError(this.status);if(this.status=c.SessionStatus.STATUS_ANSWERED,this.incomingRequest.accept({statusCode:202,reasonPhrase:"Accepted"}),this.emit("referRequestAccepted",this),e.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var n=this.referTo.uri;if(!n.scheme||!n.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var i=e.inviteOptions||{},o=(i.extraHeaders||[]).slice();if(this.replaces&&o.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&o.push("Referred-By: "+this.referredBy),i.extraHeaders=o,n.clearHeaders(),this.targetSession=this.ua.invite(n.toString(),i,t),this.emit("referInviteSent",this),this.targetSession){this.targetSession.once("progress",function(e){var t=e.statusCode||100,n=e.reasonPhrase;r.sendNotify(("SIP/2.0 "+t+" "+n).trim()),r.emit("referProgress",r),r.referredSession&&r.referredSession.emit("referProgress",r)}),this.targetSession.once("accepted",function(){r.logger.log("Successfully followed the refer"),r.sendNotify("SIP/2.0 200 OK"),r.emit("referAccepted",r),r.referredSession&&r.referredSession.emit("referAccepted",r)});var s=function(e){if(r.status!==c.SessionStatus.STATUS_TERMINATED){if(r.logger.log("Refer was not successful. Resuming session"),e&&429===e.statusCode)return r.logger.log("Alerting referrer that identity is required."),void r.sendNotify("SIP/2.0 429 Provide Referrer Identity");r.sendNotify("SIP/2.0 603 Declined"),r.status=c.SessionStatus.STATUS_TERMINATED,r.emit("referRejected",r),r.referredSession&&r.referredSession.emit("referRejected")}};this.targetSession.once("rejected",s),this.targetSession.once("failed",s)}}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)},t.prototype.sendNotify=function(e){if(this.status!==c.SessionStatus.STATUS_ANSWERED)throw new u.Exceptions.InvalidStateError(this.status);if(-1===d.Grammar.parse(e,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");if(this.session)this.session.notify(void 0,{extraHeaders:["Event: refer","Subscription-State: terminated"],body:{contentDisposition:"render",contentType:"message/sipfrag",content:e}});else{var t=new p.OutgoingRequest(s.C.NOTIFY,this.remoteTarget,this.ua,{cseq:this.cseq+=1,callId:this.callId,fromUri:this.fromUri,fromTag:this.fromTag,toUri:this.toUri,toTag:this.toTag,routeSet:this.routeSet},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],e),r=this.ua.transport;if(!r)throw new Error("Transport undefined.");var n={loggerFactory:this.ua.getLoggerFactory()};new a.NonInviteClientTransaction(t,r,n)}},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t}(h.ServerContext);t.ReferServerContext=f},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(r,n,i,o,s){var a=e.call(this,n,i,t.makeId(r),o,s)||this;return a._request=r,a.user=i,r.setViaHeader(a.id,n),a}return i(t,e),t.makeId=function(e){if("CANCEL"===e.method){if(!e.branch)throw new Error("Outgoing CANCEL request without a branch.");return e.branch}return"z9hG4bK"+Math.floor(1e7*Math.random())},Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),t.prototype.onRequestTimeout=function(){this.user.onRequestTimeout&&this.user.onRequestTimeout()},t}(r(29).Transaction);t.ClientTransaction=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(7),a=function(e){function t(t,r,n,i,o){var s=e.call(this)||this;return s._transport=t,s._user=r,s._id=n,s._state=i,s.logger=r.loggerFactory.getLogger(o,n),s.logger.debug("Constructing "+s.typeToString()+" with id "+s.id+"."),s}return i(t,e),t.prototype.dispose=function(){this.logger.debug("Destroyed "+this.typeToString()+" with id "+this.id+".")},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kind",{get:function(){throw new Error("Invalid kind.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transport",{get:function(){return this._transport},enumerable:!0,configurable:!0}),t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.logTransportError=function(e,t){this.logger.error(e.message),this.logger.error("Transport error occurred in "+this.typeToString()+" with id "+this.id+"."),this.logger.error(t)},t.prototype.send=function(e){var t=this;return this.transport.send(e).catch(function(e){var r;if(!(e instanceof s.Exceptions.TransportError))throw r=e&&"string"==typeof e.message?new s.Exceptions.TransportError(e.message):new s.Exceptions.TransportError,t.onTransportError(r),r;t.onTransportError(e)})},t.prototype.setState=function(e){this.logger.debug('State change to "'+e+'" on '+this.typeToString()+" with id "+this.id+"."),this._state=e,this._user.onStateChange&&this._user.onStateChange(e),this.emit("stateChanged")},t.prototype.typeToString=function(){return"UnknownType"},t}(o.EventEmitter);t.Transaction=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r,n,i,o){var s=e.call(this,r,n,t.viaBranch,i,o)||this;return s._request=t,s.user=n,s}return i(t,e),Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),t}(r(29).Transaction);t.ServerTransaction=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(95))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(97))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(18),o=function(){function e(e,t){this.core=e,this.dialogState=t,this.core.dialogs.set(this.id,this)}return e.initialDialogStateForUserAgentClient=function(e,t){var r=t.getHeaders("record-route").reverse(),n=t.parseHeader("contact");if(!n)throw new Error("Contact undefined.");if(!(n instanceof i.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var o=n.uri,s=e.cseq,a=e.callId,c=e.fromTag,u=t.toTag;if(!a)throw new Error("Call id undefined.");if(!c)throw new Error("From tag undefined.");if(!u)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");var d=e.from.uri,h=e.to.uri;if(!t.statusCode)throw new Error("Incoming response status code undefined.");return{id:a+c+u,early:t.statusCode<200,callId:a,localTag:c,remoteTag:u,localSequenceNumber:s,remoteSequenceNumber:void 0,localURI:d,remoteURI:h,remoteTarget:o,routeSet:r,secure:!1}},e.initialDialogStateForUserAgentServer=function(e,t,r){void 0===r&&(r=!1);var n=e.getHeaders("record-route"),o=e.parseHeader("contact");if(!o)throw new Error("Contact undefined.");if(!(o instanceof i.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var s=o.uri,a=e.cseq,c=e.callId,u=t,d=e.fromTag,h=e.from.uri;return{id:c+u+d,early:r,callId:c,localTag:u,remoteTag:d,localSequenceNumber:void 0,remoteSequenceNumber:a,localURI:e.to.uri,remoteURI:h,remoteTarget:s,routeSet:n,secure:!1}},e.prototype.dispose=function(){this.core.dialogs.delete(this.id)},Object.defineProperty(e.prototype,"id",{get:function(){return this.dialogState.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"early",{get:function(){return this.dialogState.early},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"callId",{get:function(){return this.dialogState.callId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localTag",{get:function(){return this.dialogState.localTag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteTag",{get:function(){return this.dialogState.remoteTag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localSequenceNumber",{get:function(){return this.dialogState.localSequenceNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteSequenceNumber",{get:function(){return this.dialogState.remoteSequenceNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localURI",{get:function(){return this.dialogState.localURI},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteURI",{get:function(){return this.dialogState.remoteURI},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remoteTarget",{get:function(){return this.dialogState.remoteTarget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"routeSet",{get:function(){return this.dialogState.routeSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secure",{get:function(){return this.dialogState.secure},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"userAgentCore",{get:function(){return this.core},enumerable:!0,configurable:!0}),e.prototype.confirm=function(){this.dialogState.early=!1},e.prototype.receiveRequest=function(e){if(e.method!==n.C.ACK){if(this.remoteSequenceNumber){if(e.cseq<=this.remoteSequenceNumber)throw new Error("Out of sequence in dialog request. Did you forget to call sequenceGuard()?");this.dialogState.remoteSequenceNumber=e.cseq}this.remoteSequenceNumber||(this.dialogState.remoteSequenceNumber=e.cseq)}},e.prototype.recomputeRouteSet=function(e){this.dialogState.routeSet=e.getHeaders("record-route").reverse()},e.prototype.createOutgoingRequestMessage=function(e,t){var r,n=this.remoteURI,i=this.remoteTag,o=this.localURI,s=this.localTag,a=this.callId;r=t&&t.cseq?t.cseq:this.dialogState.localSequenceNumber?this.dialogState.localSequenceNumber+=1:this.dialogState.localSequenceNumber=1;var c=this.remoteTarget,u=this.routeSet,d=t&&t.extraHeaders,h=t&&t.body?{contentType:t.body.contentType,body:t.body.content}:void 0;return this.core.configuration.outgoingRequestMessageFactory(e,c,{callId:a,cseq:r,fromUri:o,fromTag:s,toUri:n,toTag:i,routeSet:u},d,h)},e.prototype.sequenceGuard=function(e){return e.method===n.C.ACK||(!(this.remoteSequenceNumber&&e.cseq<=this.remoteSequenceNumber)||(this.core.replyStateless(e,{statusCode:500}),!1))},e}();t.Dialog=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){var i=void 0!==t.userAgentCore?t.userAgentCore:t;return e.call(this,o.NonInviteServerTransaction,i,r,n)||this}return i(t,e),t}(r(9).UserAgentServer);t.NotifyUserAgentServer=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){for(var r,n=[],i=e.split(/\r\n/),o=0;o<i.length;){var s=i[o];if(/^m=(?:audio|video)/.test(s))r={index:o,stripped:[]},n.push(r);else if(r){var a=/^a=rtpmap:(\d+) ([^\/]+)\//.exec(s);if(a&&t===a[2]){i.splice(o,1),r.stripped.push(a[1]);continue}}o++}for(var c=0,u=n;c<u.length;c++){for(var d=u[c],h=i[d.index].split(" "),p=3;p<h.length;)-1===d.stripped.indexOf(h[p])?p++:h.splice(p,1);i[d.index]=h.join(" ")}return i.join("\r\n")},i=function(e,t){var r=new RegExp("m="+t+".*$","gm"),n=new RegExp("^a=group:.*$","gm");if(r.test(e)){var i,o=(e=e.split(/^m=/gm).filter(function(e){if(e.substr(0,t.length)===t){if(i=e.match(/^a=mid:.*$/gm)){var r=i[0].match(/:.+$/g);r&&(i=r[0].substr(1))}return!1}return!0}).join("m=")).match(n);if(o&&1===o.length){var s=o[0],a=new RegExp(" *"+i+"[^ ]*","g");s=s.replace(a,""),e=e.split(n).join(s)}}return e};t.stripTcpCandidates=function(e){return e.sdp=(e.sdp||"").replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),Promise.resolve(e)},t.stripTelephoneEvent=function(e){return e.sdp=n(e.sdp||"","telephone-event"),Promise.resolve(e)},t.cleanJitsiSdpImageattr=function(e){return e.sdp=(e.sdp||"").replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),Promise.resolve(e)},t.stripG722=function(e){return e.sdp=n(e.sdp||"","G722"),Promise.resolve(e)},t.stripRtpPayload=function(e){return function(t){return t.sdp=n(t.sdp||"",e),Promise.resolve(t)}},t.stripVideo=function(e){return e.sdp=i(e.sdp||"","video"),Promise.resolve(e)},t.addMidLines=function(e){var t=e.sdp||"";if(-1===t.search(/^a=mid.*$/gm)){var r=t.match(/^m=.*$/gm),n=t.split(/^m=.*$/gm);r&&r.forEach(function(e,t){r[t]=e+"\na=mid:"+t}),n.forEach(function(e,t){r&&r[t]&&(n[t]=e+r[t])}),t=n.join(""),e.sdp=t}return Promise.resolve(e)}},function(e){e.exports={name:"sip.js",title:"SIP.js",description:"A simple, intuitive, and powerful JavaScript signaling library",version:"0.14.0",license:"MIT",main:"./lib/index.js",types:"./lib/index.d.ts",homepage:"https://sipjs.com",author:"OnSIP <developer@onsip.com> (https://sipjs.com/aboutus/)",contributors:[{url:"https://github.com/onsip/SIP.js/blob/master/THANKS.md"}],repository:{type:"git",url:"https://github.com/onsip/SIP.js.git"},keywords:["sip","webrtc","library","websocket","javascript","typescript"],dependencies:{"crypto-js":"^3.1.9-1"},devDependencies:{"@types/crypto-js":"^3.1.43","@types/jasmine":"^3.3.11","@types/node":"^12.0.2","circular-dependency-plugin":"^5.0.2","jasmine-core":"^3.4.0",karma:"^4.1.0","karma-chrome-launcher":"^2.2.0","karma-cli":"^2.0.0","karma-jasmine":"^2.0.1","karma-jasmine-html-reporter":"^1.4.2","karma-mocha-reporter":"^2.2.5","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^3.0.5",pegjs:"^0.10.0","ts-loader":"^6.0.1","ts-pegjs":"0.2.3",tslint:"^5.16.0",typescript:"^3.4.5",webpack:"^4.32.0","webpack-cli":"^3.3.2"},engines:{node:">=8.0"},scripts:{prebuild:"tslint -p tsconfig-base.json -c tslint.json","generate-grammar":"node build/grammarGenerator.js","build-reg-bundle":"webpack --progress --config build/webpack.config.js --env.buildType reg","build-min-bundle":"webpack --progress --config build/webpack.config.js --env.buildType min","build-bundles":"npm run build-reg-bundle && npm run build-min-bundle","build-lib":"tsc -p src","build-test":"tsc -p test","copy-dist-files":"cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js dist/sip-$npm_package_version.min.js",build:"npm run generate-grammar && npm run build-lib && npm run build-reg-bundle && npm run build-min-bundle && npm run copy-dist-files",browserTest:"npm run build-test && sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run",commandLineTest:"npm run build-test && karma start --reporters mocha --browsers ChromeHeadless --single-run",buildAndTest:"npm run build && npm run commandLineTest",buildAndBrowserTest:"npm run build && npm run browserTest"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(66),i=r(3),o=r(5),s=function(){function e(e){this.type=i.TypeStrings.DigestAuthentication,this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.nc=0,this.ncHex="00000000"}return e.prototype.authenticate=function(e,t,r){if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn("challenge with Digest algorithm different than 'MD5', authentication aborted"),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return this.logger.warn("challenge without Digest qop different than 'auth' or 'auth-int', authentication aborted"),!1;this.qop="auth-int"}else this.qop=void 0;return this.method=e.method,this.uri=e.ruri,this.cnonce=o.Utils.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(r),!0},e.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},e.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},e.prototype.calculateResponse=function(e){var t,r=n.MD5(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(t=n.MD5(this.method+":"+this.uri),this.response=n.MD5(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=n.MD5(this.method+":"+this.uri+":"+n.MD5(e||"")),this.response=n.MD5(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):void 0===this.qop&&(t=n.MD5(this.method+":"+this.uri),this.response=n.MD5(r+":"+this.nonce+":"+t))},e}();t.DigestAuthentication=s},function(e,t,r){var n;e.exports=(n=r(0),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,s=t.algo,a=[],c=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)t(n)&&(i<8&&(a[i]=r(e.pow(n,.5))),c[i]=r(e.pow(n,1/3)),i++),n++}();var u=[],d=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],d=r[5],h=r[6],p=r[7],l=0;l<64;l++){if(l<16)u[l]=0|e[t+l];else{var f=u[l-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,v=u[l-2],m=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;u[l]=g+u[l-7]+m+u[l-16]}var y=n&i^n&o^i&o,S=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),T=p+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&h)+c[l]+u[l];p=h,h=d,d=a,a=s+T|0,s=o,o=i,i=n,n=T+(S+y)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+s|0,r[4]=r[4]+a|0,r[5]=r[5]+d|0,r[6]=r[6]+h|0,r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=e.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(d),t.HmacSHA256=o._createHmacHelper(d)}(Math),n.SHA256)},function(e,t,r){var n;e.exports=(n=r(0),r(21),function(){var e=n,t=e.lib.Hasher,r=e.x64,i=r.Word,o=r.WordArray,s=e.algo;function a(){return i.create.apply(i,arguments)}var c=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=a()}();var d=s.SHA512=t.extend({_doReset:function(){this._hash=new o.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],s=r[3],a=r[4],d=r[5],h=r[6],p=r[7],l=n.high,f=n.low,g=i.high,v=i.low,m=o.high,y=o.low,S=s.high,T=s.low,C=a.high,b=a.low,_=d.high,A=d.low,w=h.high,E=h.low,R=p.high,I=p.low,O=l,x=f,P=g,N=v,D=m,U=y,H=S,k=T,M=C,q=b,j=_,L=A,F=w,B=E,G=R,W=I,z=0;z<80;z++){var K=u[z];if(z<16)var V=K.high=0|e[t+2*z],Y=K.low=0|e[t+2*z+1];else{var $=u[z-15],X=$.high,J=$.low,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^X>>>7,Z=(J>>>1|X<<31)^(J>>>8|X<<24)^(J>>>7|X<<25),ee=u[z-2],te=ee.high,re=ee.low,ne=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,ie=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),oe=u[z-7],se=oe.high,ae=oe.low,ce=u[z-16],ue=ce.high,de=ce.low;V=(V=(V=Q+se+((Y=Z+ae)>>>0<Z>>>0?1:0))+ne+((Y+=ie)>>>0<ie>>>0?1:0))+ue+((Y+=de)>>>0<de>>>0?1:0),K.high=V,K.low=Y}var he,pe=M&j^~M&F,le=q&L^~q&B,fe=O&P^O&D^P&D,ge=x&N^x&U^N&U,ve=(O>>>28|x<<4)^(O<<30|x>>>2)^(O<<25|x>>>7),me=(x>>>28|O<<4)^(x<<30|O>>>2)^(x<<25|O>>>7),ye=(M>>>14|q<<18)^(M>>>18|q<<14)^(M<<23|q>>>9),Se=(q>>>14|M<<18)^(q>>>18|M<<14)^(q<<23|M>>>9),Te=c[z],Ce=Te.high,be=Te.low,_e=G+ye+((he=W+Se)>>>0<W>>>0?1:0),Ae=me+ge;G=F,W=B,F=j,B=L,j=M,L=q,M=H+(_e=(_e=(_e=_e+pe+((he+=le)>>>0<le>>>0?1:0))+Ce+((he+=be)>>>0<be>>>0?1:0))+V+((he+=Y)>>>0<Y>>>0?1:0))+((q=k+he|0)>>>0<k>>>0?1:0)|0,H=D,k=U,D=P,U=N,P=O,N=x,O=_e+(ve+fe+(Ae>>>0<me>>>0?1:0))+((x=he+Ae|0)>>>0<he>>>0?1:0)|0}f=n.low=f+x,n.high=l+O+(f>>>0<x>>>0?1:0),v=i.low=v+N,i.high=g+P+(v>>>0<N>>>0?1:0),y=o.low=y+U,o.high=m+D+(y>>>0<U>>>0?1:0),T=s.low=T+k,s.high=S+H+(T>>>0<k>>>0?1:0),b=a.low=b+q,a.high=C+M+(b>>>0<q>>>0?1:0),A=d.low=A+L,d.high=_+j+(A>>>0<L>>>0?1:0),E=h.low=E+B,h.high=w+F+(E>>>0<B>>>0?1:0),I=p.low=I+W,p.high=R+G+(I>>>0<W>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(d),e.HmacSHA512=t._createHmacHelper(d)}(),n.SHA512)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(3);!function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e[e.debug=3]="debug"}(n=t.Levels||(t.Levels={}));var o=function(){function e(){this.builtinEnabled=!0,this._level=n.log,this.loggers={},this.type=i.TypeStrings.LoggerFactory,this.logger=this.getLogger("sip:loggerfactory")}return Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(e){e>=0&&e<=3?this._level=e:e>3?this._level=3:n.hasOwnProperty(e)?this._level=e:this.logger.error("invalid 'level' parameter value: "+JSON.stringify(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connector",{get:function(){return this._connector},set:function(e){e?"function"==typeof e?this._connector=e:this.logger.error("invalid 'connector' parameter value: "+JSON.stringify(e)):this._connector=void 0},enumerable:!0,configurable:!0}),e.prototype.getLogger=function(e,t){if(t&&3===this.level)return new s(this,e,t);if(this.loggers[e])return this.loggers[e];var r=new s(this,e);return this.loggers[e]=r,r},e.prototype.genericLog=function(e,t,r,i){this.level>=e&&this.builtinEnabled&&this.print(e,t,r,i),this.connector&&this.connector(n[e],t,r,i)},e.prototype.print=function(e,t,r,i){if("string"==typeof i){var o=[new Date,t];r&&o.push(r),i=o.concat(i).join(" | ")}switch(e){case n.error:console.error(i);break;case n.warn:console.warn(i);break;case n.log:console.log(i);break;case n.debug:console.debug(i)}},e}();t.LoggerFactory=o;var s=function(){function e(e,t,r){this.type=i.TypeStrings.Logger,this.logger=e,this.category=t,this.label=r}return e.prototype.error=function(e){this.genericLog(n.error,e)},e.prototype.warn=function(e){this.genericLog(n.warn,e)},e.prototype.log=function(e){this.genericLog(n.log,e)},e.prototype.debug=function(e){this.genericLog(n.debug,e)},e.prototype.genericLog=function(e,t){this.logger.genericLog(e,this.category,this.label,t)},e}();t.Logger=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=r(11),o=r(8);!function(e){function t(e,t){var r=t,n=0,i=0;if(e.substring(r,r+2).match(/(^\r\n)/))return-2;for(;0===n;){if(-1===(i=e.indexOf("\r\n",r)))return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?r=i+2:n=i}return n}function r(e,t,r,o){var s,a=t.indexOf(":",r),c=t.substring(r,a).trim(),u=t.substring(a+1,o).trim();switch(c.toLowerCase()){case"via":case"v":e.addHeader("via",u),1===e.getHeaders("via").length?(s=e.parseHeader("Via"))&&(e.via=s,e.viaBranch=s.branch):s=0;break;case"from":case"f":e.setHeader("from",u),(s=e.parseHeader("from"))&&(e.from=s,e.fromTag=s.getParam("tag"));break;case"to":case"t":e.setHeader("to",u),(s=e.parseHeader("to"))&&(e.to=s,e.toTag=s.getParam("tag"));break;case"record-route":if(-1===(s=i.Grammar.parse(u,"Record_Route"))){s=void 0;break}for(var d in s)s[d]&&(e.addHeader("record-route",u.substring(s[d].position,s[d].offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=s[d].parsed);break;case"call-id":case"i":e.setHeader("call-id",u),(s=e.parseHeader("call-id"))&&(e.callId=u);break;case"contact":case"m":if(-1===(s=i.Grammar.parse(u,"Contact"))){s=void 0;break}if(!(s instanceof Array)){s=void 0;break}s.forEach(function(t){e.addHeader("contact",u.substring(t.position,t.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=t.parsed});break;case"content-length":case"l":e.setHeader("content-length",u),s=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",u),s=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",u),(s=e.parseHeader("cseq"))&&(e.cseq=s.value),e.type===n.TypeStrings.IncomingResponse&&(e.method=s.method);break;case"max-forwards":e.setHeader("max-forwards",u),s=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",u),s=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",u),s=e.parseHeader("proxy-authenticate");break;case"refer-to":case"r":e.setHeader("refer-to",u),(s=e.parseHeader("refer-to"))&&(e.referTo=s);break;default:e.setHeader(c,u),s=0}return void 0!==s||{error:"error parsing header '"+c+"'"}}e.getHeader=t,e.parseHeader=r,e.parseMessage=function(e,n){var s=0,a=e.indexOf("\r\n"),c=n.getLogger("sip.parser");if(-1!==a){var u,d=e.substring(0,a),h=i.Grammar.parse(d,"Request_Response");if(-1!==h){var p;for(h.status_code?((u=new o.IncomingResponse(n)).statusCode=h.status_code,u.reasonPhrase=h.reason_phrase):((u=new o.IncomingRequest(n)).method=h.method,u.ruri=h.uri),u.data=e,s=a+2;;){if(-2===(a=t(e,s))){p=s+2;break}if(-1===a)return void c.error("malformed message");if(!0!==r(u,e,s,a))return void c.error(h.error);s=a+2}return u.hasHeader("content-length")?u.body=e.substr(p,Number(u.getHeader("content-length"))):u.body=e.substring(p),u}c.warn('error parsing first line of SIP message: "'+d+'"')}else c.warn("no CRLF found, not a SIP message, discarded")}}(t.Parser||(t.Parser={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(15),s=r(2),a=r(3),c=r(7),u=r(8),d=r(5),h=function(e){function t(t,r,n,i){void 0===i&&(i={});var o=this;if(i.extraHeaders=(i.extraHeaders||[]).slice(),i.contentType=i.contentType||"text/plain","number"!=typeof i.expires||i.expires%1!=0?i.expires=3600:i.expires=Number(i.expires),"boolean"!=typeof i.unpublishOnClose&&(i.unpublishOnClose=!0),null==r||""===r)throw new c.Exceptions.MethodParameterError("Publish","Target",r);if(void 0===(r=t.normalizeTarget(r)))throw new c.Exceptions.MethodParameterError("Publish","Target",r);if((o=e.call(this,t,s.C.PUBLISH,r,i)||this).type=a.TypeStrings.PublishContext,o.options=i,o.target=r,null==n||""===n)throw new c.Exceptions.MethodParameterError("Publish","Event",n);return o.event=n,o.logger=t.getLogger("sip.publish"),o.pubRequestExpires=o.options.expires,t.on("transportCreated",function(e){e.on("transportError",function(){return o.onTransportError()})}),o}return i(t,e),t.prototype.publish=function(e){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.options.body=e,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this),this.sendPublishRequest()},t.prototype.unpublish=function(){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,void 0!==this.pubRequestEtag&&this.sendPublishRequest()},t.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},t.prototype.onRequestTimeout=function(){e.prototype.onRequestTimeout.call(this),this.emit("unpublished",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){e.prototype.onTransportError.call(this),this.emit("unpublished",void 0,s.C.causes.CONNECTION_ERROR)},t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode||0,n=d.Utils.getReasonPhrase(r);switch(!0){case/^1[0-9]{2}$/.test(r.toString()):this.emit("progress",e,n);break;case/^2[0-9]{2}$/.test(r.toString()):if(e.hasHeader("SIP-ETag")?this.pubRequestEtag=e.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),e.hasHeader("Expires")){var i=Number(e.getHeader("Expires"));"number"==typeof i&&i>=0&&i<=this.pubRequestExpires?this.pubRequestExpires=i:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH")}else this.logger.warn("Expires header missing in a 200-class response to PUBLISH");0!==this.pubRequestExpires?(this.publishRefreshTimer=setTimeout(function(){return t.refreshRequest()},900*this.pubRequestExpires),this.emit("published",e,n)):this.emit("unpublished",e,n);break;case/^412$/.test(r.toString()):void 0!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=void 0,this.emit("progress",e,n),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,n),this.emit("unpublished",e,n));break;case/^423$/.test(r.toString()):if(0!==this.pubRequestExpires&&e.hasHeader("Min-Expires")){var o=Number(e.getHeader("Min-Expires"));"number"==typeof o||o>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=o,this.emit("progress",e,n),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",e,n),this.emit("unpublished",e,n))}else this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,n),this.emit("unpublished",e,n);break;default:this.pubRequestExpires=0,this.emit("failed",e,n),this.emit("unpublished",e,n)}0===this.pubRequestExpires&&(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestEtag=void 0)},t.prototype.send=function(){var e=this;return this.ua.userAgentCore.publish(this.request,{onAccept:function(t){return e.receiveResponse(t.message)},onProgress:function(t){return e.receiveResponse(t.message)},onRedirect:function(t){return e.receiveResponse(t.message)},onReject:function(t){return e.receiveResponse(t.message)},onTrying:function(t){return e.receiveResponse(t.message)}}),this},t.prototype.refreshRequest=function(){if(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,void 0===this.pubRequestEtag)throw new c.Exceptions.MethodParameterError("Publish","Body",void 0);if(0===this.pubRequestExpires)throw new c.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires);this.sendPublishRequest()},t.prototype.sendPublishRequest=function(){var e=Object.create(this.options||Object.prototype);e.extraHeaders=(this.options.extraHeaders||[]).slice(),e.extraHeaders.push("Event: "+this.event),e.extraHeaders.push("Expires: "+this.pubRequestExpires),void 0!==this.pubRequestEtag&&e.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag),this.request=new u.OutgoingRequest(s.C.PUBLISH,this.target,this.ua,this.options.params,e.extraHeaders),void 0!==this.pubRequestBody&&(this.request.body={body:this.pubRequestBody,contentType:this.options.contentType}),this.send()},t}(o.ClientContext);t.PublishContext=h},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(12),s=r(28),a=r(20),c=function(e){function t(t,r,n){var i=e.call(this,t,r,n,a.TransactionState.Calling,"sip.transaction.ict")||this;return i.ackRetransmissionCache=new Map,i.B=setTimeout(function(){return i.timer_B()},o.Timers.TIMER_B),i.send(t.toString()).catch(function(e){i.logTransportError(e,"Failed to send initial outgoing request.")}),i}return i(t,e),t.prototype.dispose=function(){this.B&&(clearTimeout(this.B),this.B=void 0),this.D&&(clearTimeout(this.D),this.D=void 0),this.M&&(clearTimeout(this.M),this.M=void 0),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"kind",{get:function(){return"ict"},enumerable:!0,configurable:!0}),t.prototype.ackResponse=function(e){var t=this,r=e.toTag;if(!r)throw new Error("To tag undefined.");var n="z9hG4bK"+Math.floor(1e7*Math.random());e.setViaHeader(n,this.transport),this.ackRetransmissionCache.set(r,e),this.send(e.toString()).catch(function(e){t.logTransportError(e,"Failed to send ACK to 2xx response.")})},t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode;if(!r||r<100||r>699)throw new Error("Invalid status code "+r);switch(this.state){case a.TransactionState.Calling:if(r>=100&&r<=199)return this.stateTransition(a.TransactionState.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=200&&r<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(a.TransactionState.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=300&&r<=699)return this.stateTransition(a.TransactionState.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case a.TransactionState.Proceeding:if(r>=100&&r<=199)return void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=200&&r<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(a.TransactionState.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=300&&r<=699)return this.stateTransition(a.TransactionState.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case a.TransactionState.Accepted:if(r>=200&&r<=299){if(!this.ackRetransmissionCache.has(e.toTag))return this.ackRetransmissionCache.set(e.toTag,void 0),void(this.user.receiveResponse&&this.user.receiveResponse(e));var n=this.ackRetransmissionCache.get(e.toTag);return n?void this.send(n.toString()).catch(function(e){t.logTransportError(e,"Failed to send retransmission of ACK to 2xx response.")}):void 0}break;case a.TransactionState.Completed:if(r>=300&&r<=699)return void this.ack(e);break;case a.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var i="Received unexpected "+r+" response while in state "+this.state+".";this.logger.warn(i)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(a.TransactionState.Terminated,!0)},t.prototype.typeToString=function(){return"INVITE client transaction"},t.prototype.ack=function(e){var t=this,r=this.request.ruri,n=this.request.callId,i=this.request.cseq,o=this.request.getHeader("from"),s=e.getHeader("to"),a=this.request.getHeader("via"),c=this.request.getHeader("route");if(!o)throw new Error("From undefined.");if(!s)throw new Error("To undefined.");if(!a)throw new Error("Via undefined.");var u="ACK "+r+" SIP/2.0\r\n";c&&(u+="Route: "+c+"\r\n"),u+="Via: "+a+"\r\n",u+="To: "+s+"\r\n",u+="From: "+o+"\r\n",u+="Call-ID: "+n+"\r\n",u+="CSeq: "+i+" ACK\r\n",u+="Max-Forwards: 70\r\n",u+="Content-Length: 0\r\n\r\n",this.send(u).catch(function(e){t.logTransportError(e,"Failed to send ACK to non-2xx response.")})},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var n=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case a.TransactionState.Calling:n();break;case a.TransactionState.Proceeding:this.state!==a.TransactionState.Calling&&n();break;case a.TransactionState.Accepted:case a.TransactionState.Completed:this.state!==a.TransactionState.Calling&&this.state!==a.TransactionState.Proceeding&&n();break;case a.TransactionState.Terminated:this.state!==a.TransactionState.Calling&&this.state!==a.TransactionState.Accepted&&this.state!==a.TransactionState.Completed&&(t||n());break;default:n()}this.B&&(clearTimeout(this.B),this.B=void 0),a.TransactionState.Proceeding,e===a.TransactionState.Completed&&(this.D=setTimeout(function(){return r.timer_D()},o.Timers.TIMER_D)),e===a.TransactionState.Accepted&&(this.M=setTimeout(function(){return r.timer_M()},o.Timers.TIMER_M)),e===a.TransactionState.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_A=function(){},t.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id+"."),this.state===a.TransactionState.Calling&&(this.onRequestTimeout(),this.stateTransition(a.TransactionState.Terminated))},t.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id+"."),this.state===a.TransactionState.Completed&&this.stateTransition(a.TransactionState.Terminated)},t.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id+"."),this.state===a.TransactionState.Accepted&&this.stateTransition(a.TransactionState.Terminated)},t}(s.ClientTransaction);t.InviteClientTransaction=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=r(15),a=r(2),c=r(3),u=r(7),d=r(11),h=r(5);function p(e){var t={expires:600,extraContactHeaderParams:[],instanceId:void 0,params:{},regId:void 0,registrar:void 0},r={mandatory:{},optional:{expires:function(e){if(h.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},extraContactHeaderParams:function(e){if(e instanceof Array)return e.filter(function(e){return"string"==typeof e})},instanceId:function(e){if("string"==typeof e)return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===d.Grammar.parse(e,"uuid")?void 0:e},params:function(e){if("object"==typeof e)return e},regId:function(e){if(h.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},registrar:function(e){if("string"==typeof e){/^sip:/i.test(e)||(e=a.C.SIP+":"+e);var t=d.Grammar.URIParse(e);return t?t.user?void 0:t:void 0}}}};for(var n in r.mandatory){if(!e.hasOwnProperty(n))throw new u.Exceptions.ConfigurationError(n);var i=e[n];if(void 0===(o=r.mandatory[n](i)))throw new u.Exceptions.ConfigurationError(n,i);t[n]=o}for(var n in r.optional)if(e.hasOwnProperty(n)){var o;if((i=e[n])instanceof Array&&0===i.length)continue;if(null===i||""===i||void 0===i||"number"==typeof i&&isNaN(i))continue;if(void 0===(o=r.optional[n](i)))throw new u.Exceptions.ConfigurationError(n,i);t[n]=o}return t}var l=function(e){function t(t,r){void 0===r&&(r={});var n=this,i=p(r);if(i.regId&&!i.instanceId?i.instanceId=h.Utils.newUUID():!i.regId&&i.instanceId&&(i.regId=1),i.params.toUri=i.params.toUri||t.configuration.uri,i.params.toDisplayName=i.params.toDisplayName||t.configuration.displayName,i.params.callId=i.params.callId||h.Utils.createRandomToken(22),i.params.cseq=i.params.cseq||Math.floor(1e4*Math.random()),!i.registrar){var o={};"object"==typeof t.configuration.uri?(o=t.configuration.uri.clone()).user=void 0:o=t.configuration.uri,i.registrar=o}for(var s in(n=e.call(this,t,a.C.REGISTER,i.registrar,i)||this).type=c.TypeStrings.RegisterContext,n.options=i,n.logger=t.getLogger("sip.registercontext"),n.logger.log("configuration parameters for RegisterContext after validation:"),i)i.hasOwnProperty(s)&&n.logger.log("\xb7 "+s+": "+JSON.stringify(i[s]));return n.expires=i.expires,n.contact=t.contact.toString(),n.registered=!1,t.on("transportCreated",function(e){e.on("disconnected",function(){return n.onTransportDisconnected()})}),n}return i(t,e),t.prototype.register=function(e){var t=this;void 0===e&&(e={}),this.options=o({},this.options,e);var r=(this.options.extraHeaders||[]).slice();r.push("Contact: "+this.generateContactHeader(this.expires)),r.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(e){if(e.cseq===t.request.cseq){void 0!==t.registrationTimer&&(clearTimeout(t.registrationTimer),t.registrationTimer=void 0);var r=(e.statusCode||0).toString();switch(!0){case/^1[0-9]{2}$/.test(r):t.emit("progress",e);break;case/^2[0-9]{2}$/.test(r):t.emit("accepted",e);var n=void 0;e.hasHeader("expires")&&(n=Number(e.getHeader("expires"))),void 0!==t.registrationExpiredTimer&&(clearTimeout(t.registrationExpiredTimer),t.registrationExpiredTimer=void 0);var i=e.getHeaders("contact").length;if(!i){t.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(var o=void 0;i--;){if((o=e.parseHeader("contact",i)).uri.user===t.ua.contact.uri.user){n=o.getParam("expires");break}o=void 0}if(!o){t.logger.warn("no Contact header pointing to us, response ignored");break}void 0===n&&(n=t.expires),t.registrationTimer=setTimeout(function(){t.registrationTimer=void 0,t.register(t.options)},1e3*n-3e3),t.registrationExpiredTimer=setTimeout(function(){t.logger.warn("registration expired"),t.registered&&t.unregistered(void 0,a.C.causes.EXPIRES)},1e3*n),o.hasParam("temp-gruu")&&(t.ua.contact.tempGruu=d.Grammar.URIParse(o.getParam("temp-gruu").replace(/"/g,""))),o.hasParam("pub-gruu")&&(t.ua.contact.pubGruu=d.Grammar.URIParse(o.getParam("pub-gruu").replace(/"/g,""))),t.registered=!0,t.emit("registered",e||void 0);break;case/^423$/.test(r):e.hasHeader("min-expires")?(t.expires=Number(e.getHeader("min-expires")),t.register(t.options)):(t.logger.warn("423 response received for REGISTER without Min-Expires"),t.registrationFailure(e,a.C.causes.SIP_FAILURE_CODE));break;default:t.registrationFailure(e,h.Utils.sipErrorCause(e.statusCode||0))}}},this.onRequestTimeout=function(){t.registrationFailure(void 0,a.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){t.registrationFailure(void 0,a.C.causes.CONNECTION_ERROR)},this.request.cseq++,this.request.setHeader("cseq",this.request.cseq+" REGISTER"),this.request.extraHeaders=r,this.send()},t.prototype.close=function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registeredBefore=this.registered,this.registered&&this.unregister(e)},t.prototype.unregister=function(e){var t=this;void 0===e&&(e={}),this.registered||e.all||this.logger.warn("Already unregistered, but sending an unregister anyways.");var r=(e.extraHeaders||[]).slice();this.registered=!1,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),e.all?(r.push("Contact: *"),r.push("Expires: 0")):r.push("Contact: "+this.generateContactHeader(0)),this.receiveResponse=function(e){var r=e&&e.statusCode?e.statusCode.toString():"";switch(!0){case/^1[0-9]{2}$/.test(r):t.emit("progress",e);break;case/^2[0-9]{2}$/.test(r):t.emit("accepted",e),void 0!==t.registrationExpiredTimer&&(clearTimeout(t.registrationExpiredTimer),t.registrationExpiredTimer=void 0),t.unregistered(e);break;default:t.unregistered(e,h.Utils.sipErrorCause(e.statusCode||0))}},this.onRequestTimeout=function(){},this.request.cseq++,this.request.setHeader("cseq",this.request.cseq+" REGISTER"),this.request.extraHeaders=r,this.send()},t.prototype.unregistered=function(e,t){this.registered=!1,this.emit("unregistered",e||void 0,t||void 0)},t.prototype.send=function(){var e=this;return this.ua.userAgentCore.register(this.request,{onAccept:function(t){return e.receiveResponse(t.message)},onProgress:function(t){return e.receiveResponse(t.message)},onRedirect:function(t){return e.receiveResponse(t.message)},onReject:function(t){return e.receiveResponse(t.message)},onTrying:function(t){return e.receiveResponse(t.message)}}),this},t.prototype.registrationFailure=function(e,t){this.emit("failed",e||void 0,t||void 0)},t.prototype.onTransportDisconnected=function(){this.registeredBefore=this.registered,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),void 0!==this.registrationExpiredTimer&&(clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=void 0),this.registered&&this.unregistered(void 0,a.C.causes.CONNECTION_ERROR)},t.prototype.generateContactHeader=function(e){void 0===e&&(e=0);var t=this.contact;return this.options.regId&&this.options.instanceId&&(t+=";reg-id="+this.options.regId,t+=';+sip.instance="<urn:uuid:'+this.options.instanceId+'>"'),this.options.extraContactHeaderParams&&this.options.extraContactHeaderParams.forEach(function(e){t+=";"+e}),t+=";expires="+e},t}(s.ClientContext);t.RegisterContext=l},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(15),a=r(2),c=r(14),u=r(31),d=r(3),h=r(7),p=r(11),l=r(27),f=r(22),g=r(96),v=r(12),m=r(5),y=function(e){function t(r){var n=e.call(this)||this;if(n.data={},n.type=d.TypeStrings.Session,!r)throw new h.Exceptions.SessionDescriptionHandlerError("A session description handler is required for the session to function");return n.status=t.C.STATUS_NULL,n.pendingReinvite=!1,n.sessionDescriptionHandlerFactory=r,n.hasOffer=!1,n.hasAnswer=!1,n.timers={ackTimer:void 0,expiresTimer:void 0,invite2xxTimer:void 0,userNoAnswerTimer:void 0,rel1xxTimer:void 0,prackTimer:void 0},n.startTime=void 0,n.endTime=void 0,n.tones=void 0,n.localHold=!1,n.earlySdp=void 0,n.rel100=a.C.supported.UNSUPPORTED,n}return i(t,e),t.prototype.dtmf=function(e,t){var r=this;if(void 0===t&&(t={}),this.status!==d.SessionStatus.STATUS_CONFIRMED&&this.status!==d.SessionStatus.STATUS_WAITING_FOR_ACK)throw new h.Exceptions.InvalidStateError(this.status);if(!e||!e.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+e);var n=function(){if(r.status!==d.SessionStatus.STATUS_TERMINATED&&r.tones&&0!==r.tones.length){var e,i=r.tones.shift();","===i.tone?e=2e3:(i.on("failed",function(){r.tones=void 0}),i.send(t),e=i.duration+i.interToneGap),setTimeout(n,e)}else r.tones=void 0};e=e.toString();var i=this.ua.configuration.dtmfType;this.sessionDescriptionHandler&&i===a.C.dtmfType.RTP&&(this.sessionDescriptionHandler.sendDtmf(e,t)||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),i=a.C.dtmfType.INFO));if(i===a.C.dtmfType.INFO){for(var o=[],s=e.split("");s.length>0;)o.push(new g.DTMF(this,s.shift(),t));if(this.tones)return this.tones=this.tones.concat(o),this;this.tones=o,n()}return this},t.prototype.bye=function(e){if(void 0===e&&(e={}),this.status===d.SessionStatus.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;this.logger.log("terminating Session");var t=e.statusCode;if(t&&(t<200||t>=700))throw new TypeError("Invalid statusCode: "+t);return e.receiveResponse=function(){},this.sendRequest(a.C.BYE,e).terminated()},t.prototype.refer=function(e,t){if(void 0===t&&(t={}),this.status!==d.SessionStatus.STATUS_CONFIRMED)throw new h.Exceptions.InvalidStateError(this.status);return this.referContext=new l.ReferClientContext(this.ua,this,e,t),this.emit("referRequested",this.referContext),this.referContext.refer(t),this.referContext},t.prototype.sendRequest=function(e,t){if(void 0===t&&(t={}),!this.session)throw new Error("Session undefined.");var r;t.body&&(t.body=c.fromBodyObj(t.body));var n,i=t.receiveResponse;i&&(r={onAccept:function(e){return i(e.message)},onProgress:function(e){return i(e.message)},onRedirect:function(e){return i(e.message)},onReject:function(e){return i(e.message)},onTrying:function(e){return i(e.message)}});var o=t;switch(e){case a.C.BYE:n=this.session.bye(r,o);break;case a.C.INVITE:n=this.session.invite(r,o);break;case a.C.REFER:n=this.session.refer(r,o);break;default:throw new Error("Unexpected "+e+". Method not implemented by user agent core.")}return this.emit(e.toLowerCase(),n.message),this},t.prototype.close=function(){if(this.status===d.SessionStatus.STATUS_TERMINATED)return this;for(var e in this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.timers)this.timers[e]&&clearTimeout(this.timers[e]);return this.status=d.SessionStatus.STATUS_TERMINATED,this.ua.transport&&this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},t.prototype.hold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==d.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==d.SessionStatus.STATUS_CONFIRMED)throw new h.Exceptions.InvalidStateError(this.status);this.localHold?this.logger.log("Session is already on hold, cannot put it on hold again"):(e.modifiers=t,this.sessionDescriptionHandler&&e.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.localHold=!0,this.sendReinvite(e))},t.prototype.unhold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==d.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==d.SessionStatus.STATUS_CONFIRMED)throw new h.Exceptions.InvalidStateError(this.status);this.localHold?(e.modifiers=t,this.localHold=!1,this.sendReinvite(e)):this.logger.log("Session is not on hold, cannot unhold it")},t.prototype.reinvite=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=[]),e.modifiers=t,this.sendReinvite(e)},t.prototype.terminate=function(e){return this},t.prototype.onTransportError=function(){this.status!==d.SessionStatus.STATUS_CONFIRMED&&this.status!==d.SessionStatus.STATUS_TERMINATED&&this.failed(void 0,a.C.causes.CONNECTION_ERROR)},t.prototype.onRequestTimeout=function(){this.status===d.SessionStatus.STATUS_CONFIRMED?this.terminated(void 0,a.C.causes.REQUEST_TIMEOUT):this.status!==d.SessionStatus.STATUS_TERMINATED&&(this.failed(void 0,a.C.causes.REQUEST_TIMEOUT),this.terminated(void 0,a.C.causes.REQUEST_TIMEOUT))},t.prototype.onDialogError=function(e){this.status===d.SessionStatus.STATUS_CONFIRMED?this.terminated(e,a.C.causes.DIALOG_ERROR):this.status!==d.SessionStatus.STATUS_TERMINATED&&(this.failed(e,a.C.causes.DIALOG_ERROR),this.terminated(e,a.C.causes.DIALOG_ERROR))},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.onAck=function(e){var t=this,r=function(){clearTimeout(t.timers.ackTimer),clearTimeout(t.timers.invite2xxTimer),t.status=d.SessionStatus.STATUS_CONFIRMED;var r=e.message.getHeader("Content-Disposition");r&&"render"===r.type&&(t.renderbody=e.message.body,t.rendertype=e.message.getHeader("Content-Type")),t.emit("confirmed",e.message)};this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK&&(this.sessionDescriptionHandler&&this.sessionDescriptionHandler.hasDescription(e.message.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(e.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(r){throw t.logger.warn(r),t.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),t.failed(e.message,a.C.causes.BAD_MEDIA_DESCRIPTION),t.terminated(e.message,a.C.causes.BAD_MEDIA_DESCRIPTION),r}).then(function(){return r()})):r())},t.prototype.receiveRequest=function(e){switch(e.message.method){case a.C.BYE:e.accept(),this.status===d.SessionStatus.STATUS_CONFIRMED&&(this.emit("bye",e.message),this.terminated(e.message,a.C.BYE));break;case a.C.INVITE:this.status===d.SessionStatus.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(e));break;case a.C.INFO:if(this.status===d.SessionStatus.STATUS_CONFIRMED||this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(e.message);var t=e.message.getHeader("content-type");if(t)if(t.match(/^application\/dtmf-relay/i)){if(e.message.body){var r=e.message.body.split("\r\n",2);if(2===r.length){var n=void 0,i=void 0,o=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/;o.test(r[0])&&(n=r[0].replace(o,"$2"));var s=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;s.test(r[1])&&(i=parseInt(r[1].replace(s,"$2"),10)),n&&i&&new g.DTMF(this,n,{duration:i}).init_incoming(e)}}}else e.reject({statusCode:415,extraHeaders:["Accept: application/dtmf-relay"]})}break;case a.C.REFER:if(this.status===d.SessionStatus.STATUS_CONFIRMED)if(this.logger.log("REFER received"),this.referContext=new l.ReferServerContext(this.ua,e,this.session),this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var c={followRefer:!0};this.passedOptions&&(c.inviteOptions=this.passedOptions),this.referContext.accept(c,this.modifiers)}break;case a.C.NOTIFY:if(this.referContext&&this.referContext.type===d.TypeStrings.ReferClientContext&&e.message.hasHeader("event")&&/^refer(;.*)?$/.test(e.message.getHeader("event")))return void this.referContext.receiveNotify(e);e.accept(),this.emit("notify",e.message)}},t.prototype.receiveReinvite=function(e){var t,r=this;if(this.emit("reinvite",this,e.message),e.message.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=p.Grammar.nameAddrHeaderParse(e.message.getHeader("P-Asserted-Identity"))),this.sessionDescriptionHandler){if("0"!==e.message.getHeader("Content-Length")||e.message.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(e.message.getHeader("Content-Type")||""))return e.reject({statusCode:415}),void this.emit("reinviteFailed",this);t=this.sessionDescriptionHandler.setDescription(e.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else t=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);t.catch(function(t){var n;throw t.type===d.TypeStrings.SessionDescriptionHandlerError?n=500:t.type===d.TypeStrings.RenegotiationError?(r.emit("renegotiationError",t),r.logger.warn(t.toString()),n=488):(r.logger.error(t),n=488),e.reject({statusCode:n}),r.emit("reinviteFailed",r),t}).then(function(t){var n=["Contact: "+r.contact];e.accept({statusCode:200,extraHeaders:n,body:c.fromBodyObj(t)}),r.status=d.SessionStatus.STATUS_WAITING_FOR_ACK,r.emit("reinviteAccepted",r)})}else this.logger.warn("No SessionDescriptionHandler to reinvite")},t.prototype.sendReinvite=function(e){var t=this;if(void 0===e&&(e={}),this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else if(this.sessionDescriptionHandler){this.pendingReinvite=!0,e.modifiers=e.modifiers||[];var r=(e.extraHeaders||[]).slice();r.push("Contact: "+this.contact),r.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(e){if(!t.session)throw new Error("Session undefined.");var n={onAccept:function(e){if(t.status!==d.SessionStatus.STATUS_TERMINATED)if(t.pendingReinvite){if(t.status=d.SessionStatus.STATUS_CONFIRMED,t.emit("ack",e.ack()),t.pendingReinvite=!1,clearTimeout(t.timers.invite2xxTimer),!t.sessionDescriptionHandler||!t.sessionDescriptionHandler.hasDescription(e.message.getHeader("Content-Type")||""))return t.logger.error("2XX response received to re-invite but did not have a description"),t.emit("reinviteFailed",t),void t.emit("renegotiationError",new h.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));t.sessionDescriptionHandler.setDescription(e.message.body,t.sessionDescriptionHandlerOptions,t.modifiers).catch(function(e){throw t.logger.error("Could not set the description in 2XX response"),t.logger.error(e),t.emit("reinviteFailed",t),t.emit("renegotiationError",e),t.sendRequest(a.C.BYE,{extraHeaders:["Reason: "+m.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),t.terminated(void 0,a.C.causes.INCOMPATIBLE_SDP),e}).then(function(){t.emit("reinviteAccepted",t)})}else t.logger.error("Received reinvite response, but have no pending reinvite");else t.logger.error("Received reinvite response, but in STATUS_TERMINATED")},onProgress:function(e){},onRedirect:function(e){t.pendingReinvite=!1,t.logger.log("Received a non 1XX or 2XX response to a re-invite"),t.emit("reinviteFailed",t),t.emit("renegotiationError",new h.Exceptions.RenegotiationError("Invalid response to a re-invite"))},onReject:function(e){t.pendingReinvite=!1,t.logger.log("Received a non 1XX or 2XX response to a re-invite"),t.emit("reinviteFailed",t),t.emit("renegotiationError",new h.Exceptions.RenegotiationError("Invalid response to a re-invite"))},onTrying:function(e){}},i={extraHeaders:r,body:c.fromBodyObj(e)};t.session.invite(n,i)}).catch(function(e){if(e.type===d.TypeStrings.RenegotiationError)throw t.pendingReinvite=!1,t.emit("renegotiationError",e),t.logger.warn("Renegotiation Error"),t.logger.warn(e.toString()),e;throw t.logger.error("sessionDescriptionHandler error"),t.logger.error(e),e})}else this.logger.warn("No SessionDescriptionHandler, can't reinvite..")},t.prototype.failed=function(e,t){return this.status===d.SessionStatus.STATUS_TERMINATED?this:(this.emit("failed",e,t),this)},t.prototype.rejected=function(e,t){return this.emit("rejected",e,t),this},t.prototype.canceled=function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},t.prototype.accepted=function(e,t){return e instanceof String||(t=m.Utils.getReasonPhrase(e&&e.statusCode||0,t)),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",e,t),this},t.prototype.terminated=function(e,t){return this.status===d.SessionStatus.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e,t),this)},t.prototype.connecting=function(e){return this.emit("connecting",{request:e}),this},t.C=d.SessionStatus,t}(o.EventEmitter);t.Session=y;var S=function(e){function t(t,r){var n=this;if(!t.configuration.sessionDescriptionHandlerFactory)throw t.logger.warn("Can't build ISC without SDH Factory"),new Error("ISC Constructor Failed");(n=e.call(this,t.configuration.sessionDescriptionHandlerFactory)||this)._canceled=!1,n.rseq=Math.floor(1e4*Math.random()),n.incomingRequest=r;var i=r.message;f.ServerContext.initializer(n,t,r),n.type=d.TypeStrings.InviteServerContext;var o=i.parseHeader("Content-Disposition");o&&"render"===o.type&&(n.renderbody=i.body,n.rendertype=i.getHeader("Content-Type")),n.status=d.SessionStatus.STATUS_INVITE_RECEIVED,n.fromTag=i.fromTag,n.id=i.callId+n.fromTag,n.request=i,n.contact=n.ua.contact.toString(),n.logger=t.getLogger("sip.inviteservercontext",n.id),n.ua.sessions[n.id]=n;var s=function(e,t){i.hasHeader(e)&&i.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(n.rel100=t)};if(s("require",a.C.supported.REQUIRED),s("supported",a.C.supported.SUPPORTED),n.request.toTag=r.toTag,n.status=d.SessionStatus.STATUS_WAITING_FOR_ANSWER,n.timers.userNoAnswerTimer=setTimeout(function(){r.reject({statusCode:408}),n.failed(i,a.C.causes.NO_ANSWER),n.terminated(i,a.C.causes.NO_ANSWER)},n.ua.configuration.noAnswerTimeout||60),i.hasHeader("expires")){var c=1e3*Number(i.getHeader("expires")||0);n.timers.expiresTimer=setTimeout(function(){n.status===d.SessionStatus.STATUS_WAITING_FOR_ANSWER&&(r.reject({statusCode:487}),n.failed(i,a.C.causes.EXPIRES),n.terminated(i,a.C.causes.EXPIRES))},c)}return n.errorListener=n.onTransportError.bind(n),t.transport&&t.transport.on("transportError",n.errorListener),n}return i(t,e),Object.defineProperty(t.prototype,"autoSendAnInitialProvisionalResponse",{get:function(){return this.rel100!==a.C.supported.REQUIRED},enumerable:!0,configurable:!0}),t.prototype.reply=function(e){return void 0===e&&(e={}),this},t.prototype.reject=function(e){var t=this;if(void 0===e&&(e={}),this.status===d.SessionStatus.STATUS_TERMINATED)throw new h.Exceptions.InvalidStateError(this.status);this.logger.log("rejecting RTCSession");var r=e.statusCode||480,n=m.Utils.getReasonPhrase(r,e.reasonPhrase),i=e.extraHeaders||[];if(r<300||r>699)throw new TypeError("Invalid statusCode: "+r);var o=e.body?c.fromBodyLegacy(e.body):void 0,s=r<400?this.incomingRequest.redirect([],{statusCode:r,reasonPhrase:n,extraHeaders:i,body:o}):this.incomingRequest.reject({statusCode:r,reasonPhrase:n,extraHeaders:i,body:o});return["rejected","failed"].forEach(function(e){t.emit(e,s.message,n)}),this.terminated()},t.prototype.accept=function(e){var t=this;return void 0===e&&(e={}),this._accept(e).then(function(e){var r=e.message,n=e.session;n.delegate={onAck:function(e){return t.onAck(e)},onAckTimeout:function(){return t.onAckTimeout()},onBye:function(e){return t.receiveRequest(e)},onInfo:function(e){return t.receiveRequest(e)},onInvite:function(e){return t.receiveRequest(e)},onNotify:function(e){return t.receiveRequest(e)},onPrack:function(e){return t.receiveRequest(e)},onRefer:function(e){return t.receiveRequest(e)}},t.session=n,t.status=d.SessionStatus.STATUS_WAITING_FOR_ACK,t.accepted(r,m.Utils.getReasonPhrase(200))}).catch(function(e){if(t.onContextError(e),!t._canceled)throw e}),this},t.prototype.progress=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||180;if(r<100||r>199)throw new TypeError("Invalid statusCode: "+r);if(this.status===d.SessionStatus.STATUS_TERMINATED)return this.logger.warn("Unexpected call for progress while terminated, ignoring"),this;if(this.status===d.SessionStatus.STATUS_ANSWERED)return this.logger.warn("Unexpected call for progress while answered, ignoring"),this;if(this.status===d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK)return this.logger.warn("Unexpected call for progress while answered (waiting for prack), ignoring"),this;if(this.status===d.SessionStatus.STATUS_WAITING_FOR_PRACK)return this.logger.warn("Unexpected call for progress while waiting for prack, ignoring"),this;if(100===e.statusCode){try{this.incomingRequest.trying()}catch(e){if(this.onContextError(e),!this._canceled)throw e}return this}return this.rel100===a.C.supported.REQUIRED||this.rel100===a.C.supported.SUPPORTED&&e.rel100||this.rel100===a.C.supported.SUPPORTED&&this.ua.configuration.rel100===a.C.supported.REQUIRED?(this._reliableProgressWaitForPrack(e).catch(function(e){if(t.onContextError(e),!t._canceled)throw e}),this):(this._progress(e).catch(function(e){if(t.onContextError(e),!t._canceled)throw e}),this)},t.prototype.terminate=function(e){var t=this;if(void 0===e&&(e={}),!this.session)return this.reject(e),this;switch(this.session.sessionState){case u.SessionState.Initial:case u.SessionState.Early:return this.reject(e),this;case u.SessionState.AckWait:return this.session.delegate={onAck:function(){t.sendRequest(a.C.BYE,e)},onAckTimeout:function(){t.sendRequest(a.C.BYE,e)}},this.emit("bye",this.request),this.terminated(),this;case u.SessionState.Confirmed:return this.bye(e),this;case u.SessionState.Terminated:default:return this}},t.prototype.onCancel=function(e){this.status!==d.SessionStatus.STATUS_WAITING_FOR_ANSWER&&this.status!==d.SessionStatus.STATUS_WAITING_FOR_PRACK&&this.status!==d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==d.SessionStatus.STATUS_EARLY_MEDIA&&this.status!==d.SessionStatus.STATUS_ANSWERED||(this.status=d.SessionStatus.STATUS_CANCELED,this.incomingRequest.reject({statusCode:487}),this.canceled(),this.rejected(e,a.C.causes.CANCELED),this.failed(e,a.C.causes.CANCELED),this.terminated(e,a.C.causes.CANCELED))},t.prototype.receiveRequest=function(t){var r=this;switch(t.message.method){case a.C.PRACK:this.status===d.SessionStatus.STATUS_WAITING_FOR_PRACK||this.status===d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(clearTimeout(this.timers.rel1xxTimer),clearTimeout(this.timers.prackTimer),t.accept(),this.status===d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=d.SessionStatus.STATUS_EARLY_MEDIA,this.accept()),this.status=d.SessionStatus.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(t.message.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(t.message.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){clearTimeout(r.timers.rel1xxTimer),clearTimeout(r.timers.prackTimer),t.accept(),r.status===d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(r.status=d.SessionStatus.STATUS_EARLY_MEDIA,r.accept()),r.status=d.SessionStatus.STATUS_EARLY_MEDIA},function(e){r.logger.warn(e),r.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),r.failed(t.message,a.C.causes.BAD_MEDIA_DESCRIPTION),r.terminated(t.message,a.C.causes.BAD_MEDIA_DESCRIPTION)})):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(t.message,a.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(t.message,a.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===d.SessionStatus.STATUS_EARLY_MEDIA&&t.accept();break;default:e.prototype.receiveRequest.call(this,t)}},t.prototype.setupSessionDescriptionHandler=function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)},t.prototype.generateResponseOfferAnswer=function(e){if(!this.session){var t=c.getBody(this.incomingRequest.message);return t&&"session"===t.contentDisposition?this.setOfferAndGetAnswer(t,e):this.getOffer(e)}switch(this.session.signalingState){case u.SignalingState.Initial:return this.getOffer(e);case u.SignalingState.Stable:case u.SignalingState.HaveLocalOffer:return Promise.resolve(void 0);case u.SignalingState.HaveRemoteOffer:if(!this.session.offer)throw new Error("Session offer undefined");return this.setOfferAndGetAnswer(this.session.offer,e);case u.SignalingState.Closed:default:throw new Error("Invalid signaling state "+this.session.signalingState+".")}},t.prototype.handlePrackOfferAnswer=function(e,t){if(!this.session)throw new Error("Session undefined.");var r=c.getBody(e.message);if(!r||"session"!==r.contentDisposition)return Promise.resolve(void 0);switch(this.session.signalingState){case u.SignalingState.Initial:throw new Error("Invalid signaling state "+this.session.signalingState+".");case u.SignalingState.Stable:return this.setAnswer(r,t).then(function(){});case u.SignalingState.HaveLocalOffer:throw new Error("Invalid signaling state "+this.session.signalingState+".");case u.SignalingState.HaveRemoteOffer:return this.setOfferAndGetAnswer(r,t);case u.SignalingState.Closed:default:throw new Error("Invalid signaling state "+this.session.signalingState+".")}},t.prototype.canceled=function(){return this._canceled=!0,e.prototype.canceled.call(this)},t.prototype.terminated=function(t,r){return this.prackNeverArrived(),e.prototype.terminated.call(this,t,r)},t.prototype._accept=function(e){var t=this;return void 0===e&&(e={}),this.onInfo=e.onInfo,this.status===d.SessionStatus.STATUS_WAITING_FOR_PRACK?(this.status=d.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK,this.waitForArrivalOfPrack().then(function(){t.status=d.SessionStatus.STATUS_ANSWERED,clearTimeout(t.timers.userNoAnswerTimer)}).then(function(){return t.generateResponseOfferAnswer(e)}).then(function(e){return t.incomingRequest.accept({statusCode:200,body:e})})):this.status!==d.SessionStatus.STATUS_WAITING_FOR_ANSWER?Promise.reject(new h.Exceptions.InvalidStateError(this.status)):(this.status=d.SessionStatus.STATUS_ANSWERED,this.status=d.SessionStatus.STATUS_ANSWERED,clearTimeout(this.timers.userNoAnswerTimer),this.generateResponseOfferAnswer(e).then(function(e){return t.incomingRequest.accept({statusCode:200,body:e})}))},t.prototype._progress=function(e){void 0===e&&(e={});var t=e.statusCode||180,r=e.reasonPhrase,n=(e.extraHeaders||[]).slice(),i=e.body?c.fromBodyLegacy(e.body):void 0;try{var o=this.incomingRequest.progress({statusCode:t,reasonPhrase:r,extraHeaders:n,body:i});return this.emit("progress",o.message,r),this.session=o.session,Promise.resolve(o)}catch(e){return Promise.reject(e)}},t.prototype._reliableProgress=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||183,n=e.reasonPhrase,i=(e.extraHeaders||[]).slice();return i.push("Require: 100rel"),i.push("RSeq: "+Math.floor(1e4*Math.random())),this.generateResponseOfferAnswer(e).then(function(e){return t.incomingRequest.progress({statusCode:r,reasonPhrase:n,extraHeaders:i,body:e})}).then(function(e){return t.emit("progress",e.message,n),t.session=e.session,e})},t.prototype._reliableProgressWaitForPrack=function(e){var t=this;void 0===e&&(e={});var r,n=e.statusCode||183,i=e.reasonPhrase,o=(e.extraHeaders||[]).slice();return o.push("Require: 100rel"),o.push("RSeq: "+this.rseq++),this.status=d.SessionStatus.STATUS_WAITING_FOR_PRACK,new Promise(function(s,c){var u=!0;return t.generateResponseOfferAnswer(e).then(function(e){return r=e,t.incomingRequest.progress({statusCode:n,reasonPhrase:i,extraHeaders:o,body:r})}).then(function(p){var l,f;t.emit("progress",p.message,i),t.session=p.session,p.session.delegate={onPrack:function(r){l=r,clearTimeout(g),clearTimeout(S),u&&(u=!1,t.handlePrackOfferAnswer(l,e).then(function(e){try{f=l.accept({statusCode:200,body:e}),t.status===d.SessionStatus.STATUS_WAITING_FOR_PRACK&&(t.status=d.SessionStatus.STATUS_WAITING_FOR_ANSWER),t.prackArrived(),s({prackRequest:l,prackResponse:f,progressResponse:p})}catch(e){c(e)}}))}};var g=setTimeout(function(){if(u){u=!1,t.logger.warn("No PRACK received, rejecting INVITE."),clearTimeout(S);try{t.incomingRequest.reject({statusCode:504}),t.terminated(void 0,a.C.causes.NO_PRACK),c(new h.Exceptions.TerminatedSessionError)}catch(e){c(e)}}},64*v.Timers.T1),m=function(){try{t.incomingRequest.progress({statusCode:n,reasonPhrase:i,extraHeaders:o,body:r})}catch(e){return u=!1,void c(e)}S=setTimeout(m,y*=2)},y=v.Timers.T1,S=setTimeout(m,y)})})},t.prototype.onAckTimeout=function(){if(this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.logger.log("no ACK received for an extended period of time, terminating the call"),!this.session)throw new Error("Session undefined.");this.session.bye(),this.terminated(void 0,a.C.causes.NO_ACK)}},t.prototype.onContextError=function(e){var t=480;e instanceof h.Exception?e instanceof h.Exceptions.SessionDescriptionHandlerError?(this.logger.error(e.message),e.error&&this.logger.error(e.error)):e instanceof h.Exceptions.TerminatedSessionError?this.logger.warn("Incoming session terminated while waiting for PRACK."):e instanceof h.Exceptions.UnsupportedSessionDescriptionContentTypeError?t=415:e instanceof h.Exception&&this.logger.error(e.message):e instanceof Error?this.logger.error(e.message):(this.logger.error("An error occurred in the session description handler."),this.logger.error(e));try{this.incomingRequest.reject({statusCode:t}),this.failed(this.incomingRequest.message,e.message),this.terminated(this.incomingRequest.message,e.message)}catch(e){return}},t.prototype.prackArrived=function(){this.waitingForPrackResolve&&this.waitingForPrackResolve(),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0},t.prototype.prackNeverArrived=function(){this.waitingForPrackReject&&this.waitingForPrackReject(new h.Exceptions.TerminatedSessionError),this.waitingForPrackPromise=void 0,this.waitingForPrackResolve=void 0,this.waitingForPrackReject=void 0},t.prototype.waitForArrivalOfPrack=function(){var e=this;if(this.waitingForPrackPromise)throw new Error("Already waiting for PRACK");return this.waitingForPrackPromise=new Promise(function(t,r){e.waitingForPrackResolve=t,e.waitingForPrackReject=r}),this.waitingForPrackPromise},t.prototype.getOffer=function(e){return this.hasOffer=!0,this.getSessionDescriptionHandler().getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(e){return c.fromBodyObj(e)})},t.prototype.setAnswer=function(e,t){this.hasAnswer=!0;var r=this.getSessionDescriptionHandler();return r.hasDescription(e.contentType)?r.setDescription(e.content,t.sessionDescriptionHandlerOptions,t.modifiers):Promise.reject(new h.Exceptions.UnsupportedSessionDescriptionContentTypeError)},t.prototype.setOfferAndGetAnswer=function(e,t){this.hasOffer=!0,this.hasAnswer=!0;var r=this.getSessionDescriptionHandler();return r.hasDescription(e.contentType)?r.setDescription(e.content,t.sessionDescriptionHandlerOptions,t.modifiers).then(function(){return r.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(e){return c.fromBodyObj(e)}):Promise.reject(new h.Exceptions.UnsupportedSessionDescriptionContentTypeError)},t.prototype.getSessionDescriptionHandler=function(){var e=this.sessionDescriptionHandler=this.setupSessionDescriptionHandler();return this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),e},t}(y);t.InviteServerContext=S;var T=function(e){function t(t,r,n,i){void 0===n&&(n={}),void 0===i&&(i=[]);var o=this;if(!t.configuration.sessionDescriptionHandlerFactory)throw t.logger.warn("Can't build ISC without SDH Factory"),new Error("ICC Constructor Failed");n.params=n.params||{};var c=n.anonymous||!1,u=m.Utils.newTag();n.params.fromTag=u;var p=t.contact.toString({anonymous:c,outbound:c?!t.contact.tempGruu:!t.contact.pubGruu}),l=(n.extraHeaders||[]).slice();if(c&&t.configuration.uri&&(n.params.from_displayName="Anonymous",n.params.from_uri="sip:anonymous@anonymous.invalid",l.push("P-Preferred-Identity: "+t.configuration.uri.toString()),l.push("Privacy: id")),l.push("Contact: "+p),l.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),t.configuration.rel100===a.C.supported.REQUIRED&&l.push("Require: 100rel"),t.configuration.replaces===a.C.supported.REQUIRED&&l.push("Require: replaces"),n.extraHeaders=l,o=e.call(this,t.configuration.sessionDescriptionHandlerFactory)||this,s.ClientContext.initializer(o,t,a.C.INVITE,r,n),o.earlyMediaSessionDescriptionHandlers=new Map,o.type=d.TypeStrings.InviteClientContext,o.passedOptions=n,o.sessionDescriptionHandlerOptions=n.sessionDescriptionHandlerOptions||{},o.modifiers=i,o.inviteWithoutSdp=n.inviteWithoutSdp||!1,o.anonymous=n.anonymous||!1,o.renderbody=n.renderbody||void 0,o.rendertype=n.rendertype||"text/plain",o.fromTag=u,o.contact=p,o.status!==d.SessionStatus.STATUS_NULL)throw new h.Exceptions.InvalidStateError(o.status);return o.isCanceled=!1,o.received100=!1,o.method=a.C.INVITE,o.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[o.toString()]=o,o.id=o.request.callId+o.fromTag,o.onInfo=n.onInfo,o.errorListener=o.onTransportError.bind(o),t.transport&&t.transport.on("transportError",o.errorListener),o}return i(t,e),t.prototype.receiveResponse=function(e){throw new Error("Unimplemented.")},t.prototype.send=function(){return this.sendInvite(),this},t.prototype.invite=function(){var e=this;return this.ua.sessions[this.id]=this,Promise.resolve().then(function(){e.isCanceled||e.status===d.SessionStatus.STATUS_TERMINATED||(e.inviteWithoutSdp?(e.request.body=e.renderbody,e.status=d.SessionStatus.STATUS_INVITE_SENT,e.send()):(e.sessionDescriptionHandler=e.sessionDescriptionHandlerFactory(e,e.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),e.emit("SessionDescriptionHandler-created",e.sessionDescriptionHandler),e.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(t){e.isCanceled||e.status===d.SessionStatus.STATUS_TERMINATED||(e.hasOffer=!0,e.request.body=t,e.status=d.SessionStatus.STATUS_INVITE_SENT,e.send())},function(t){t.type===d.TypeStrings.SessionDescriptionHandlerError&&(e.logger.log(t.message),t.error&&e.logger.log(t.error)),e.status!==d.SessionStatus.STATUS_TERMINATED&&(e.failed(void 0,a.C.causes.WEBRTC_ERROR),e.terminated(void 0,a.C.causes.WEBRTC_ERROR))})))}),this},t.prototype.cancel=function(e){if(void 0===e&&(e={}),this.status===d.SessionStatus.STATUS_TERMINATED||this.status===d.SessionStatus.STATUS_CONFIRMED)throw new h.Exceptions.InvalidStateError(this.status);if(this.isCanceled)throw new h.Exceptions.InvalidStateError(d.SessionStatus.STATUS_CANCELED);this.isCanceled=!0,this.logger.log("Canceling session");var t=m.Utils.getCancelReason(e.statusCode,e.reasonPhrase);return e.extraHeaders=(e.extraHeaders||[]).slice(),this.outgoingInviteRequest&&(this.logger.warn("Canceling session before it was created"),this.outgoingInviteRequest.cancel(t,e)),this.canceled()},t.prototype.terminate=function(e){return this.status===d.SessionStatus.STATUS_TERMINATED?this:(this.status===d.SessionStatus.STATUS_WAITING_FOR_ACK||this.status===d.SessionStatus.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)},t.prototype.sendInvite=function(){var e=this;this.outgoingInviteRequest=this.ua.userAgentCore.invite(this.request,{onAccept:function(t){return e.onAccept(t)},onProgress:function(t){return e.onProgress(t)},onRedirect:function(t){return e.onRedirect(t)},onReject:function(t){return e.onReject(t)},onTrying:function(t){return e.onTrying(t)}})},t.prototype.ackAndBye=function(e,t,r,n){if(!this.ua.userAgentCore)throw new Error("Method requires user agent core.");var i=[];r&&i.push("Reason: "+m.Utils.getReasonHeaderValue(r,n));var o=e.ack();this.emit("ack",o.message);var s=t.bye(void 0,{extraHeaders:i});this.emit("bye",s.message)},t.prototype.disposeEarlyMedia=function(){if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");this.earlyMediaSessionDescriptionHandlers.forEach(function(e){e.close()})},t.prototype.onAccept=function(e){var t=this;if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");var r=e.message,n=e.session;if(this.session)this.ackAndBye(e,n);else{if(this.isCanceled)return this.ackAndBye(e,n),void this.emit("bye",this.request);switch(r.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=p.Grammar.nameAddrHeaderParse(r.getHeader("P-Asserted-Identity"))),this.session=n,this.session.delegate={onAck:function(e){return t.onAck(e)},onBye:function(e){return t.receiveRequest(e)},onInfo:function(e){return t.receiveRequest(e)},onInvite:function(e){return t.receiveRequest(e)},onNotify:function(e){return t.receiveRequest(e)},onPrack:function(e){return t.receiveRequest(e)},onRefer:function(e){return t.receiveRequest(e)}},n.signalingState){case u.SignalingState.Initial:case u.SignalingState.HaveLocalOffer:this.ackAndBye(e,n,400,"Missing session description"),this.failed(r,a.C.causes.BAD_MEDIA_DESCRIPTION);break;case u.SignalingState.HaveRemoteOffer:var i=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});if(this.sessionDescriptionHandler=i,this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!i.hasDescription(r.getHeader("Content-Type")||"")){this.ackAndBye(e,n,400,"Missing session description"),this.failed(r,a.C.causes.BAD_MEDIA_DESCRIPTION);break}this.hasOffer=!0,i.setDescription(r.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return i.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(n){if(!t.isCanceled&&t.status!==d.SessionStatus.STATUS_TERMINATED){t.status=d.SessionStatus.STATUS_CONFIRMED,t.hasAnswer=!0;var i={contentDisposition:"session",contentType:n.contentType,content:n.body},o=e.ack({body:i});t.emit("ack",o.message),t.accepted(r)}}).catch(function(i){if(i.type!==d.TypeStrings.SessionDescriptionHandlerError)throw i;t.logger.warn("invalid description"),t.logger.warn(i.toString()),t.ackAndBye(e,n,488,"Invalid session description"),t.failed(r,a.C.causes.BAD_MEDIA_DESCRIPTION)});break;case u.SignalingState.Stable:var o;if(this.renderbody&&this.rendertype&&(o={body:{contentDisposition:"render",contentType:this.rendertype,content:this.renderbody}}),this.hasOffer&&!this.hasAnswer){if(!this.sessionDescriptionHandler)throw new Error("Session description handler undefined.");var s=n.answer;if(!s)throw new Error("Answer is undefined.");this.sessionDescriptionHandler.setDescription(s.content,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){t.hasAnswer=!0,t.status=d.SessionStatus.STATUS_CONFIRMED;var n=e.ack(o);t.emit("ack",n.message),t.accepted(r)}).catch(function(i){t.logger.error(i),t.ackAndBye(e,n,488,"Not Acceptable Here"),t.failed(r,a.C.causes.BAD_MEDIA_DESCRIPTION)})}else{if(this.sessionDescriptionHandler=this.earlyMediaSessionDescriptionHandlers.get(n.id),!this.sessionDescriptionHandler)throw new Error("Session description handler undefined.");this.earlyMediaSessionDescriptionHandlers.delete(n.id),this.hasOffer=!0,this.hasAnswer=!0,this.status=d.SessionStatus.STATUS_CONFIRMED;var c=e.ack();this.emit("ack",c.message),this.accepted(r)}break;case u.SignalingState.Closed:break;default:throw new Error("Unknown session signaling state.")}this.disposeEarlyMedia()}},t.prototype.onProgress=function(e){var t=this;if(!this.isCanceled){if(!this.outgoingInviteRequest)throw new Error("Outgoing INVITE request undefined.");if(!this.earlyMediaSessionDescriptionHandlers)throw new Error("Early media session description handlers undefined.");var r=e.message,n=e.session;if(this.status=d.SessionStatus.STATUS_1XX_RECEIVED,r.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=p.Grammar.nameAddrHeaderParse(r.getHeader("P-Asserted-Identity"))),!n)throw new Error("Session undefined.");var i=r.getHeader("require"),o=r.getHeader("rseq"),s=!!(i&&i.includes("100rel")&&o?Number(o):void 0),c=[];if(s&&c.push("RAck: "+r.getHeader("rseq")+" "+r.getHeader("cseq")),n.signalingState===u.SignalingState.Initial)return s&&(this.logger.warn("First reliable provisional response received MUST contain an offer when INVITE does not contain an offer."),e.prack({extraHeaders:c})),void this.emit("progress",r);if(n.signalingState===u.SignalingState.HaveLocalOffer)return s&&e.prack({extraHeaders:c}),void this.emit("progress",r);if(n.signalingState===u.SignalingState.HaveRemoteOffer){if(!s)return void this.logger.warn("Non-reliable provisional response MUST NOT contain an initial offer, discarding response.");var h=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{});return this.emit("SessionDescriptionHandler-created",h),this.earlyMediaSessionDescriptionHandlers.set(n.id,h),void h.setDescription(r.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return h.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(n){var i={contentDisposition:"session",contentType:n.contentType,content:n.body};e.prack({extraHeaders:c,body:i}),t.status=d.SessionStatus.STATUS_EARLY_MEDIA,t.emit("progress",r)}).catch(function(e){t.status!==d.SessionStatus.STATUS_TERMINATED&&(t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR))})}return n.signalingState===u.SignalingState.Stable?(s&&e.prack({extraHeaders:c}),void this.emit("progress",r)):void 0}},t.prototype.onRedirect=function(e){this.disposeEarlyMedia();var t=e.message,r=t.statusCode,n=m.Utils.sipErrorCause(r||0);this.rejected(t,n),this.failed(t,n),this.terminated(t,n)},t.prototype.onReject=function(e){this.disposeEarlyMedia();var t=e.message,r=t.statusCode,n=m.Utils.sipErrorCause(r||0);this.rejected(t,n),this.failed(t,n),this.terminated(t,n)},t.prototype.onTrying=function(e){this.received100=!0,this.emit("progress",e.message)},t}(y);t.InviteClientContext=T},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(2),a=r(14),c=r(32),u=r(23),d=r(3),h=r(5),p=function(e){function t(t,r,n,i){void 0===i&&(i={});var o=e.call(this)||this;o.data={},o.method=s.C.SUBSCRIBE,o.body=void 0,o.type=d.TypeStrings.Subscription,o.ua=t,o.logger=t.getLogger("sip.subscription"),i.body&&(o.body={body:i.body,contentType:i.contentType?i.contentType:"application/sdp"});var a=t.normalizeTarget(r);if(!a)throw new TypeError("Invalid target: "+r);if(o.uri=a,o.event=n,void 0===i.expires?o.expires=3600:"number"!=typeof i.expires?(t.logger.warn('Option "expires" must be a number. Using default of 3600.'),o.expires=3600):o.expires=i.expires,o.extraHeaders=(i.extraHeaders||[]).slice(),o.context=o.initContext(),o.disposed=!1,o.request=o.context.message,!o.request.from)throw new Error("From undefined.");if(!o.request.to)throw new Error("From undefined.");return o.localIdentity=o.request.from,o.remoteIdentity=o.request.to,o}return i(t,e),t.prototype.dispose=function(){this.disposed||(this.retryAfterTimer&&(clearTimeout(this.retryAfterTimer),this.retryAfterTimer=void 0),this.context.dispose(),this.disposed=!0)},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.emit=function(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e.prototype.emit.apply(this,[t].concat(r))},t.prototype.close=function(){if(!this.disposed)switch(this.dispose(),this.context.state){case c.SubscriptionState.Initial:case c.SubscriptionState.NotifyWait:this.onTerminated();break;case c.SubscriptionState.Pending:case c.SubscriptionState.Active:this.unsubscribe();break;case c.SubscriptionState.Terminated:this.onTerminated()}},t.prototype.refresh=function(){var e=this;switch(this.context.state){case c.SubscriptionState.Initial:case c.SubscriptionState.NotifyWait:case c.SubscriptionState.Pending:break;case c.SubscriptionState.Active:if(this.subscription)this.subscription.refresh().delegate={onAccept:function(t){return e.onAccepted(t)},onRedirect:function(t){return e.onFailed(t)},onReject:function(t){return e.onFailed(t)}};break;case c.SubscriptionState.Terminated:}},t.prototype.subscribe=function(){var e=this;switch(this.context.state){case c.SubscriptionState.Initial:this.context.subscribe().then(function(t){t.success?(t.success.subscription&&(e.subscription=t.success.subscription,e.subscription.delegate={onNotify:function(t){return e.onNotify(t)},onRefresh:function(t){return e.onRefresh(t)},onTerminated:function(){return e.close()}}),e.onNotify(t.success.request)):t.failure&&e.onFailed(t.failure.response)});break;case c.SubscriptionState.NotifyWait:case c.SubscriptionState.Pending:break;case c.SubscriptionState.Active:this.refresh();break;case c.SubscriptionState.Terminated:}return this},t.prototype.unsubscribe=function(){switch(this.dispose(),this.context.state){case c.SubscriptionState.Initial:case c.SubscriptionState.NotifyWait:break;case c.SubscriptionState.Pending:case c.SubscriptionState.Active:this.subscription&&this.subscription.unsubscribe();break;case c.SubscriptionState.Terminated:}this.onTerminated()},t.prototype.onAccepted=function(e){var t=e.message.statusCode?e.message.statusCode:0,r=h.Utils.getReasonPhrase(t);this.emit("accepted",e.message,r)},t.prototype.onFailed=function(e){if(this.close(),e){var t=e.message.statusCode?e.message.statusCode:0,r=h.Utils.getReasonPhrase(t);this.emit("failed",e.message,r),this.emit("rejected",e.message,r)}},t.prototype.onNotify=function(e){var t=this;if(e.accept(),this.emit("notify",{request:e.message}),!this.disposed){var r=e.message.parseHeader("Subscription-State");if(r&&r.state)switch(r.state){case"terminated":if(r.reason)switch(this.logger.log("Terminated subscription with reason "+r.reason),r.reason){case"deactivated":case"timeout":return this.initContext(),void this.subscribe();case"probation":case"giveup":return this.initContext(),void(r.params&&r.params["retry-after"]?this.retryAfterTimer=setTimeout(function(){return t.subscribe()},r.params["retry-after"]):this.subscribe())}this.close()}}},t.prototype.onRefresh=function(e){var t=this;e.delegate={onAccept:function(e){return t.onAccepted(e)}}},t.prototype.onTerminated=function(){this.emit("terminated")},t.prototype.initContext=function(){var e=this,t={extraHeaders:this.extraHeaders,body:this.body?a.fromBodyObj(this.body):void 0};return this.context=new l(this.ua.userAgentCore,this.uri,this.event,this.expires,t),this.context.delegate={onAccept:function(t){return e.onAccepted(t)}},this.context},t}(o.EventEmitter);t.Subscription=p;var l=function(){function e(e,t,r,n,i,o){this.core=e,this.target=t,this.event=r,this.expires=n,this.subscribed=!1,this.logger=e.loggerFactory.getLogger("sip.subscription"),this.delegate=o;var c="Allow: "+u.AllowedMethods.toString(),d=(i&&i.extraHeaders||[]).slice();d.push(c),d.push("Event: "+this.event),d.push("Expires: "+this.expires),d.push("Contact: "+this.core.configuration.contact.toString());var h=i&&i.body?a.toBodyObj(i.body):void 0;this.message=this.core.configuration.outgoingRequestMessageFactory(s.C.SUBSCRIBE,this.target,{},d,h)}return e.prototype.dispose=function(){this.subscription&&this.subscription.dispose(),this.request&&(this.request.waitNotifyStop(),this.request.dispose())},Object.defineProperty(e.prototype,"state",{get:function(){return this.subscription?this.subscription.subscriptionState:this.subscribed?c.SubscriptionState.NotifyWait:c.SubscriptionState.Initial},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(){var e=this;return this.subscribed?Promise.reject(new Error("Not in initial state. Did you call subscribe more than once?")):(this.subscribed=!0,new Promise(function(t,r){if(!e.message)throw new Error("Message undefined.");e.request=e.core.subscribe(e.message,{onAccept:function(t){e.delegate&&e.delegate.onAccept&&e.delegate.onAccept(t)},onNotify:function(r){e.subscription=r.subscription,e.subscription&&(e.subscription.autoRefresh=!0),t({success:r})},onNotifyTimeout:function(){t({failure:{}})},onRedirect:function(e){t({failure:{response:e}})},onReject:function(e){t({failure:{response:e}})}})}))},e}()},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(3),a=function(e){function t(t,r){var n=e.call(this)||this;return n.type=s.TypeStrings.Transport,n.logger=t,n}return i(t,e),t.prototype.connect=function(e){var t=this;return void 0===e&&(e={}),this.connectPromise(e).then(function(e){e.overrideEvent||t.emit("connected")})},t.prototype.send=function(e,t){var r=this;return void 0===t&&(t={}),this.sendPromise(e).then(function(e){e.overrideEvent||r.emit("messageSent",e.msg)})},t.prototype.disconnect=function(e){var t=this;return void 0===e&&(e={}),this.disconnectPromise(e).then(function(e){e.overrideEvent||t.emit("disconnected")})},t.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},t.prototype.waitForConnected=function(){var e=this;return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new Promise(function(t){e.afterConnected(t)})},t}(o.EventEmitter);t.Transport=a},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(15),a=r(2),c=r(98),u=r(37),d=r(3),h=r(7),p=r(11),l=r(40),f=r(41),g=r(42),v=r(27),m=r(44),y=r(22),S=r(45),T=r(8),C=r(46),b=r(19),_=r(5),A=r(62),w=r(63),E=e.window||e,R=function(t){function r(e){var n=t.call(this)||this;if(n.type=d.TypeStrings.UA,n.log=new l.LoggerFactory,n.logger=n.getLogger("sip.ua"),n.configuration={},n.applicants={},n.data={},n.sessions={},n.publishers={},n.status=d.UAStatus.STATUS_INIT,void 0===e?e={}:("string"==typeof e||e instanceof String)&&(e={uri:e}),e.log&&(e.log.hasOwnProperty("builtinEnabled")&&(n.log.builtinEnabled=e.log.builtinEnabled),e.log.hasOwnProperty("connector")&&(n.log.connector=e.log.connector),e.log.hasOwnProperty("level"))){var i=e.log.level,o=void 0;switch(i){case"error":o=l.Levels.error;break;case"warn":o=l.Levels.warn;break;case"log":o=l.Levels.log;break;case"debug":o=l.Levels.debug}void 0===o?n.logger.error('Invalid "level" parameter value: '+JSON.stringify(i)):n.log.level=o}try{n.loadConfig(e)}catch(e){throw n.status=d.UAStatus.STATUS_NOT_READY,n.error=r.C.CONFIGURATION_ERROR,e}var s=c.makeUserAgentCoreConfigurationFromUA(n),u={onInvite:function(e){e.trying(),e.delegate={onCancel:function(e){t.onCancel(e)},onTransportError:function(e){t.onTransportError()}};var t=new S.InviteServerContext(n,e);!function(e,t){if(n.configuration.replaces!==a.C.supported.UNSUPPORTED){var r=t.parseHeader("replaces");if(r){var i=n.sessions[r.call_id+r.replaces_from_tag]||n.sessions[r.call_id+r.replaces_to_tag]||void 0;if(!i)return void n.userAgentCore.replyStateless(t,{statusCode:481});if(i.status===d.SessionStatus.STATUS_TERMINATED)return void n.userAgentCore.replyStateless(t,{statusCode:603});var o=r.call_id+r.replaces_to_tag+r.replaces_from_tag,s=n.userAgentCore.dialogs.get(o);if(!s)return void n.userAgentCore.replyStateless(t,{statusCode:481});if(!s.early&&r.early_only)return void n.userAgentCore.replyStateless(t,{statusCode:486});e.replacee=i}}}(t,e.message),t.autoSendAnInitialProvisionalResponse&&t.progress(),n.emit("invite",t)},onMessage:function(e){var t=new y.ServerContext(n,e);t.body=e.message.body,t.contentType=e.message.getHeader("Content-Type")||"text/plain",e.accept(),n.emit("message",t)},onNotify:function(e){n.configuration.allowLegacyNotifications&&n.listeners("notify").length>0?(e.accept(),n.emit("notify",{request:e.message})):e.reject({statusCode:481})},onRefer:function(e){n.logger.log("Received an out of dialog refer"),n.configuration.allowOutOfDialogRefers||e.reject({statusCode:405}),n.logger.log("Allow out of dialog refers is enabled on the UA");var t=new v.ReferServerContext(n,e);n.listeners("outOfDialogReferRequested").length?n.emit("outOfDialogReferRequested",t):(n.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),t.accept({followRefer:!0}))},onSubscribe:function(e){n.emit("subscribe",e)}};return n.userAgentCore=new c.UserAgentCore(s,u),n.registerContext=new m.RegisterContext(n,e.registerOptions),n.registerContext.on("failed",n.emit.bind(n,"registrationFailed")),n.registerContext.on("registered",n.emit.bind(n,"registered")),n.registerContext.on("unregistered",n.emit.bind(n,"unregistered")),n.configuration.autostart&&n.start(),n}return i(r,t),r.prototype.register=function(e){return void 0===e&&(e={}),e.register&&(this.configuration.register=!0),this.registerContext.register(e),this},r.prototype.unregister=function(e){var t=this;return this.configuration.register=!1,this.transport&&this.transport.afterConnected(function(){t.registerContext.unregister(e)}),this},r.prototype.isRegistered=function(){return this.registerContext.registered},r.prototype.invite=function(e,t,r){var n=this,i=new S.InviteClientContext(this,e,t,r);return this.transport&&this.transport.afterConnected(function(){i.invite(),n.emit("inviteSent",i)}),i},r.prototype.subscribe=function(e,t,r){var n=new C.Subscription(this,e,t,r);return this.transport&&this.transport.afterConnected(function(){return n.subscribe()}),n},r.prototype.publish=function(e,t,r,n){var i=new g.PublishContext(this,e,t,n);return this.transport&&this.transport.afterConnected(function(){i.publish(r)}),i},r.prototype.message=function(e,t,r){if(void 0===r&&(r={}),void 0===t)throw new TypeError("Not enough arguments");return r.contentType=r.contentType||"text/plain",r.body=t,this.request(a.C.MESSAGE,e,r)},r.prototype.request=function(e,t,r){var n=new s.ClientContext(this,e,t,r);return this.transport&&this.transport.afterConnected(function(){return n.send()}),n},r.prototype.stop=function(){if(this.logger.log("user requested closure..."),this.status===d.UAStatus.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(var t in this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.sessions[t]&&(this.logger.log("closing session "+t),this.sessions[t].terminate());for(var r in this.publishers)this.publishers[r]&&(this.logger.log("unpublish "+r),this.publishers[r].close());for(var n in this.applicants)this.applicants[n]&&this.applicants[n].close();return this.status=d.UAStatus.STATUS_USER_CLOSED,"function"==typeof E.removeEventListener&&(e.chrome&&e.chrome.app&&e.chrome.app.runtime||E.removeEventListener("unload",this.environListener)),this},r.prototype.start=function(){var t=this;if(this.logger.log("user requested startup..."),this.status===d.UAStatus.STATUS_INIT){if(this.status=d.UAStatus.STATUS_STARTING,!this.configuration.transportConstructor)throw new h.Exceptions.TransportError("Transport constructor not set");this.transport=new this.configuration.transportConstructor(this.getLogger("sip.transport"),this.configuration.transportOptions),this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()}else this.status===d.UAStatus.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=d.UAStatus.STATUS_READY,this.transport&&this.transport.connect()):this.status===d.UAStatus.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===d.UAStatus.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this.configuration.autostop&&"function"==typeof E.addEventListener&&(e.chrome&&e.chrome.app&&e.chrome.app.runtime||(this.environListener=this.stop,E.addEventListener("unload",function(){return t.environListener()}))),this},r.prototype.normalizeTarget=function(e){return _.Utils.normalizeTarget(e,this.configuration.hostportParams)},r.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},r.prototype.getLoggerFactory=function(){return this.log},r.prototype.findSession=function(e){return this.sessions[e.callId+e.fromTag]||this.sessions[e.callId+e.toTag]||void 0},r.prototype.on=function(e,r){return t.prototype.on.call(this,e,r)},r.prototype.onTransportError=function(){this.status!==d.UAStatus.STATUS_USER_CLOSED&&(this.error&&this.error===r.C.NETWORK_ERROR||(this.status=d.UAStatus.STATUS_NOT_READY,this.error=r.C.NETWORK_ERROR))},r.prototype.setTransportListeners=function(){var e=this;this.transport&&(this.transport.on("connected",function(){return e.onTransportConnected()}),this.transport.on("message",function(t){return e.onTransportReceiveMsg(t)}),this.transport.on("transportError",function(){return e.onTransportError()}))},r.prototype.onTransportConnected=function(){var e=this;this.configuration.register&&Promise.resolve().then(function(){return e.registerContext.register()})},r.prototype.onTransportReceiveMsg=function(e){var t=this,r=f.Parser.parseMessage(e,this);if(r)if(this.status===d.UAStatus.STATUS_USER_CLOSED&&r instanceof T.IncomingRequest)this.logger.warn("UA received message when status = USER_CLOSED - aborting");else{var n=function(){for(var e=0,n=["from","to","call_id","cseq","via"];e<n.length;e++){var i=n[e];if(!r.hasHeader(i))return t.logger.warn("Missing mandatory header field : "+i+"."),!1}return!0};if(r instanceof T.IncomingRequest){if(!n())return void this.logger.warn("Request missing mandatory header field. Dropping.");if(!r.toTag&&r.callId.substr(0,5)===this.configuration.sipjsId)return void this.userAgentCore.replyStateless(r,{statusCode:482});var i=_.Utils.str_utf8_length(r.body);if((o=r.getHeader("content-length"))&&i<Number(o))return void this.userAgentCore.replyStateless(r,{statusCode:400})}if(r instanceof T.IncomingResponse){if(!n())return void this.logger.warn("Response missing mandatory header field. Dropping.");if(r.getHeaders("via").length>1)return void this.logger.warn("More than one Via header field present in the response. Dropping.");if(r.via.host!==this.configuration.viaHost||void 0!==r.via.port)return void this.logger.warn("Via sent-by in the response does not match UA Via host value. Dropping.");var o;i=_.Utils.str_utf8_length(r.body);if((o=r.getHeader("content-length"))&&i<Number(o))return void this.logger.warn("Message body length is lower than the value in Content-Length header field. Dropping.")}if(r instanceof T.IncomingRequest)this.userAgentCore.receiveIncomingRequestFromTransport(r);else{if(!(r instanceof T.IncomingResponse))throw new Error("Invalid message type.");this.userAgentCore.receiveIncomingResponseFromTransport(r)}}else this.logger.warn("UA failed to parse incoming SIP message - discarding.")},r.prototype.checkAuthenticationFactory=function(e){if(e instanceof Function)return e.initialize||(e.initialize=function(){return Promise.resolve()}),e},r.prototype.loadConfig=function(e){var t=this,r={viaHost:_.Utils.createRandomToken(12)+".invalid",uri:new b.URI("sip","anonymous."+_.Utils.createRandomToken(6),"anonymous.invalid",void 0,void 0),custom:{},displayName:"",password:void 0,register:!0,registerOptions:{},transportConstructor:w.Transport,transportOptions:{},userAgentString:a.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},extraSupported:[],contactName:_.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:a.C.supported.UNSUPPORTED,dtmfType:a.C.dtmfType.INFO,replaces:a.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:A.SessionDescriptionHandler.defaultFactory,authenticationFactory:this.checkAuthenticationFactory(function(e){return new u.DigestAuthentication(e)}),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1,experimentalFeatures:!1},n=this.getConfigurationCheck();for(var i in n.mandatory){if(!e.hasOwnProperty(i))throw new h.Exceptions.ConfigurationError(i);var o=e[i];if(void 0===(s=n.mandatory[i](o)))throw new h.Exceptions.ConfigurationError(i,o);r[i]=s}for(var i in n.optional)if(e.hasOwnProperty(i)){var s;if((o=e[i])instanceof Array&&0===o.length||null===o||""===o||void 0===o||"number"==typeof o&&isNaN(o))continue;if(void 0===(s=n.optional[i](o)))throw new h.Exceptions.ConfigurationError(i,o);r[i]=s}0===r.displayName&&(r.displayName="0"),r.sipjsId=_.Utils.createRandomToken(5);var c=r.uri.clone();if(c.user=void 0,r.hostportParams=c.toRaw().replace(/^sip:/i,""),r.authorizationUser||(r.authorizationUser=r.uri.user),r.noAnswerTimeout=1e3*r.noAnswerTimeout,r.hackIpInContact)if("boolean"==typeof r.hackIpInContact){var d=Math.floor(254*Math.random()+1);r.viaHost="192.0.2."+d}else"string"==typeof r.hackIpInContact&&(r.viaHost=r.hackIpInContact);r.hackWssInTransport&&(r.contactTransport="wss"),this.contact={pubGruu:void 0,tempGruu:void 0,uri:new b.URI("sip",r.contactName,r.viaHost,void 0,{transport:r.contactTransport}),toString:function(e){void 0===e&&(e={});var n=e.anonymous||!1,i=e.outbound||!1,o="<";return o+=n?(t.contact.tempGruu||"sip:anonymous@anonymous.invalid;transport="+r.contactTransport).toString():(t.contact.pubGruu||t.contact.uri).toString(),i&&(o+=";ob"),o+=">"}};var p={};for(var i in r)r.hasOwnProperty(i)&&(p[i]=r[i]);for(var i in Object.assign(this.configuration,p),this.logger.log("configuration parameters after validation:"),r)if(r.hasOwnProperty(i))switch(i){case"uri":case"sessionDescriptionHandlerFactory":this.logger.log("\xb7 "+i+": "+r[i]);break;case"password":this.logger.log("\xb7 "+i+": NOT SHOWN");break;case"transportConstructor":this.logger.log("\xb7 "+i+": "+r[i].name);break;default:this.logger.log("\xb7 "+i+": "+JSON.stringify(r[i]))}},r.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(e){/^sip:/i.test(e)||(e=a.C.SIP+":"+e);var t=p.Grammar.URIParse(e);return t&&t.user?t:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"==typeof e)return e},authorizationUser:function(e){return-1===p.Grammar.parse('"'+e+'"',"quoted_string")?void 0:e},displayName:function(e){return-1===p.Grammar.parse('"'+e+'"',"displayName")?void 0:e},dtmfType:function(e){switch(e){case a.C.dtmfType.RTP:return a.C.dtmfType.RTP;case a.C.dtmfType.INFO:default:return a.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(e){return"boolean"==typeof e?e:"string"==typeof e&&-1!==p.Grammar.parse(e,"host")?e:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},extraSupported:function(e){if(e instanceof Array){for(var t=0,r=e;t<r.length;t++){if("string"!=typeof r[t])return}return e}},forceRport:function(e){if("boolean"==typeof e)return e},noAnswerTimeout:function(e){if(_.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},password:function(e){return String(e)},rel100:function(e){return e===a.C.supported.REQUIRED?a.C.supported.REQUIRED:e===a.C.supported.SUPPORTED?a.C.supported.SUPPORTED:a.C.supported.UNSUPPORTED},replaces:function(e){return e===a.C.supported.REQUIRED?a.C.supported.REQUIRED:e===a.C.supported.SUPPORTED?a.C.supported.SUPPORTED:a.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerOptions:function(e){if("object"==typeof e)return e},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:this.checkAuthenticationFactory,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e},experimentalFeatures:function(e){if("boolean"==typeof e)return e}}}},r.C={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10},r}(o.EventEmitter);t.UA=R,function(e){!function(e){e.RTP="rtp",e.INFO="info"}(e.DtmfType||(e.DtmfType={}))}(R=t.UA||(t.UA={})),t.UA=R}).call(this,r(24))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(1),a=function(e){function t(t,r,n){var i,a=t.createOutgoingRequestMessage(o.C.BYE,n);return i=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this,t.dispose(),i}return i(t,e),t}(r(6).UserAgentClient);t.ByeUserAgentClient=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){return e.call(this,o.NonInviteServerTransaction,t.userAgentCore,r,n)||this}return i(t,e),t}(r(9).UserAgentServer);t.ByeUserAgentServer=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){return e.call(this,o.NonInviteServerTransaction,t.userAgentCore,r,n)||this}return i(t,e),t}(r(9).UserAgentServer);t.InfoUserAgentServer=s},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(33)),n(r(103)),n(r(60))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(1),a=function(e){function t(t,r,n){var i=t.createOutgoingRequestMessage(o.C.NOTIFY,n);return e.call(this,s.NonInviteClientTransaction,t.userAgentCore,i,r)||this}return i(t,e),t}(r(6).UserAgentClient);t.NotifyUserAgentClient=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(1),a=function(e){function t(t,r,n){var i,a=t.createOutgoingRequestMessage(o.C.PRACK,n);return i=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this,t.signalingStateTransition(a),i}return i(t,e),t}(r(6).UserAgentClient);t.PrackUserAgentClient=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){var i=e.call(this,o.NonInviteServerTransaction,t.userAgentCore,r,n)||this;return t.signalingStateTransition(r),i.dialog=t,i}return i(t,e),t.prototype.accept=function(t){return void 0===t&&(t={statusCode:200}),t.body&&this.dialog.signalingStateTransition(t.body),e.prototype.accept.call(this,t)},t}(r(9).UserAgentServer);t.PrackUserAgentServer=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(1),a=function(e){function t(t,r,n){var i=this,a=t.createOutgoingRequestMessage(o.C.INVITE,n);return(i=e.call(this,s.InviteClientTransaction,t.userAgentCore,a,r)||this).delegate=r,t.signalingStateTransition(a),t.reinviteUserAgentClient=i,i.dialog=t,i}return i(t,e),t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode?e.statusCode.toString():"";if(!r)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(r):this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e});break;case/^1[0-9]{2}$/.test(r):this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:this.dialog,prack:function(e){throw new Error("Unimplemented.")}});break;case/^2[0-9]{2}$/.test(r):this.dialog.signalingStateTransition(e),this.delegate&&this.delegate.onAccept&&this.delegate.onAccept({message:e,session:this.dialog,ack:function(e){return t.dialog.ack(e)}});break;case/^3[0-9]{2}$/.test(r):this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e});break;case/^[4-6][0-9]{2}$/.test(r):this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e});break;default:throw new Error("Invalid status code "+r)}},t}(r(6).UserAgentClient);t.ReInviteUserAgentClient=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),a=function(e){function t(t,r,n){var i=e.call(this,s.InviteServerTransaction,t.userAgentCore,r,n)||this;return t.reinviteUserAgentServer=i,i.dialog=t,i}return i(t,e),t.prototype.accept=function(t){void 0===t&&(t={statusCode:200}),t.extraHeaders=t.extraHeaders||[],t.extraHeaders=t.extraHeaders.concat(this.dialog.routeSet.map(function(e){return"Record-Route: "+e}));var r=e.prototype.accept.call(this,t),n=this.dialog,i=o({},r,{session:n});return t.body&&this.dialog.signalingStateTransition(t.body),this.dialog.reConfirm(),i},t.prototype.progress=function(t){void 0===t&&(t={statusCode:180});var r=e.prototype.progress.call(this,t),n=this.dialog,i=o({},r,{session:n});return t.body&&this.dialog.signalingStateTransition(t.body),i},t}(r(9).UserAgentServer);t.ReInviteUserAgentServer=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(1),a=function(e){function t(t,r,n){var i=t.createOutgoingRequestMessage(o.C.REFER,n);return e.call(this,s.NonInviteClientTransaction,t.userAgentCore,i,r)||this}return i(t,e),t}(r(6).UserAgentClient);t.ReferUserAgentClient=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){var i=void 0!==t.userAgentCore?t.userAgentCore:t;return e.call(this,o.NonInviteServerTransaction,i,r,n)||this}return i(t,e),t}(r(9).UserAgentServer);t.ReferUserAgentServer=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(18),a=r(12),c=r(32),u=r(23),d=r(34),h=r(61),p=function(e){function t(t,r,n,i,o,s){var a=e.call(this,i,o)||this;return a.delegate=s,a._autoRefresh=!1,a._subscriptionEvent=t,a._subscriptionExpires=r,a._subscriptionExpiresInitial=r,a._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),a._subscriptionRefresh=void 0,a._subscriptionRefreshLastSet=void 0,a._subscriptionState=n,a.logger=i.loggerFactory.getLogger("sip.subscribe-dialog"),a.logger.log("SUBSCRIBE dialog "+a.id+" constructed"),a}return i(t,e),t.initialDialogStateForSubscription=function(e,t){var r=t.getHeaders("record-route"),n=t.parseHeader("contact");if(!n)throw new Error("Contact undefined.");if(!(n instanceof s.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");var i=n.uri,o=e.cseq,a=e.callId,c=e.fromTag,u=t.fromTag;if(!a)throw new Error("Call id undefined.");if(!c)throw new Error("From tag undefined.");if(!u)throw new Error("To tag undefined.");if(!e.from)throw new Error("From undefined.");if(!e.to)throw new Error("To undefined.");return{id:a+c+u,early:!1,callId:a,localTag:c,remoteTag:u,localSequenceNumber:o,remoteSequenceNumber:void 0,localURI:e.from.uri,remoteURI:e.to.uri,remoteTarget:i,routeSet:r,secure:!1}},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.N&&(clearTimeout(this.N),this.N=void 0),this.refreshTimerClear(),this.logger.log("SUBSCRIBE dialog "+this.id+" destroyed")},Object.defineProperty(t.prototype,"autoRefresh",{get:function(){return this._autoRefresh},set:function(e){this._autoRefresh=!0,this.refreshTimerSet()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionEvent",{get:function(){return this._subscriptionEvent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionExpires",{get:function(){var e=Math.floor(Date.now()/1e3)-this._subscriptionExpiresLastSet,t=this._subscriptionExpires-e;return Math.max(t,0)},set:function(e){if(e<0)throw new Error("Expires must be greater than or equal to zero.");if(this._subscriptionExpires=e,this._subscriptionExpiresLastSet=Math.floor(Date.now()/1e3),this.autoRefresh){var t=this.subscriptionRefresh;(void 0===t||t>=e)&&this.refreshTimerSet()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionExpiresInitial",{get:function(){return this._subscriptionExpiresInitial},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionRefresh",{get:function(){if(void 0!==this._subscriptionRefresh&&void 0!==this._subscriptionRefreshLastSet){var e=Math.floor(Date.now()/1e3)-this._subscriptionRefreshLastSet,t=this._subscriptionRefresh-e;return Math.max(t,0)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscriptionState",{get:function(){return this._subscriptionState},enumerable:!0,configurable:!0}),t.prototype.receiveRequest=function(t){if(this.logger.log("SUBSCRIBE dialog "+this.id+" received "+t.method+" request"),this.sequenceGuard(t))switch(e.prototype.receiveRequest.call(this,t),t.method){case o.C.NOTIFY:this.onNotify(t);break;default:this.logger.log("SUBSCRIBE dialog "+this.id+" received unimplemented "+t.method+" request"),this.core.replyStateless(t,{statusCode:501})}else this.logger.log("SUBSCRIBE dialog "+this.id+" rejected out of order "+t.method+" request.")},t.prototype.refresh=function(){var e="Allow: "+u.AllowedMethods.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: "+this.subscriptionExpiresInitial),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)},t.prototype.subscribe=function(e,t){var r=this;if(void 0===t&&(t={}),this.subscriptionState!==c.SubscriptionState.Pending&&this.subscriptionState!==c.SubscriptionState.Active)throw new Error("Invalid state "+this.subscriptionState+'. May only re-subscribe while in state "pending" or "active".');this.logger.log("SUBSCRIBE dialog "+this.id+" sending SUBSCRIBE request");var n=new h.ReSubscribeUserAgentClient(this,e,t);return this.N=setTimeout(function(){return r.timer_N()},a.Timers.TIMER_N),n},t.prototype.terminate=function(){this.stateTransition(c.SubscriptionState.Terminated),this.onTerminated()},t.prototype.unsubscribe=function(){var e="Allow: "+u.AllowedMethods.toString(),t={};return t.extraHeaders=(t.extraHeaders||[]).slice(),t.extraHeaders.push(e),t.extraHeaders.push("Event: "+this.subscriptionEvent),t.extraHeaders.push("Expires: 0"),t.extraHeaders.push("Contact: "+this.core.configuration.contact.toString()),this.subscribe(void 0,t)},t.prototype.onNotify=function(e){var t=e.parseHeader("Event").event;if(t&&t===this.subscriptionEvent){this.N&&(clearTimeout(this.N),this.N=void 0);var r=e.parseHeader("Subscription-State");if(r&&r.state){var n=r.state,i=r.expires?Math.max(r.expires,0):void 0;switch(n){case"pending":this.stateTransition(c.SubscriptionState.Pending,i);break;case"active":this.stateTransition(c.SubscriptionState.Active,i);break;case"terminated":this.stateTransition(c.SubscriptionState.Terminated,i);break;default:this.logger.warn("Unrecognized subscription state.")}var o=new d.NotifyUserAgentServer(this,e);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(o):o.accept()}else this.core.replyStateless(e,{statusCode:489})}else this.core.replyStateless(e,{statusCode:489})},t.prototype.onRefresh=function(e){this.delegate&&this.delegate.onRefresh&&this.delegate.onRefresh(e)},t.prototype.onTerminated=function(){this.delegate&&this.delegate.onTerminated&&this.delegate.onTerminated()},t.prototype.refreshTimerClear=function(){this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=void 0)},t.prototype.refreshTimerSet=function(){var e=this;if(this.refreshTimerClear(),this.autoRefresh&&this.subscriptionExpires>0){var t=900*this.subscriptionExpires;this._subscriptionRefresh=Math.floor(t/1e3),this._subscriptionRefreshLastSet=Math.floor(Date.now()/1e3),this.refreshTimer=setTimeout(function(){e.refreshTimer=void 0,e._subscriptionRefresh=void 0,e._subscriptionRefreshLastSet=void 0,e.onRefresh(e.refresh())},t)}},t.prototype.stateTransition=function(e,t){var r=this,n=function(){r.logger.warn("Invalid subscription state transition from "+r.subscriptionState+" to "+e)};switch(e){case c.SubscriptionState.Initial:case c.SubscriptionState.NotifyWait:return void n();case c.SubscriptionState.Pending:if(this.subscriptionState!==c.SubscriptionState.NotifyWait&&this.subscriptionState!==c.SubscriptionState.Pending)return void n();break;case c.SubscriptionState.Active:case c.SubscriptionState.Terminated:if(this.subscriptionState!==c.SubscriptionState.NotifyWait&&this.subscriptionState!==c.SubscriptionState.Pending&&this.subscriptionState!==c.SubscriptionState.Active)return void n();break;default:return void n()}e===c.SubscriptionState.Pending&&t&&(this.subscriptionExpires=t),e===c.SubscriptionState.Active&&t&&(this.subscriptionExpires=t),e===c.SubscriptionState.Terminated&&this.dispose(),this._subscriptionState=e},t.prototype.timer_N=function(){this.subscriptionState!==c.SubscriptionState.Terminated&&(this.stateTransition(c.SubscriptionState.Terminated),this.onTerminated())},t}(r(33).Dialog);t.SubscriptionDialog=p},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(1),a=function(e){function t(t,r,n){var i=this,a=t.createOutgoingRequestMessage(o.C.SUBSCRIBE,n);return(i=e.call(this,s.NonInviteClientTransaction,t.userAgentCore,a,r)||this).dialog=t,i}return i(t,e),t.prototype.waitNotifyStop=function(){},t.prototype.receiveResponse=function(t){if(t.statusCode&&t.statusCode>=200&&t.statusCode<300){var r=t.getHeader("Expires");if(r){var n=Number(r);this.dialog.subscriptionExpires>n&&(this.dialog.subscriptionExpires=n)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE")}if(t.statusCode&&t.statusCode>=400&&t.statusCode<700){[404,405,410,416,480,481,482,483,484,485,489,501,604].includes(t.statusCode)&&this.dialog.terminate()}e.prototype.receiveResponse.call(this,t)},t}(r(6).UserAgentClient);t.ReSubscribeUserAgentClient=a},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(3),a=r(7),c=r(5),u=r(35),d=r(114),h=function(t){function r(r,n,i){var o=t.call(this)||this;o.type=s.TypeStrings.SessionDescriptionHandler,o.options=i||{},o.logger=r,o.observer=n,o.dtmfSender=void 0,o.shouldAcquireMedia=!0,o.CONTENT_TYPE="application/sdp",o.C={DIRECTION:{NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"}},o.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(o.options)),o.direction=o.C.DIRECTION.NULL,o.modifiers=o.options.modifiers||[],Array.isArray(o.modifiers)||(o.modifiers=[o.modifiers]);var a=e.window||e;return o.WebRTC={MediaStream:a.MediaStream,getUserMedia:a.navigator.mediaDevices.getUserMedia.bind(a.navigator.mediaDevices),RTCPeerConnection:a.RTCPeerConnection},o.iceGatheringTimeout=!1,o.initPeerConnection(o.options.peerConnectionOptions),o.constraints=o.checkAndDefaultConstraints(o.options.constraints),o}return i(r,t),r.defaultFactory=function(e,t){return new r(e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),new d.SessionDescriptionHandlerObserver(e,t),t)},r.prototype.close=function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.resetIceGatheringComplete(),this.peerConnection.close())},r.prototype.getDescription=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]),e.peerConnectionOptions&&this.initPeerConnection(e.peerConnectionOptions);var n=Object.assign({},this.constraints,e.constraints);return n=this.checkAndDefaultConstraints(n),JSON.stringify(n)!==JSON.stringify(this.constraints)&&(this.constraints=n,this.shouldAcquireMedia=!0),Array.isArray(t)||(t=[t]),t=t.concat(this.modifiers),Promise.resolve().then(function(){if(r.shouldAcquireMedia)return r.acquire(r.constraints).then(function(){r.shouldAcquireMedia=!1})}).then(function(){return r.createOfferOrAnswer(e.RTCOfferOptions,t)}).then(function(e){if(void 0===e.sdp)throw new a.Exceptions.SessionDescriptionHandlerError("getDescription",void 0,"SDP undefined");return r.emit("getDescription",e),{body:e.sdp,contentType:r.CONTENT_TYPE}})},r.prototype.hasDescription=function(e){return e===this.CONTENT_TYPE},r.prototype.holdModifier=function(e){return e.sdp?(/a=(sendrecv|sendonly|recvonly|inactive)/.test(e.sdp)?(e.sdp=e.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):e.sdp=e.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),Promise.resolve(e)):Promise.resolve(e)},r.prototype.setDescription=function(e,t,r){var n=this;void 0===t&&(t={}),void 0===r&&(r=[]),t.peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions),Array.isArray(r)||(r=[r]),r=r.concat(this.modifiers);var i={type:this.hasOffer("local")?"answer":"offer",sdp:e};return Promise.resolve().then(function(){if(n.shouldAcquireMedia&&n.options.alwaysAcquireMediaFirst)return n.acquire(n.constraints).then(function(){n.shouldAcquireMedia=!1})}).then(function(){return c.Utils.reducePromises(r,i)}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("setDescription",e,"The modifiers did not resolve successfully");throw n.logger.error(t.message),n.emit("peerConnection-setRemoteDescriptionFailed",t),t}).then(function(e){return n.emit("setDescription",e),n.peerConnection.setRemoteDescription(e)}).catch(function(i){if(i.type===s.TypeStrings.SessionDescriptionHandlerError)throw i;if(/^m=video.+$/gm.test(e)&&!t.disableAudioFallback)return t.disableAudioFallback=!0,n.setDescription(e,t,[u.stripVideo].concat(r));var o=new a.Exceptions.SessionDescriptionHandlerError("setDescription",i);throw o.error&&n.logger.error(o.error),n.emit("peerConnection-setRemoteDescriptionFailed",o),o}).then(function(){n.peerConnection.getReceivers?n.emit("setRemoteDescription",n.peerConnection.getReceivers()):n.emit("setRemoteDescription",n.peerConnection.getRemoteStreams()),n.emit("confirmed",n)})},r.prototype.sendDtmf=function(e,t){if(void 0===t&&(t={}),!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var r=this.peerConnection.getSenders();r.length>0&&(this.dtmfSender=r[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var n=this.peerConnection.getLocalStreams();if(n.length>0){var i=n[0].getAudioTracks();i.length>0&&(this.dtmfSender=this.peerConnection.createDTMFSender(i[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0},r.prototype.getDirection=function(){return this.direction},r.prototype.on=function(e,r){return t.prototype.on.call(this,e,r)},r.prototype.createOfferOrAnswer=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]);var n=this.hasOffer("remote")?"createAnswer":"createOffer",i=this.peerConnection;return this.logger.log(n),(this.hasOffer("remote")?i.createAnswer:i.createOffer)(e).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-"+n+"Failed");throw r.emit("peerConnection-"+n+"Failed",t),t}).then(function(e){return c.Utils.reducePromises(t,r.createRTCSessionDescriptionInit(e))}).then(function(e){return r.resetIceGatheringComplete(),r.logger.log("Setting local sdp."),r.logger.log("sdp is "+e.sdp||!1),i.setLocalDescription(e)}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-SetLocalDescriptionFailed");throw r.emit("peerConnection-SetLocalDescriptionFailed",t),t}).then(function(){return r.waitForIceGatheringComplete()}).then(function(){var e=r.createRTCSessionDescriptionInit(r.peerConnection.localDescription);return c.Utils.reducePromises(t,e)}).then(function(e){return r.setDirection(e.sdp||""),e}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e);throw r.logger.error(t.toString()),t})},r.prototype.createRTCSessionDescriptionInit=function(e){return{type:e.type,sdp:e.sdp}},r.prototype.addDefaultIceCheckingTimeout=function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=5e3),e},r.prototype.addDefaultIceServers=function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e},r.prototype.checkAndDefaultConstraints=function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e},r.prototype.hasBrowserTrackSupport=function(){return Boolean(this.peerConnection.addTrack)},r.prototype.hasBrowserGetSenderSupport=function(){return Boolean(this.peerConnection.getSenders)},r.prototype.initPeerConnection=function(e){var t=this;void 0===e&&(e={}),(e=this.addDefaultIceCheckingTimeout(e)).rtcConfiguration=e.rtcConfiguration||{},e.rtcConfiguration=this.addDefaultIceServers(e.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new this.WebRTC.RTCPeerConnection(e.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",function(e){t.logger.log("track added"),t.observer.trackAdded(),t.emit("addTrack",e)}):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){t.logger.log("stream added"),t.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){t.emit("iceCandidate",e),e.candidate?t.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())):null===e.candidate&&(t.logger.log("ICE candidate gathering complete"),t.triggerIceGatheringComplete())},this.peerConnection.onicegatheringstatechange=function(){switch(t.logger.log("RTCIceGatheringState changed: "+t.peerConnection.iceGatheringState),t.peerConnection.iceGatheringState){case"gathering":t.emit("iceGathering",t),!t.iceGatheringTimer&&e.iceCheckingTimeout&&(t.iceGatheringTimeout=!1,t.iceGatheringTimer=setTimeout(function(){t.logger.log("RTCIceChecking Timeout Triggered after "+e.iceCheckingTimeout+" milliseconds"),t.iceGatheringTimeout=!0,t.triggerIceGatheringComplete()},e.iceCheckingTimeout));break;case"complete":t.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(t.peerConnection.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void t.logger.warn("Unknown iceConnection state: "+t.peerConnection.iceConnectionState)}t.logger.log("ICE Connection State changed to "+e),t.emit(e,t)}},r.prototype.acquire=function(e){var t=this;return e=this.checkAndDefaultConstraints(e),new Promise(function(r,n){t.logger.log("acquiring local media"),t.emit("userMediaRequest",e),e.audio||e.video?t.WebRTC.getUserMedia(e).then(function(e){t.observer.trackAdded(),t.emit("userMedia",e),r(e)}).catch(function(e){t.emit("userMediaFailed",e),n(e)}):r([])}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"unable to acquire streams");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r}).then(function(e){t.logger.log("acquired local media streams");try{return t.peerConnection.removeTrack&&t.peerConnection.getSenders().forEach(function(e){t.peerConnection.removeTrack(e)}),e}catch(e){return Promise.reject(e)}}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"error removing streams");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r}).then(function(e){try{(e=[].concat(e)).forEach(function(e){t.peerConnection.addTrack?e.getTracks().forEach(function(r){t.peerConnection.addTrack(r,e)}):t.peerConnection.addStream(e)})}catch(e){return Promise.reject(e)}return Promise.resolve()}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"error adding stream");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r})},r.prototype.hasOffer=function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t},r.prototype.isIceGatheringComplete=function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout},r.prototype.resetIceGatheringComplete=function(){this.iceGatheringTimeout=!1,this.logger.log("resetIceGatheringComplete"),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=void 0)},r.prototype.setDirection=function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var r=t[1];switch(r){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=r;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()},r.prototype.triggerIceGatheringComplete=function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=void 0))},r.prototype.waitForIceGatheringComplete=function(){return this.logger.log("waitForIceGatheringComplete"),this.isIceGatheringComplete()?(this.logger.log("ICE is already complete. Return resolved."),Promise.resolve()):(this.iceGatheringDeferred||(this.iceGatheringDeferred=c.Utils.defer()),this.logger.log("ICE is not complete. Returning promise"),this.iceGatheringDeferred?this.iceGatheringDeferred.promise:Promise.resolve())},r}(o.EventEmitter);t.SessionDescriptionHandler=h}).call(this,r(24))},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(3),a=r(7),c=r(11),u=r(47),d=r(5);!function(e){e[e.STATUS_CONNECTING=0]="STATUS_CONNECTING",e[e.STATUS_OPEN=1]="STATUS_OPEN",e[e.STATUS_CLOSING=2]="STATUS_CLOSING",e[e.STATUS_CLOSED=3]="STATUS_CLOSED"}(o=t.TransportStatus||(t.TransportStatus={}));var h=function(t){function r(r,n){void 0===n&&(n={});var i=t.call(this,r,n)||this;return i.WebSocket=(e.window||e).WebSocket,i.type=s.TypeStrings.Transport,i.reconnectionAttempts=0,i.status=o.STATUS_CONNECTING,i.configuration=i.loadConfig(n),i.server=i.configuration.wsServers[0],i}return i(r,t),r.prototype.isConnected=function(){return this.status===o.STATUS_OPEN},r.prototype.sendPromise=function(e,t){if(void 0===t&&(t={}),!this.statusAssert(o.STATUS_OPEN,t.force))return this.onError("unable to send message - WebSocket not open"),Promise.reject();var r=e.toString();return this.ws?(!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+r+"\n"),this.ws.send(r),Promise.resolve({msg:r})):(this.onError("unable to send message - WebSocket does not exist"),Promise.reject())},r.prototype.disconnectPromise=function(e){var t=this;return void 0===e&&(e={}),this.disconnectionPromise?this.disconnectionPromise:(e.code=e.code||1e3,this.statusTransition(o.STATUS_CLOSING,e.force)?(this.emit("disconnecting"),this.disconnectionPromise=new Promise(function(r,n){t.disconnectDeferredResolve=r,t.reconnectTimer&&(clearTimeout(t.reconnectTimer),t.reconnectTimer=void 0),t.ws?(t.stopSendingKeepAlives(),t.logger.log("closing WebSocket "+t.server.wsUri),t.ws.close(e.code,e.reason)):n("Attempted to disconnect but the websocket doesn't exist")}),this.disconnectionPromise):this.status===o.STATUS_CLOSED?Promise.resolve({overrideEvent:!0}):this.connectionPromise?this.connectionPromise.then(function(){return Promise.reject("The websocket did not disconnect")}).catch(function(){return Promise.resolve({overrideEvent:!0})}):Promise.reject("The websocket did not disconnect"))},r.prototype.connectPromise=function(e){var t=this;return void 0===e&&(e={}),this.status!==o.STATUS_CLOSING||e.force?this.connectionPromise?this.connectionPromise:(this.server=this.server||this.getNextWsServer(e.force),this.connectionPromise=new Promise(function(r,n){if((t.status===o.STATUS_OPEN||t.status===o.STATUS_CLOSING)&&!e.force)return t.logger.warn("WebSocket "+t.server.wsUri+" is already connected"),void n("Failed status check - attempted to open a connection but already open/closing");t.connectDeferredResolve=r,t.status=o.STATUS_CONNECTING,t.emit("connecting"),t.logger.log("connecting to WebSocket "+t.server.wsUri),t.disposeWs();try{t.ws=new WebSocket(t.server.wsUri,"sip")}catch(e){return t.ws=null,t.status=o.STATUS_CLOSED,t.onError("error connecting to WebSocket "+t.server.wsUri+":"+e),void n("Failed to create a websocket")}t.ws?(t.connectionTimeout=setTimeout(function(){t.statusTransition(o.STATUS_CLOSED),t.logger.warn("took too long to connect - exceeded time set in configuration.connectionTimeout: "+t.configuration.connectionTimeout+"s"),t.emit("disconnected",{code:1e3}),t.connectionPromise=void 0,n("Connection timeout")},1e3*t.configuration.connectionTimeout),t.boundOnOpen=t.onOpen.bind(t),t.boundOnMessage=t.onMessage.bind(t),t.boundOnClose=t.onClose.bind(t),t.boundOnError=t.onWebsocketError.bind(t),t.ws.addEventListener("open",t.boundOnOpen),t.ws.addEventListener("message",t.boundOnMessage),t.ws.addEventListener("close",t.boundOnClose),t.ws.addEventListener("error",t.boundOnError)):n("Unexpected instance websocket not set")}),this.connectionPromise):Promise.reject("WebSocket "+this.server.wsUri+" is closing")},r.prototype.onMessage=function(e){var t,r=e.data;if(/^(\r\n)+$/.test(r))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(r){if("string"!=typeof r){try{t=String.fromCharCode.apply(null,new Uint8Array(r))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+r+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+r+"\n"),t=r;this.emit("message",t)}else this.logger.warn("received empty message, message discarded")},r.prototype.onOpen=function(){if(this.status===o.STATUS_CLOSED){var e=this.ws;return this.disposeWs(),void e.close(1e3)}this.status=o.STATUS_OPEN,this.emit("connected"),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0),this.logger.log("WebSocket "+this.server.wsUri+" connected"),void 0!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0),this.reconnectionAttempts=0,this.disconnectionPromise=void 0,this.disconnectDeferredResolve=void 0,this.startSendingKeepAlives(),this.connectDeferredResolve?this.connectDeferredResolve({overrideEvent:!0}):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")},r.prototype.onClose=function(e){if(this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.status!==o.STATUS_CLOSING&&(this.logger.warn("WebSocket closed without SIP.js requesting it"),this.emit("transportError")),this.stopSendingKeepAlives(),this.connectionTimeout&&clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0,this.connectionPromise=void 0,this.connectDeferredResolve=void 0,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(o.STATUS_CLOSED),void(this.disconnectDeferredResolve=void 0);this.status=o.STATUS_CLOSED,this.emit("disconnected",{code:e.code,reason:e.reason}),this.reconnect()},r.prototype.disposeWs=function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.ws.removeEventListener("error",this.boundOnError),this.ws=void 0)},r.prototype.onError=function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")},r.prototype.onWebsocketError=function(){this.onError("The Websocket had an error")},r.prototype.reconnect=function(){var e=this;if(this.reconnectionAttempts>0&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("attempted to get next ws server but there are no available ws servers left"),this.logger.warn("no available ws servers left - going to closed state"),this.status=o.STATUS_CLOSED,this.emit("closed"),void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.wsUri),this.logger.log("transport "+this.server.wsUri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.noAvailableServers()||(this.server=this.getNextWsServer()),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.wsUri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=setTimeout(function(){e.connect(),e.reconnectTimer=void 0},1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))},r.prototype.resetServerErrorStatus=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++){t[e].isError=!1}},r.prototype.getNextWsServer=function(e){if(void 0===e&&(e=!1),this.noAvailableServers())throw this.logger.warn("attempted to get next ws server but there are no available ws servers left"),new Error("Attempted to get next ws server, but there are no available ws servers left.");for(var t=[],r=0,n=this.configuration.wsServers;r<n.length;r++){var i=n[r];i.isError&&!e||(0===t.length?t.push(i):i.weight>t[0].weight?t=[i]:i.weight===t[0].weight&&t.push(i))}return t[Math.floor(Math.random()*t.length)]},r.prototype.noAvailableServers=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++){if(!t[e].isError)return!1}return!0},r.prototype.sendKeepAlive=function(){var e=this;if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=setTimeout(function(){e.emit("keepAliveDebounceTimeout"),e.clearKeepAliveTimeout()},1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")},r.prototype.clearKeepAliveTimeout=function(){this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=void 0},r.prototype.startSendingKeepAlives=function(){var e,t,r=this;this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=setInterval(function(){r.sendKeepAlive(),r.startSendingKeepAlives()},(e=this.configuration.keepAliveInterval,t=.8*e,1e3*(Math.random()*(e-t)+t))))},r.prototype.stopSendingKeepAlives=function(){this.keepAliveInterval&&clearInterval(this.keepAliveInterval),this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=void 0,this.keepAliveDebounceTimeout=void 0},r.prototype.statusAssert=function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(o)[this.status]+" as "+Object.keys(o)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(o)[e]+" but is currently "+Object.keys(o)[this.status]),!1))},r.prototype.statusTransition=function(e,t){return void 0===t&&(t=!1),this.logger.log("Attempting to transition status from "+Object.keys(o)[this.status]+" to "+Object.keys(o)[e]),e===o.STATUS_CONNECTING&&this.statusAssert(o.STATUS_CLOSED,t)||e===o.STATUS_OPEN&&this.statusAssert(o.STATUS_CONNECTING,t)||e===o.STATUS_CLOSING&&this.statusAssert(o.STATUS_OPEN,t)||e===o.STATUS_CLOSED?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)},r.prototype.loadConfig=function(e){var t={wsServers:[{scheme:"WSS",sipUri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,wsUri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!1},r=this.getConfigurationCheck();for(var n in r.mandatory){if(!e.hasOwnProperty(n))throw new a.Exceptions.ConfigurationError(n);var i=e[n];if(void 0===(o=r.mandatory[n](i)))throw new a.Exceptions.ConfigurationError(n,i);t[n]=o}for(var n in r.optional)if(e.hasOwnProperty(n)){var o;if((i=e[n])instanceof Array&&0===i.length||null===i||""===i||void 0===i||"number"==typeof i&&isNaN(i))continue;if(void 0===(o=r.optional[n](i)))throw new a.Exceptions.ConfigurationError(n,i);t[n]=o}var s={};for(var n in t)t.hasOwnProperty(n)&&(s[n]={value:t[n]});var c=Object.defineProperties({},s);for(var n in this.logger.log("configuration parameters after validation:"),t)t.hasOwnProperty(n)&&this.logger.log("\xb7 "+n+": "+JSON.stringify(t[n]));return c},r.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{wsServers:function(e){if("string"==typeof e)e=[{wsUri:e}];else{if(!(e instanceof Array))return;for(var t=0;t<e.length;t++)"string"==typeof e[t]&&(e[t]={wsUri:e[t]})}if(0===e.length)return!1;for(var r=0,n=e;r<n.length;r++){var i=n[r];if(!i.wsUri)return;if(i.weight&&!Number(i.weight))return;var o=c.Grammar.parse(i.wsUri,"absoluteURI");if(-1===o)return;if(["wss","ws","udp"].indexOf(o.scheme)<0)return;i.sipUri="<sip:"+o.host+(o.port?":"+o.port:"")+";transport="+o.scheme.replace(/^wss$/i,"ws")+";lr>",i.weight||(i.weight=0),i.isError=!1,i.scheme=o.scheme.toUpperCase()}return e},keepAliveInterval:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},keepAliveDebounce:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},maxReconnectionAttempts:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},reconnectionTimeout:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}}}}},r.C=o,r}(u.Transport);t.Transport=h}).call(this,r(24))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(15);t.ClientContext=n.ClientContext;var i=r(2);t.C=i.C;var o=r(37);t.DigestAuthentication=o.DigestAuthentication;var s=r(3);t.DialogStatus=s.DialogStatus,t.SessionStatus=s.SessionStatus,t.TypeStrings=s.TypeStrings,t.UAStatus=s.UAStatus;var a=r(7);t.Exceptions=a.Exceptions;var c=r(11);t.Grammar=c.Grammar;var u=r(40);t.LoggerFactory=u.LoggerFactory;var d=r(18);t.NameAddrHeader=d.NameAddrHeader;var h=r(41);t.Parser=h.Parser;var p=r(42);t.PublishContext=p.PublishContext;var l=r(27);t.ReferClientContext=l.ReferClientContext,t.ReferServerContext=l.ReferServerContext;var f=r(44);t.RegisterContext=f.RegisterContext;var g=r(22);t.ServerContext=g.ServerContext;var v=r(45);t.InviteClientContext=v.InviteClientContext,t.InviteServerContext=v.InviteServerContext,t.Session=v.Session;var m=r(8);t.IncomingRequest=m.IncomingRequest,t.IncomingResponse=m.IncomingResponse,t.OutgoingRequest=m.OutgoingRequest;var y=r(46);t.Subscription=y.Subscription;var S=r(12);t.Timers=S.Timers;var T=r(1),C={InviteClientTransaction:T.InviteClientTransaction,InviteServerTransaction:T.InviteServerTransaction,NonInviteClientTransaction:T.NonInviteClientTransaction,NonInviteServerTransaction:T.NonInviteServerTransaction};t.Transactions=C;var b=r(47);t.Transport=b.Transport;var _=r(48);t.UA=_.UA;var A=r(19);t.URI=A.URI;var w=r(5);t.Utils=w.Utils;var E=r(115);t.Web=E;var R=r(36),I=R.title;t.name=I;var O=R.version;t.version=O},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(18),s=r(19),a=function(e){function t(r,n,i,o){var s=e.call(this)||this;return s.message=r,s.expected=n,s.found=i,s.location=o,s.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(s,t),s}return i(t,e),t.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function o(e){switch(e.type){case"literal":return'"'+n(e.text)+'"';case"class":var t=e.parts.map(function(e){return Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)});return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){var t,r,n=e.map(o);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+((s=t)?'"'+n(s)+'"':"end of input")+" found.";var s},t}(Error);t.SyntaxError=a,t.parse=function(e,t){t=void 0!==t?t:{};var r,n={},i={Contact:Ba,Name_Addr_Header:function(){var e,t,r,i,o,s,a;for(e=ms,t=[],r=za();r!==n;)t.push(r),r=za();if(t!==n)if((r=ra())!==n)if(pa()!==n)if(ta()!==n){for(i=[],o=ms,(s=ia())!==n&&(a=Ya())!==n?o=s=[s,a]:(ms=o,o=n);o!==n;)i.push(o),o=ms,(s=ia())!==n&&(a=Ya())!==n?o=s=[s,a]:(ms=o,o=n);i!==n?(ys=e,t=Gn(),e=t):(ms=e,e=n)}else ms=e,e=n;else ms=e,e=n;else ms=e,e=n;else ms=e,e=n;return e},Record_Route:function(){var e,t,r,i,o,s;if(e=ms,(t=sc())!==n){for(r=[],i=ms,(o=na())!==n&&(s=sc())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=na())!==n&&(s=sc())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,t=wi(),e=t):(ms=e,e=n)}else ms=e,e=n;return e},Request_Response:Pa,SIP_URI:pa,Subscription_State:function(){var t,r,i,o,s,a;if(t=ms,(r=function(){var t,r;return t=ms,e.substr(ms,6).toLowerCase()===Bi?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(Gi)),r===n&&(e.substr(ms,7).toLowerCase()===Wi?(r=e.substr(ms,7),ms+=7):(r=n,0===bs&&Os(zi)),r===n&&(e.substr(ms,10).toLowerCase()===Ki?(r=e.substr(ms,10),ms+=10):(r=n,0===bs&&Os(Vi)),r===n&&(r=Xs()))),r!==n&&(ys=t,r=Yi()),t=r}())!==n){for(i=[],o=ms,(s=ia())!==n&&(a=cc())!==n?o=s=[s,a]:(ms=o,o=n);o!==n;)i.push(o),o=ms,(s=ia())!==n&&(a=cc())!==n?o=s=[s,a]:(ms=o,o=n);i!==n?t=r=[r,i]:(ms=t,t=n)}else ms=t,t=n;return t},Supported:function(){var e,t,r,i,o,s,a;if(e=ms,t=ms,(r=Xs())!==n){for(i=[],o=ms,(s=na())!==n&&(a=Xs())!==n?(ys=o,s=ji(r,a),o=s):(ms=o,o=n);o!==n;)i.push(o),o=ms,(s=na())!==n&&(a=Xs())!==n?(ys=o,s=ji(r,a),o=s):(ms=o,o=n);i!==n?(ys=t,r=Li(r,i),t=r):(ms=t,t=n)}else ms=t,t=n;return t===n&&(t=null),t!==n&&(ys=e,t=mo(t)),e=t},Require:function(){var e,t,r,i,o,s,a;if(e=ms,t=ms,(r=Xs())!==n){for(i=[],o=ms,(s=na())!==n&&(a=Xs())!==n?(ys=o,s=ji(r,a),o=s):(ms=o,o=n);o!==n;)i.push(o),o=ms,(s=na())!==n&&(a=Xs())!==n?(ys=o,s=ji(r,a),o=s):(ms=o,o=n);i!==n?(ys=t,r=Li(r,i),t=r):(ms=t,t=n)}else ms=t,t=n;return t===n&&(t=null),t!==n&&(ys=e,t=Fi(t)),e=t},Via:function(){var e,t,r,i,o,s;if(e=ms,(t=dc())!==n){for(r=[],i=ms,(o=na())!==n&&(s=dc())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=na())!==n&&(s=dc())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?e=t=[t,r]:(ms=e,e=n)}else ms=e,e=n;return e},absoluteURI:Na,Call_ID:Fa,Content_Disposition:function(){var t,r,i,o,s,a;if(t=ms,(r=function(){var t,r;return t=ms,e.substr(ms,6).toLowerCase()===rn?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(nn)),r===n&&(e.substr(ms,7).toLowerCase()===on?(r=e.substr(ms,7),ms+=7):(r=n,0===bs&&Os(sn)),r===n&&(e.substr(ms,4).toLowerCase()===an?(r=e.substr(ms,4),ms+=4):(r=n,0===bs&&Os(cn)),r===n&&(e.substr(ms,5).toLowerCase()===un?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(dn)),r===n&&(r=Xs())))),r!==n&&(ys=t,r=hn()),t=r}())!==n){for(i=[],o=ms,(s=ia())!==n&&(a=$a())!==n?o=s=[s,a]:(ms=o,o=n);o!==n;)i.push(o),o=ms,(s=ia())!==n&&(a=$a())!==n?o=s=[s,a]:(ms=o,o=n);i!==n?t=r=[r,i]:(ms=t,t=n)}else ms=t,t=n;return t},Content_Length:function(){var e,t,r;if(e=ms,t=[],(r=Ns())!==n)for(;r!==n;)t.push(r),r=Ns();else t=n;return t!==n&&(ys=e,t=yn(t)),e=t},Content_Type:function(){var t,r;return t=ms,(r=function(){var t,r,i,o,s,a,c,u;if(t=ms,(r=function(){var t;return(t=function(){var t;return e.substr(ms,4).toLowerCase()===Tn?(t=e.substr(ms,4),ms+=4):(t=n,0===bs&&Os(Cn)),t===n&&(e.substr(ms,5).toLowerCase()===bn?(t=e.substr(ms,5),ms+=5):(t=n,0===bs&&Os(_n)),t===n&&(e.substr(ms,5).toLowerCase()===An?(t=e.substr(ms,5),ms+=5):(t=n,0===bs&&Os(wn)),t===n&&(e.substr(ms,5).toLowerCase()===En?(t=e.substr(ms,5),ms+=5):(t=n,0===bs&&Os(Rn)),t===n&&(e.substr(ms,11).toLowerCase()===In?(t=e.substr(ms,11),ms+=11):(t=n,0===bs&&Os(On)),t===n&&(t=Xa()))))),t}())===n&&(t=function(){var t;return e.substr(ms,7).toLowerCase()===xn?(t=e.substr(ms,7),ms+=7):(t=n,0===bs&&Os(Pn)),t===n&&(e.substr(ms,9).toLowerCase()===Nn?(t=e.substr(ms,9),ms+=9):(t=n,0===bs&&Os(Dn)),t===n&&(t=Xa())),t}()),t}())!==n)if((i=Zs())!==n)if((o=function(){var e;return(e=Xa())===n&&(e=Xs()),e}())!==n){for(s=[],a=ms,(c=ia())!==n&&(u=Ja())!==n?a=c=[c,u]:(ms=a,a=n);a!==n;)s.push(a),a=ms,(c=ia())!==n&&(u=Ja())!==n?a=c=[c,u]:(ms=a,a=n);s!==n?t=r=[r,i,o,s]:(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;else ms=t,t=n;return t}())!==n&&(ys=t,r=Sn()),t=r},CSeq:function(){var e,t,r,i;return e=ms,(t=function(){var e,t,r;if(e=ms,t=[],(r=Ns())!==n)for(;r!==n;)t.push(r),r=Ns();else t=n;return t!==n&&(ys=e,t=kn(t)),e=t}())!==n&&(r=zs())!==n&&(i=La())!==n?e=t=[t,r,i]:(ms=e,e=n),e},displayName:za,Event:function(){var e,t,r,i,o,s;if(e=ms,(t=Qa())!==n){for(r=[],i=ms,(o=ia())!==n&&(s=Ya())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=ia())!==n&&(s=Ya())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,t=Mn(t),e=t):(ms=e,e=n)}else ms=e,e=n;return e},From:function(){var e,t,r,i,o,s;if(e=ms,(t=ha())===n&&(t=Wa()),t!==n){for(r=[],i=ms,(o=ia())!==n&&(s=Za())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=ia())!==n&&(s=Za())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,t=qn(),e=t):(ms=e,e=n)}else ms=e,e=n;return e},host:ma,Max_Forwards:function(){var e,t,r;if(e=ms,t=[],(r=Ns())!==n)for(;r!==n;)t.push(r),r=Ns();else t=n;return t!==n&&(ys=e,t=Bn(t)),e=t},Min_SE:function(){var e,t,r,i,o,s;if(e=ms,(t=Va())!==n){for(r=[],i=ms,(o=ia())!==n&&(s=Ya())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=ia())!==n&&(s=Ya())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,t=Jo(t),e=t):(ms=e,e=n)}else ms=e,e=n;return e},Proxy_Authenticate:function(){return tc()},quoted_string:aa,Refer_To:function(){var e,t,r,i,o,s;if(e=ms,(t=ha())===n&&(t=Wa())===n&&(t=ms,(r=ra())===n&&(r=null),r!==n&&(i=Na())!==n?((o=ta())===n&&(o=null),o!==n?t=r=[r,i,o]:(ms=t,t=n)):(ms=t,t=n)),t!==n){for(r=[],i=ms,(o=ia())!==n&&(s=Ya())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=ia())!==n&&(s=Ya())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,t=Ri(),e=t):(ms=e,e=n)}else ms=e,e=n;return e},Replaces:function(){var e,t,r,i,o,s;if(e=ms,(t=function(){var e,t;return e=ms,(t=Fa())!==n&&(ys=e,t=Oi()),e=t}())!==n){for(r=[],i=ms,(o=ia())!==n&&(s=ac())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=ia())!==n&&(s=ac())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,t=Ii(),e=t):(ms=e,e=n)}else ms=e,e=n;return e},Session_Expires:function(){var e,t,r,i,o,s;if(e=ms,(t=Va())!==n){for(r=[],i=ms,(o=ia())!==n&&(s=fc())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=ia())!==n&&(s=fc())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,t=Go(t),e=t):(ms=e,e=n)}else ms=e,e=n;return e},stun_URI:function(){var t,r,i,o;return t=ms,(r=function(){var t,r;return t=ms,e.substr(ms,5).toLowerCase()===Qo?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(Zo)),r===n&&(e.substr(ms,4).toLowerCase()===es?(r=e.substr(ms,4),ms+=4):(r=n,0===bs&&Os(ts))),r!==n&&(ys=t,r=rs(r)),t=r}())!==n?(58===e.charCodeAt(ms)?(i=D,ms++):(i=n,0===bs&&Os(U)),i!==n&&(o=gc())!==n?t=r=[r,i,o]:(ms=t,t=n)):(ms=t,t=n),t},To:function(){var e,t,r,i,o,s;if(e=ms,(t=ha())===n&&(t=Wa()),t!==n){for(r=[],i=ms,(o=ia())!==n&&(s=uc())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=ia())!==n&&(s=uc())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,t=yo(),e=t):(ms=e,e=n)}else ms=e,e=n;return e},turn_URI:function(){var t,r,i,o,s,a,c;return t=ms,(r=function(){var t,r;return t=ms,e.substr(ms,5).toLowerCase()===ss?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(as)),r===n&&(e.substr(ms,4).toLowerCase()===cs?(r=e.substr(ms,4),ms+=4):(r=n,0===bs&&Os(us))),r!==n&&(ys=t,r=rs(r)),t=r}())!==n?(58===e.charCodeAt(ms)?(i=D,ms++):(i=n,0===bs&&Os(U)),i!==n&&(o=gc())!==n?(s=ms,e.substr(ms,11)===is?(a=is,ms+=11):(a=n,0===bs&&Os(os)),a!==n&&(c=pc())!==n?s=a=[a,c]:(ms=s,s=n),s===n&&(s=null),s!==n?t=r=[r,i,o,s]:(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t},uuid:function(){var t,r,i,o,s,a;return t=ms,(r=function(){var e,t,r;return e=ms,(t=vc())!==n&&(r=vc())!==n?e=t=[t,r]:(ms=e,e=n),e}())!==n?(45===e.charCodeAt(ms)?(i=V,ms++):(i=n,0===bs&&Os(Y)),i!==n&&vc()!==n?(45===e.charCodeAt(ms)?(o=V,ms++):(o=n,0===bs&&Os(Y)),o!==n&&vc()!==n?(45===e.charCodeAt(ms)?(s=V,ms++):(s=n,0===bs&&Os(Y)),s!==n&&vc()!==n?(45===e.charCodeAt(ms)?(a=V,ms++):(a=n,0===bs&&Os(Y)),a!==n&&function(){var e,t,r,i;return e=ms,(t=vc())!==n&&(r=vc())!==n&&(i=vc())!==n?e=t=[t,r,i]:(ms=e,e=n),e}()!==n?(ys=t,r=ds(),t=r):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t},WWW_Authenticate:function(){return tc()},challenge:tc,sipfrag:function(){var e,t,r,i,o,s;if(e=ms,(t=Pa())!==n){for(r=[],i=Oa();i!==n;)r.push(i),i=Oa();r!==n?(i=ms,(o=Ps())!==n&&(s=function(){var e,t;for(e=[],t=ks();t!==n;)e.push(t),t=ks();return e}())!==n?i=o=[o,s]:(ms=i,i=n),i===n&&(i=null),i!==n?e=t=[t,r,i]:(ms=e,e=n)):(ms=e,e=n)}else ms=e,e=n;return e},Referred_By:function(){var t,r,i,o,s,a,c,u;if(t=ms,e.substr(ms,11)===hs?(r=hs,ms+=11):(r=n,0===bs&&Os(ps)),r===n&&(98===e.charCodeAt(ms)?(r=ls,ms++):(r=n,0===bs&&Os(fs))),r!==n)if((i=Vs())!==n)if((o=function(){var e;return(e=Wa())===n&&(e=ha()),e}())!==n){for(s=[],a=ms,(c=ia())!==n?((u=mc())===n&&(u=Ya()),u!==n?a=c=[c,u]:(ms=a,a=n)):(ms=a,a=n);a!==n;)s.push(a),a=ms,(c=ia())!==n?((u=mc())===n&&(u=Ya()),u!==n?a=c=[c,u]:(ms=a,a=n)):(ms=a,a=n);s!==n?t=r=[r,i,o,s]:(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;else ms=t,t=n;return t}},c=Ba,u="\r\n",d=ws("\r\n",!1),h=/^[0-9]/,p=Es([["0","9"]],!1,!1),l=/^[a-zA-Z]/,f=Es([["a","z"],["A","Z"]],!1,!1),g=/^[0-9a-fA-F]/,v=Es([["0","9"],["a","f"],["A","F"]],!1,!1),m=/^[\0-\xFF]/,y=Es([["\0","\xff"]],!1,!1),S=/^["]/,T=Es(['"'],!1,!1),C=" ",b=ws(" ",!1),_="\t",A=ws("\t",!1),w=/^[a-zA-Z0-9]/,E=Es([["a","z"],["A","Z"],["0","9"]],!1,!1),R=";",I=ws(";",!1),O="/",x=ws("/",!1),P="?",N=ws("?",!1),D=":",U=ws(":",!1),H="@",k=ws("@",!1),M="&",q=ws("&",!1),j="=",L=ws("=",!1),F="+",B=ws("+",!1),G="$",W=ws("$",!1),z=",",K=ws(",",!1),V="-",Y=ws("-",!1),$="_",X=ws("_",!1),J=".",Q=ws(".",!1),Z="!",ee=ws("!",!1),te="~",re=ws("~",!1),ne="*",ie=ws("*",!1),oe="'",se=ws("'",!1),ae="(",ce=ws("(",!1),ue=")",de=ws(")",!1),he="%",pe=ws("%",!1),le=function(){return" "},fe=function(){return":"},ge=(Es([["!","~"]],!1,!1),/^[\x80-\uFFFF]/),ve=Es([["\x80","\uffff"]],!1,!1),me=/^[\x80-\xBF]/,ye=Es([["\x80","\xbf"]],!1,!1),Se=(Es([["a","f"]],!1,!1),"`"),Te=ws("`",!1),Ce="<",be=ws("<",!1),_e=">",Ae=ws(">",!1),we="\\",Ee=ws("\\",!1),Re="[",Ie=ws("[",!1),Oe="]",xe=ws("]",!1),Pe="{",Ne=ws("{",!1),De="}",Ue=ws("}",!1),He=function(){return"*"},ke=function(){return"/"},Me=function(){return"="},qe=function(){return">"},je=function(){return"<"},Le=function(){return","},Fe=function(){return";"},Be=function(){return":"},Ge=function(){return'"'},We=(Es([["!","'"]],!1,!1),Es([["*","["]],!1,!1),/^[\]-~]/),ze=Es([["]","~"]],!1,!1),Ke=function(e){return e},Ve=/^[#-[]/,Ye=Es([["#","["]],!1,!1),$e=/^[\0-\t]/,Xe=Es([["\0","\t"]],!1,!1),Je=/^[\x0B-\f]/,Qe=Es([["\v","\f"]],!1,!1),Ze=/^[\x0E-\x7F]/,et=Es([["\x0e","\x7f"]],!1,!1),tt=function(){(t=t||{data:{}}).data.uri=new s.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},rt=function(){(t=t||{data:{}}).data.uri=new s.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},nt="sips",it=ws("sips",!0),ot="sip",st=ws("sip",!0),at=function(e){(t=t||{data:{}}).data.scheme=e},ct=function(){(t=t||{data:{}}).data.user=decodeURIComponent(_s().slice(0,-1))},ut=function(){(t=t||{data:{}}).data.password=_s()},dt=function(){return(t=t||{data:{}}).data.host=_s(),t.data.host},ht=function(){return(t=t||{data:{}}).data.host_type="domain",_s()},pt=/^[a-zA-Z0-9_\-]/,lt=Es([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),ft=/^[a-zA-Z0-9\-]/,gt=Es([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),vt=function(){return(t=t||{data:{}}).data.host_type="IPv6",_s()},mt="::",yt=ws("::",!1),St=function(){return(t=t||{data:{}}).data.host_type="IPv6",_s()},Tt=function(){return(t=t||{data:{}}).data.host_type="IPv4",_s()},Ct="25",bt=ws("25",!1),_t=/^[0-5]/,At=Es([["0","5"]],!1,!1),wt="2",Et=ws("2",!1),Rt=/^[0-4]/,It=Es([["0","4"]],!1,!1),Ot="1",xt=ws("1",!1),Pt=/^[1-9]/,Nt=Es([["1","9"]],!1,!1),Dt=function(e){return t=t||{data:{}},e=parseInt(e.join("")),t.data.port=e,e},Ut="transport=",Ht=ws("transport=",!0),kt="udp",Mt=ws("udp",!0),qt="tcp",jt=ws("tcp",!0),Lt="sctp",Ft=ws("sctp",!0),Bt="tls",Gt=ws("tls",!0),Wt=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},zt="user=",Kt=ws("user=",!0),Vt="phone",Yt=ws("phone",!0),$t="ip",Xt=ws("ip",!0),Jt=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},Qt="method=",Zt=ws("method=",!0),er=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},tr="ttl=",rr=ws("ttl=",!0),nr=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.ttl=e},ir="maddr=",or=ws("maddr=",!0),sr=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},ar="lr",cr=ws("lr",!0),ur=function(){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},dr=function(e,r){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),r=null===r?void 0:r[1],t.data.uri_params[e.toLowerCase()]=r},hr=function(e,r){e=e.join("").toLowerCase(),r=r.join(""),(t=t||{data:{}}).data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(r):t.data.uri_headers[e]=[r]},pr=function(){"Refer_To"===(t=t||{data:{}}).startRule&&(t.data.uri=new s.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},lr="//",fr=ws("//",!1),gr=function(){(t=t||{data:{}}).data.scheme=_s()},vr=ws("SIP",!0),mr=function(){(t=t||{data:{}}).data.sip_version=_s()},yr="INVITE",Sr=ws("INVITE",!1),Tr="ACK",Cr=ws("ACK",!1),br=(ws("VXACH",!1),"OPTIONS"),_r=ws("OPTIONS",!1),Ar="BYE",wr=ws("BYE",!1),Er="CANCEL",Rr=ws("CANCEL",!1),Ir="REGISTER",Or=ws("REGISTER",!1),xr="SUBSCRIBE",Pr=ws("SUBSCRIBE",!1),Nr="NOTIFY",Dr=ws("NOTIFY",!1),Ur="REFER",Hr=ws("REFER",!1),kr="PUBLISH",Mr=ws("PUBLISH",!1),qr=function(){return(t=t||{data:{}}).data.method=_s(),t.data.method},jr=function(e){(t=t||{data:{}}).data.status_code=parseInt(e.join(""))},Lr=function(){(t=t||{data:{}}).data.reason_phrase=_s()},Fr=function(){(t=t||{data:{}}).data=_s()},Br=function(){var e,r;for(r=(t=t||{data:{}}).data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},Gr=function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:ms,offset:As().start.offset,parsed:e})},Wr=function(e){'"'===(e=_s().trim())[0]&&(e=e.substring(1,e.length-1)),(t=t||{data:{}}).data.displayName=e},zr="q",Kr=ws("q",!0),Vr=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.q=e},Yr="expires",$r=ws("expires",!0),Xr=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.expires=e},Jr=function(e){return parseInt(e.join(""))},Qr="0",Zr=ws("0",!1),en=function(){return parseFloat(_s())},tn=function(e,r){(t=t||{data:{}}).data.params||(t.data.params={}),r=null===r?void 0:r[1],t.data.params[e.toLowerCase()]=r},rn="render",nn=ws("render",!0),on="session",sn=ws("session",!0),an="icon",cn=ws("icon",!0),un="alert",dn=ws("alert",!0),hn=function(){"Content_Disposition"===(t=t||{data:{}}).startRule&&(t.data.type=_s().toLowerCase())},pn="handling",ln=ws("handling",!0),fn="optional",gn=ws("optional",!0),vn="required",mn=ws("required",!0),yn=function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},Sn=function(){(t=t||{data:{}}).data=_s()},Tn="text",Cn=ws("text",!0),bn="image",_n=ws("image",!0),An="audio",wn=ws("audio",!0),En="video",Rn=ws("video",!0),In="application",On=ws("application",!0),xn="message",Pn=ws("message",!0),Nn="multipart",Dn=ws("multipart",!0),Un="x-",Hn=ws("x-",!0),kn=function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},Mn=function(e){(t=t||{data:{}}).data.event=e.toLowerCase()},qn=function(){var e=(t=t||{data:{}}).data.tag;t.data=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},jn="tag",Ln=ws("tag",!0),Fn=function(e){(t=t||{data:{}}).data.tag=e},Bn=function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},Gn=function(){(t=t||{data:{}}).data=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},Wn="digest",zn=ws("Digest",!0),Kn="realm",Vn=ws("realm",!0),Yn=function(e){(t=t||{data:{}}).data.realm=e},$n="domain",Xn=ws("domain",!0),Jn="nonce",Qn=ws("nonce",!0),Zn=function(e){(t=t||{data:{}}).data.nonce=e},ei="opaque",ti=ws("opaque",!0),ri=function(e){(t=t||{data:{}}).data.opaque=e},ni="stale",ii=ws("stale",!0),oi="true",si=ws("true",!0),ai=function(){(t=t||{data:{}}).data.stale=!0},ci="false",ui=ws("false",!0),di=function(){(t=t||{data:{}}).data.stale=!1},hi="algorithm",pi=ws("algorithm",!0),li="md5",fi=ws("MD5",!0),gi="md5-sess",vi=ws("MD5-sess",!0),mi=function(e){(t=t||{data:{}}).data.algorithm=e.toUpperCase()},yi="qop",Si=ws("qop",!0),Ti="auth-int",Ci=ws("auth-int",!0),bi="auth",_i=ws("auth",!0),Ai=function(e){(t=t||{data:{}}).data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},wi=function(){var e,r;for(r=(t=t||{data:{}}).data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},Ei=function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:ms,offset:As().start.offset,parsed:e})},Ri=function(){(t=t||{data:{}}).data=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},Ii=function(){(t=t||{data:{}}).data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},Oi=function(){(t=t||{data:{}}).data={call_id:t.data}},xi="from-tag",Pi=ws("from-tag",!0),Ni=function(e){(t=t||{data:{}}).data.replaces_from_tag=e},Di="to-tag",Ui=ws("to-tag",!0),Hi=function(e){(t=t||{data:{}}).data.replaces_to_tag=e},ki="early-only",Mi=ws("early-only",!0),qi=function(){(t=t||{data:{}}).data.early_only=!0},ji=function(e,t){return t},Li=function(e,t){return function(e,t){return[e].concat(t)}(e,t)},Fi=function(e){"Require"===(t=t||{data:{}}).startRule&&(t.data=e||[])},Bi="active",Gi=ws("active",!0),Wi="pending",zi=ws("pending",!0),Ki="terminated",Vi=ws("terminated",!0),Yi=function(){(t=t||{data:{}}).data.state=_s()},$i="reason",Xi=ws("reason",!0),Ji=function(e){t=t||{data:{}},void 0!==e&&(t.data.reason=e)},Qi=function(e){t=t||{data:{}},void 0!==e&&(t.data.expires=e)},Zi="retry_after",eo=ws("retry_after",!0),to=function(e){t=t||{data:{}},void 0!==e&&(t.data.retry_after=e)},ro="deactivated",no=ws("deactivated",!0),io="probation",oo=ws("probation",!0),so="rejected",ao=ws("rejected",!0),co="timeout",uo=ws("timeout",!0),ho="giveup",po=ws("giveup",!0),lo="noresource",fo=ws("noresource",!0),go="invariant",vo=ws("invariant",!0),mo=function(e){"Supported"===(t=t||{data:{}}).startRule&&(t.data=e||[])},yo=function(){var e=(t=t||{data:{}}).data.tag;t.data=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},So="ttl",To=ws("ttl",!0),Co=function(e){(t=t||{data:{}}).data.ttl=e},bo="maddr",_o=ws("maddr",!0),Ao=function(e){(t=t||{data:{}}).data.maddr=e},wo="received",Eo=ws("received",!0),Ro=function(e){(t=t||{data:{}}).data.received=e},Io="branch",Oo=ws("branch",!0),xo=function(e){(t=t||{data:{}}).data.branch=e},Po="rport",No=ws("rport",!0),Do=function(e){t=t||{data:{}},void 0!==e&&(t.data.rport=e.join(""))},Uo=function(e){(t=t||{data:{}}).data.protocol=e},Ho=ws("UDP",!0),ko=ws("TCP",!0),Mo=ws("TLS",!0),qo=ws("SCTP",!0),jo=function(e){(t=t||{data:{}}).data.transport=e},Lo=function(){(t=t||{data:{}}).data.host=_s()},Fo=function(e){(t=t||{data:{}}).data.port=parseInt(e.join(""))},Bo=function(e){return parseInt(e.join(""))},Go=function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.deltaSeconds=e)},Wo="refresher",zo=ws("refresher",!1),Ko="uas",Vo=ws("uas",!1),Yo="uac",$o=ws("uac",!1),Xo=function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.refresher=e)},Jo=function(e){"Min_SE"===(t=t||{data:{}}).startRule&&(t.data=e)},Qo="stuns",Zo=ws("stuns",!0),es="stun",ts=ws("stun",!0),rs=function(e){(t=t||{data:{}}).data.scheme=e},ns=function(e){(t=t||{data:{}}).data.host=e},is="?transport=",os=ws("?transport=",!1),ss="turns",as=ws("turns",!0),cs="turn",us=ws("turn",!0),ds=function(){(t=t||{data:{}}).data=_s()},hs="Referred-By",ps=ws("Referred-By",!1),ls="b",fs=ws("b",!1),gs="cid",vs=ws("cid",!1),ms=0,ys=0,Ss=[{line:1,column:1}],Ts=0,Cs=[],bs=0;if(void 0!==t.startRule){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');c=i[t.startRule]}function _s(){return e.substring(ys,ms)}function As(){return Is(ys,ms)}function ws(e,t){return{type:"literal",text:e,ignoreCase:t}}function Es(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Rs(t){var r,n=Ss[t];if(n)return n;for(r=t-1;!Ss[r];)r--;for(n={line:(n=Ss[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ss[t]=n,n}function Is(e,t){var r=Rs(e),n=Rs(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Os(e){ms<Ts||(ms>Ts&&(Ts=ms,Cs=[]),Cs.push(e))}function xs(e,t,r){return new a(a.buildMessage(e,t),e,t,r)}function Ps(){var t;return e.substr(ms,2)===u?(t=u,ms+=2):(t=n,0===bs&&Os(d)),t}function Ns(){var t;return h.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(p)),t}function Ds(){var t;return l.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(f)),t}function Us(){var t;return g.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(v)),t}function Hs(){var e;return(e=qs())===n&&(e=js()),e}function ks(){var t;return m.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(y)),t}function Ms(){var t;return S.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(T)),t}function qs(){var t;return 32===e.charCodeAt(ms)?(t=C,ms++):(t=n,0===bs&&Os(b)),t}function js(){var t;return 9===e.charCodeAt(ms)?(t=_,ms++):(t=n,0===bs&&Os(A)),t}function Ls(){var t;return w.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(E)),t}function Fs(){var t;return 59===e.charCodeAt(ms)?(t=R,ms++):(t=n,0===bs&&Os(I)),t===n&&(47===e.charCodeAt(ms)?(t=O,ms++):(t=n,0===bs&&Os(x)),t===n&&(63===e.charCodeAt(ms)?(t=P,ms++):(t=n,0===bs&&Os(N)),t===n&&(58===e.charCodeAt(ms)?(t=D,ms++):(t=n,0===bs&&Os(U)),t===n&&(64===e.charCodeAt(ms)?(t=H,ms++):(t=n,0===bs&&Os(k)),t===n&&(38===e.charCodeAt(ms)?(t=M,ms++):(t=n,0===bs&&Os(q)),t===n&&(61===e.charCodeAt(ms)?(t=j,ms++):(t=n,0===bs&&Os(L)),t===n&&(43===e.charCodeAt(ms)?(t=F,ms++):(t=n,0===bs&&Os(B)),t===n&&(36===e.charCodeAt(ms)?(t=G,ms++):(t=n,0===bs&&Os(W)),t===n&&(44===e.charCodeAt(ms)?(t=z,ms++):(t=n,0===bs&&Os(K))))))))))),t}function Bs(){var e;return(e=Ls())===n&&(e=Gs()),e}function Gs(){var t;return 45===e.charCodeAt(ms)?(t=V,ms++):(t=n,0===bs&&Os(Y)),t===n&&(95===e.charCodeAt(ms)?(t=$,ms++):(t=n,0===bs&&Os(X)),t===n&&(46===e.charCodeAt(ms)?(t=J,ms++):(t=n,0===bs&&Os(Q)),t===n&&(33===e.charCodeAt(ms)?(t=Z,ms++):(t=n,0===bs&&Os(ee)),t===n&&(126===e.charCodeAt(ms)?(t=te,ms++):(t=n,0===bs&&Os(re)),t===n&&(42===e.charCodeAt(ms)?(t=ne,ms++):(t=n,0===bs&&Os(ie)),t===n&&(39===e.charCodeAt(ms)?(t=oe,ms++):(t=n,0===bs&&Os(se)),t===n&&(40===e.charCodeAt(ms)?(t=ae,ms++):(t=n,0===bs&&Os(ce)),t===n&&(41===e.charCodeAt(ms)?(t=ue,ms++):(t=n,0===bs&&Os(de)))))))))),t}function Ws(){var t,r,i,o,s;return t=ms,r=ms,37===e.charCodeAt(ms)?(i=he,ms++):(i=n,0===bs&&Os(pe)),i!==n&&(o=Us())!==n&&(s=Us())!==n?r=i=[i,o,s]:(ms=r,r=n),t=r!==n?e.substring(t,ms):r}function zs(){var e,t,r,i;for(e=ms,t=ms,r=[],i=Hs();i!==n;)r.push(i),i=Hs();if(r!==n&&(i=Ps())!==n?t=r=[r,i]:(ms=t,t=n),t===n&&(t=null),t!==n){if(r=[],(i=Hs())!==n)for(;i!==n;)r.push(i),i=Hs();else r=n;r!==n?(ys=e,e=t=le()):(ms=e,e=n)}else ms=e,e=n;return e}function Ks(){var e;return(e=zs())===n&&(e=null),e}function Vs(){var t,r,i;for(t=ms,r=[],(i=qs())===n&&(i=js());i!==n;)r.push(i),(i=qs())===n&&(i=js());return r!==n?(58===e.charCodeAt(ms)?(i=D,ms++):(i=n,0===bs&&Os(U)),i!==n&&Ks()!==n?(ys=t,t=r=fe()):(ms=t,t=n)):(ms=t,t=n),t}function Ys(){var t;return ge.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(ve)),t}function $s(){var t;return me.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(ye)),t}function Xs(){var t,r,i;if(t=ms,r=[],(i=Ls())===n&&(45===e.charCodeAt(ms)?(i=V,ms++):(i=n,0===bs&&Os(Y)),i===n&&(46===e.charCodeAt(ms)?(i=J,ms++):(i=n,0===bs&&Os(Q)),i===n&&(33===e.charCodeAt(ms)?(i=Z,ms++):(i=n,0===bs&&Os(ee)),i===n&&(37===e.charCodeAt(ms)?(i=he,ms++):(i=n,0===bs&&Os(pe)),i===n&&(42===e.charCodeAt(ms)?(i=ne,ms++):(i=n,0===bs&&Os(ie)),i===n&&(95===e.charCodeAt(ms)?(i=$,ms++):(i=n,0===bs&&Os(X)),i===n&&(43===e.charCodeAt(ms)?(i=F,ms++):(i=n,0===bs&&Os(B)),i===n&&(96===e.charCodeAt(ms)?(i=Se,ms++):(i=n,0===bs&&Os(Te)),i===n&&(39===e.charCodeAt(ms)?(i=oe,ms++):(i=n,0===bs&&Os(se)),i===n&&(126===e.charCodeAt(ms)?(i=te,ms++):(i=n,0===bs&&Os(re)))))))))))),i!==n)for(;i!==n;)r.push(i),(i=Ls())===n&&(45===e.charCodeAt(ms)?(i=V,ms++):(i=n,0===bs&&Os(Y)),i===n&&(46===e.charCodeAt(ms)?(i=J,ms++):(i=n,0===bs&&Os(Q)),i===n&&(33===e.charCodeAt(ms)?(i=Z,ms++):(i=n,0===bs&&Os(ee)),i===n&&(37===e.charCodeAt(ms)?(i=he,ms++):(i=n,0===bs&&Os(pe)),i===n&&(42===e.charCodeAt(ms)?(i=ne,ms++):(i=n,0===bs&&Os(ie)),i===n&&(95===e.charCodeAt(ms)?(i=$,ms++):(i=n,0===bs&&Os(X)),i===n&&(43===e.charCodeAt(ms)?(i=F,ms++):(i=n,0===bs&&Os(B)),i===n&&(96===e.charCodeAt(ms)?(i=Se,ms++):(i=n,0===bs&&Os(Te)),i===n&&(39===e.charCodeAt(ms)?(i=oe,ms++):(i=n,0===bs&&Os(se)),i===n&&(126===e.charCodeAt(ms)?(i=te,ms++):(i=n,0===bs&&Os(re))))))))))));else r=n;return t=r!==n?e.substring(t,ms):r}function Js(){var t,r,i;if(t=ms,r=[],(i=Ls())===n&&(45===e.charCodeAt(ms)?(i=V,ms++):(i=n,0===bs&&Os(Y)),i===n&&(33===e.charCodeAt(ms)?(i=Z,ms++):(i=n,0===bs&&Os(ee)),i===n&&(37===e.charCodeAt(ms)?(i=he,ms++):(i=n,0===bs&&Os(pe)),i===n&&(42===e.charCodeAt(ms)?(i=ne,ms++):(i=n,0===bs&&Os(ie)),i===n&&(95===e.charCodeAt(ms)?(i=$,ms++):(i=n,0===bs&&Os(X)),i===n&&(43===e.charCodeAt(ms)?(i=F,ms++):(i=n,0===bs&&Os(B)),i===n&&(96===e.charCodeAt(ms)?(i=Se,ms++):(i=n,0===bs&&Os(Te)),i===n&&(39===e.charCodeAt(ms)?(i=oe,ms++):(i=n,0===bs&&Os(se)),i===n&&(126===e.charCodeAt(ms)?(i=te,ms++):(i=n,0===bs&&Os(re))))))))))),i!==n)for(;i!==n;)r.push(i),(i=Ls())===n&&(45===e.charCodeAt(ms)?(i=V,ms++):(i=n,0===bs&&Os(Y)),i===n&&(33===e.charCodeAt(ms)?(i=Z,ms++):(i=n,0===bs&&Os(ee)),i===n&&(37===e.charCodeAt(ms)?(i=he,ms++):(i=n,0===bs&&Os(pe)),i===n&&(42===e.charCodeAt(ms)?(i=ne,ms++):(i=n,0===bs&&Os(ie)),i===n&&(95===e.charCodeAt(ms)?(i=$,ms++):(i=n,0===bs&&Os(X)),i===n&&(43===e.charCodeAt(ms)?(i=F,ms++):(i=n,0===bs&&Os(B)),i===n&&(96===e.charCodeAt(ms)?(i=Se,ms++):(i=n,0===bs&&Os(Te)),i===n&&(39===e.charCodeAt(ms)?(i=oe,ms++):(i=n,0===bs&&Os(se)),i===n&&(126===e.charCodeAt(ms)?(i=te,ms++):(i=n,0===bs&&Os(re)))))))))));else r=n;return t=r!==n?e.substring(t,ms):r}function Qs(){var t,r,i;if(t=ms,r=[],(i=Ls())===n&&(45===e.charCodeAt(ms)?(i=V,ms++):(i=n,0===bs&&Os(Y)),i===n&&(46===e.charCodeAt(ms)?(i=J,ms++):(i=n,0===bs&&Os(Q)),i===n&&(33===e.charCodeAt(ms)?(i=Z,ms++):(i=n,0===bs&&Os(ee)),i===n&&(37===e.charCodeAt(ms)?(i=he,ms++):(i=n,0===bs&&Os(pe)),i===n&&(42===e.charCodeAt(ms)?(i=ne,ms++):(i=n,0===bs&&Os(ie)),i===n&&(95===e.charCodeAt(ms)?(i=$,ms++):(i=n,0===bs&&Os(X)),i===n&&(43===e.charCodeAt(ms)?(i=F,ms++):(i=n,0===bs&&Os(B)),i===n&&(96===e.charCodeAt(ms)?(i=Se,ms++):(i=n,0===bs&&Os(Te)),i===n&&(39===e.charCodeAt(ms)?(i=oe,ms++):(i=n,0===bs&&Os(se)),i===n&&(126===e.charCodeAt(ms)?(i=te,ms++):(i=n,0===bs&&Os(re)),i===n&&(40===e.charCodeAt(ms)?(i=ae,ms++):(i=n,0===bs&&Os(ce)),i===n&&(41===e.charCodeAt(ms)?(i=ue,ms++):(i=n,0===bs&&Os(de)),i===n&&(60===e.charCodeAt(ms)?(i=Ce,ms++):(i=n,0===bs&&Os(be)),i===n&&(62===e.charCodeAt(ms)?(i=_e,ms++):(i=n,0===bs&&Os(Ae)),i===n&&(58===e.charCodeAt(ms)?(i=D,ms++):(i=n,0===bs&&Os(U)),i===n&&(92===e.charCodeAt(ms)?(i=we,ms++):(i=n,0===bs&&Os(Ee)),i===n&&(i=Ms())===n&&(47===e.charCodeAt(ms)?(i=O,ms++):(i=n,0===bs&&Os(x)),i===n&&(91===e.charCodeAt(ms)?(i=Re,ms++):(i=n,0===bs&&Os(Ie)),i===n&&(93===e.charCodeAt(ms)?(i=Oe,ms++):(i=n,0===bs&&Os(xe)),i===n&&(63===e.charCodeAt(ms)?(i=P,ms++):(i=n,0===bs&&Os(N)),i===n&&(123===e.charCodeAt(ms)?(i=Pe,ms++):(i=n,0===bs&&Os(Ne)),i===n&&(125===e.charCodeAt(ms)?(i=De,ms++):(i=n,0===bs&&Os(Ue)))))))))))))))))))))))),i!==n)for(;i!==n;)r.push(i),(i=Ls())===n&&(45===e.charCodeAt(ms)?(i=V,ms++):(i=n,0===bs&&Os(Y)),i===n&&(46===e.charCodeAt(ms)?(i=J,ms++):(i=n,0===bs&&Os(Q)),i===n&&(33===e.charCodeAt(ms)?(i=Z,ms++):(i=n,0===bs&&Os(ee)),i===n&&(37===e.charCodeAt(ms)?(i=he,ms++):(i=n,0===bs&&Os(pe)),i===n&&(42===e.charCodeAt(ms)?(i=ne,ms++):(i=n,0===bs&&Os(ie)),i===n&&(95===e.charCodeAt(ms)?(i=$,ms++):(i=n,0===bs&&Os(X)),i===n&&(43===e.charCodeAt(ms)?(i=F,ms++):(i=n,0===bs&&Os(B)),i===n&&(96===e.charCodeAt(ms)?(i=Se,ms++):(i=n,0===bs&&Os(Te)),i===n&&(39===e.charCodeAt(ms)?(i=oe,ms++):(i=n,0===bs&&Os(se)),i===n&&(126===e.charCodeAt(ms)?(i=te,ms++):(i=n,0===bs&&Os(re)),i===n&&(40===e.charCodeAt(ms)?(i=ae,ms++):(i=n,0===bs&&Os(ce)),i===n&&(41===e.charCodeAt(ms)?(i=ue,ms++):(i=n,0===bs&&Os(de)),i===n&&(60===e.charCodeAt(ms)?(i=Ce,ms++):(i=n,0===bs&&Os(be)),i===n&&(62===e.charCodeAt(ms)?(i=_e,ms++):(i=n,0===bs&&Os(Ae)),i===n&&(58===e.charCodeAt(ms)?(i=D,ms++):(i=n,0===bs&&Os(U)),i===n&&(92===e.charCodeAt(ms)?(i=we,ms++):(i=n,0===bs&&Os(Ee)),i===n&&(i=Ms())===n&&(47===e.charCodeAt(ms)?(i=O,ms++):(i=n,0===bs&&Os(x)),i===n&&(91===e.charCodeAt(ms)?(i=Re,ms++):(i=n,0===bs&&Os(Ie)),i===n&&(93===e.charCodeAt(ms)?(i=Oe,ms++):(i=n,0===bs&&Os(xe)),i===n&&(63===e.charCodeAt(ms)?(i=P,ms++):(i=n,0===bs&&Os(N)),i===n&&(123===e.charCodeAt(ms)?(i=Pe,ms++):(i=n,0===bs&&Os(Ne)),i===n&&(125===e.charCodeAt(ms)?(i=De,ms++):(i=n,0===bs&&Os(Ue))))))))))))))))))))))));else r=n;return t=r!==n?e.substring(t,ms):r}function Zs(){var t,r;return t=ms,Ks()!==n?(47===e.charCodeAt(ms)?(r=O,ms++):(r=n,0===bs&&Os(x)),r!==n&&Ks()!==n?(ys=t,t=ke()):(ms=t,t=n)):(ms=t,t=n),t}function ea(){var t,r;return t=ms,Ks()!==n?(61===e.charCodeAt(ms)?(r=j,ms++):(r=n,0===bs&&Os(L)),r!==n&&Ks()!==n?(ys=t,t=Me()):(ms=t,t=n)):(ms=t,t=n),t}function ta(){var t,r;return t=ms,62===e.charCodeAt(ms)?(r=_e,ms++):(r=n,0===bs&&Os(Ae)),r!==n&&Ks()!==n?(ys=t,t=r=qe()):(ms=t,t=n),t}function ra(){var t,r;return t=ms,Ks()!==n?(60===e.charCodeAt(ms)?(r=Ce,ms++):(r=n,0===bs&&Os(be)),r!==n?(ys=t,t=je()):(ms=t,t=n)):(ms=t,t=n),t}function na(){var t,r;return t=ms,Ks()!==n?(44===e.charCodeAt(ms)?(r=z,ms++):(r=n,0===bs&&Os(K)),r!==n&&Ks()!==n?(ys=t,t=Le()):(ms=t,t=n)):(ms=t,t=n),t}function ia(){var t,r;return t=ms,Ks()!==n?(59===e.charCodeAt(ms)?(r=R,ms++):(r=n,0===bs&&Os(I)),r!==n&&Ks()!==n?(ys=t,t=Fe()):(ms=t,t=n)):(ms=t,t=n),t}function oa(){var e;return e=ms,Ks()!==n&&Ms()!==n?(ys=e,e=Ge()):(ms=e,e=n),e}function sa(){var e;return e=ms,Ms()!==n&&Ks()!==n?(ys=e,e=Ge()):(ms=e,e=n),e}function aa(){var t,r,i,o,s,a;if(t=ms,r=ms,(i=Ks())!==n)if((o=Ms())!==n){for(s=[],(a=ua())===n&&(a=da());a!==n;)s.push(a),(a=ua())===n&&(a=da());s!==n&&(a=Ms())!==n?r=i=[i,o,s,a]:(ms=r,r=n)}else ms=r,r=n;else ms=r,r=n;return t=r!==n?e.substring(t,ms):r}function ca(){var t,r,i,o;if(t=ms,Ks()!==n)if(Ms()!==n){for(r=ms,i=[],(o=ua())===n&&(o=da());o!==n;)i.push(o),(o=ua())===n&&(o=da());(r=i!==n?e.substring(r,ms):i)!==n&&(i=Ms())!==n?(ys=t,t=Ke(r)):(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;return t}function ua(){var t;return(t=zs())===n&&(33===e.charCodeAt(ms)?(t=Z,ms++):(t=n,0===bs&&Os(ee)),t===n&&(Ve.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(Ye)),t===n&&(We.test(e.charAt(ms))?(t=e.charAt(ms),ms++):(t=n,0===bs&&Os(ze)),t===n&&(t=Ys())))),t}function da(){var t,r,i;return t=ms,92===e.charCodeAt(ms)?(r=we,ms++):(r=n,0===bs&&Os(Ee)),r!==n?($e.test(e.charAt(ms))?(i=e.charAt(ms),ms++):(i=n,0===bs&&Os(Xe)),i===n&&(Je.test(e.charAt(ms))?(i=e.charAt(ms),ms++):(i=n,0===bs&&Os(Qe)),i===n&&(Ze.test(e.charAt(ms))?(i=e.charAt(ms),ms++):(i=n,0===bs&&Os(et)))),i!==n?t=r=[r,i]:(ms=t,t=n)):(ms=t,t=n),t}function ha(){var t,r,i;return t=ms,la()!==n?(58===e.charCodeAt(ms)?(r=D,ms++):(r=n,0===bs&&Os(U)),r!==n?((i=fa())===n&&(i=null),i!==n&&va()!==n?(ys=t,t=tt()):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t}function pa(){var t,r,i,o;return t=ms,la()!==n?(58===e.charCodeAt(ms)?(r=D,ms++):(r=n,0===bs&&Os(U)),r!==n?((i=fa())===n&&(i=null),i!==n&&va()!==n&&function(){var t,r,i,o;for(t=[],r=ms,59===e.charCodeAt(ms)?(i=R,ms++):(i=n,0===bs&&Os(I)),i!==n&&(o=Ra())!==n?r=i=[i,o]:(ms=r,r=n);r!==n;)t.push(r),r=ms,59===e.charCodeAt(ms)?(i=R,ms++):(i=n,0===bs&&Os(I)),i!==n&&(o=Ra())!==n?r=i=[i,o]:(ms=r,r=n);return t}()!==n?((o=function(){var t,r,i,o,s,a,c;if(t=ms,63===e.charCodeAt(ms)?(r=P,ms++):(r=n,0===bs&&Os(N)),r!==n)if((i=Oa())!==n){for(o=[],s=ms,38===e.charCodeAt(ms)?(a=M,ms++):(a=n,0===bs&&Os(q)),a!==n&&(c=Oa())!==n?s=a=[a,c]:(ms=s,s=n);s!==n;)o.push(s),s=ms,38===e.charCodeAt(ms)?(a=M,ms++):(a=n,0===bs&&Os(q)),a!==n&&(c=Oa())!==n?s=a=[a,c]:(ms=s,s=n);o!==n?t=r=[r,i,o]:(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;return t}())===n&&(o=null),o!==n?(ys=t,t=rt()):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t}function la(){var t,r;return t=ms,e.substr(ms,4).toLowerCase()===nt?(r=e.substr(ms,4),ms+=4):(r=n,0===bs&&Os(it)),r===n&&(e.substr(ms,3).toLowerCase()===ot?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(st))),r!==n&&(ys=t,r=at(r)),t=r}function fa(){var t,r,i,o;return t=ms,function(){var e,t;if(e=[],(t=Bs())===n&&(t=Ws())===n&&(t=ga()),t!==n)for(;t!==n;)e.push(t),(t=Bs())===n&&(t=Ws())===n&&(t=ga());else e=n;return e}()!==n?(r=ms,58===e.charCodeAt(ms)?(i=D,ms++):(i=n,0===bs&&Os(U)),i!==n&&(o=function(){var t,r,i;for(t=ms,r=[],(i=Bs())===n&&(i=Ws())===n&&(38===e.charCodeAt(ms)?(i=M,ms++):(i=n,0===bs&&Os(q)),i===n&&(61===e.charCodeAt(ms)?(i=j,ms++):(i=n,0===bs&&Os(L)),i===n&&(43===e.charCodeAt(ms)?(i=F,ms++):(i=n,0===bs&&Os(B)),i===n&&(36===e.charCodeAt(ms)?(i=G,ms++):(i=n,0===bs&&Os(W)),i===n&&(44===e.charCodeAt(ms)?(i=z,ms++):(i=n,0===bs&&Os(K)))))));i!==n;)r.push(i),(i=Bs())===n&&(i=Ws())===n&&(38===e.charCodeAt(ms)?(i=M,ms++):(i=n,0===bs&&Os(q)),i===n&&(61===e.charCodeAt(ms)?(i=j,ms++):(i=n,0===bs&&Os(L)),i===n&&(43===e.charCodeAt(ms)?(i=F,ms++):(i=n,0===bs&&Os(B)),i===n&&(36===e.charCodeAt(ms)?(i=G,ms++):(i=n,0===bs&&Os(W)),i===n&&(44===e.charCodeAt(ms)?(i=z,ms++):(i=n,0===bs&&Os(K)))))));return r!==n&&(ys=t,r=ut()),t=r}())!==n?r=i=[i,o]:(ms=r,r=n),r===n&&(r=null),r!==n?(64===e.charCodeAt(ms)?(i=H,ms++):(i=n,0===bs&&Os(k)),i!==n?(ys=t,t=ct()):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t}function ga(){var t;return 38===e.charCodeAt(ms)?(t=M,ms++):(t=n,0===bs&&Os(q)),t===n&&(61===e.charCodeAt(ms)?(t=j,ms++):(t=n,0===bs&&Os(L)),t===n&&(43===e.charCodeAt(ms)?(t=F,ms++):(t=n,0===bs&&Os(B)),t===n&&(36===e.charCodeAt(ms)?(t=G,ms++):(t=n,0===bs&&Os(W)),t===n&&(44===e.charCodeAt(ms)?(t=z,ms++):(t=n,0===bs&&Os(K)),t===n&&(59===e.charCodeAt(ms)?(t=R,ms++):(t=n,0===bs&&Os(I)),t===n&&(63===e.charCodeAt(ms)?(t=P,ms++):(t=n,0===bs&&Os(N)),t===n&&(47===e.charCodeAt(ms)?(t=O,ms++):(t=n,0===bs&&Os(x))))))))),t}function va(){var t,r,i,o,s;return t=ms,(r=ma())!==n?(i=ms,58===e.charCodeAt(ms)?(o=D,ms++):(o=n,0===bs&&Os(U)),o!==n&&(s=Ea())!==n?i=o=[o,s]:(ms=i,i=n),i===n&&(i=null),i!==n?t=r=[r,i]:(ms=t,t=n)):(ms=t,t=n),t}function ma(){var e,t;return e=ms,(t=ya())===n&&(t=Aa())===n&&(t=Ta()),t!==n&&(ys=e,t=dt()),e=t}function ya(){var t,r,i,o,s;for(t=ms,r=[],i=ms,(o=Sa())!==n?(46===e.charCodeAt(ms)?(s=J,ms++):(s=n,0===bs&&Os(Q)),s!==n?i=o=[o,s]:(ms=i,i=n)):(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=Sa())!==n?(46===e.charCodeAt(ms)?(s=J,ms++):(s=n,0===bs&&Os(Q)),s!==n?i=o=[o,s]:(ms=i,i=n)):(ms=i,i=n);return r!==n&&(i=function(){var t,r,i,o;if(t=ms,l.test(e.charAt(ms))?(r=e.charAt(ms),ms++):(r=n,0===bs&&Os(f)),r!==n){for(i=[],ft.test(e.charAt(ms))?(o=e.charAt(ms),ms++):(o=n,0===bs&&Os(gt));o!==n;)i.push(o),ft.test(e.charAt(ms))?(o=e.charAt(ms),ms++):(o=n,0===bs&&Os(gt));i!==n?t=r=[r,i]:(ms=t,t=n)}else ms=t,t=n;return t}())!==n?(46===e.charCodeAt(ms)?(o=J,ms++):(o=n,0===bs&&Os(Q)),o===n&&(o=null),o!==n?(ys=t,t=r=ht()):(ms=t,t=n)):(ms=t,t=n),t}function Sa(){var t,r;if(t=[],pt.test(e.charAt(ms))?(r=e.charAt(ms),ms++):(r=n,0===bs&&Os(lt)),r!==n)for(;r!==n;)t.push(r),pt.test(e.charAt(ms))?(r=e.charAt(ms),ms++):(r=n,0===bs&&Os(lt));else t=n;return t}function Ta(){var t,r,i;return t=ms,91===e.charCodeAt(ms)?(r=Re,ms++):(r=n,0===bs&&Os(Ie)),r!==n&&Ca()!==n?(93===e.charCodeAt(ms)?(i=Oe,ms++):(i=n,0===bs&&Os(xe)),i!==n?(ys=t,t=r=vt()):(ms=t,t=n)):(ms=t,t=n),t}function Ca(){var t,r,i,o,s,a,c,u,d,h,p,l,f,g,v;return t=ms,r=ms,(i=ba())!==n?(58===e.charCodeAt(ms)?(o=D,ms++):(o=n,0===bs&&Os(U)),o!==n&&(s=ba())!==n?(58===e.charCodeAt(ms)?(a=D,ms++):(a=n,0===bs&&Os(U)),a!==n&&(c=ba())!==n?(58===e.charCodeAt(ms)?(u=D,ms++):(u=n,0===bs&&Os(U)),u!==n&&(d=ba())!==n?(58===e.charCodeAt(ms)?(h=D,ms++):(h=n,0===bs&&Os(U)),h!==n&&(p=ba())!==n?(58===e.charCodeAt(ms)?(l=D,ms++):(l=n,0===bs&&Os(U)),l!==n&&(f=ba())!==n?(58===e.charCodeAt(ms)?(g=D,ms++):(g=n,0===bs&&Os(U)),g!==n&&(v=_a())!==n?r=i=[i,o,s,a,c,u,d,h,p,l,f,g,v]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,e.substr(ms,2)===mt?(i=mt,ms+=2):(i=n,0===bs&&Os(yt)),i!==n&&(o=ba())!==n?(58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?(58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=ba())!==n?(58===e.charCodeAt(ms)?(d=D,ms++):(d=n,0===bs&&Os(U)),d!==n&&(h=ba())!==n?(58===e.charCodeAt(ms)?(p=D,ms++):(p=n,0===bs&&Os(U)),p!==n&&(l=ba())!==n?(58===e.charCodeAt(ms)?(f=D,ms++):(f=n,0===bs&&Os(U)),f!==n&&(g=_a())!==n?r=i=[i,o,s,a,c,u,d,h,p,l,f,g]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,e.substr(ms,2)===mt?(i=mt,ms+=2):(i=n,0===bs&&Os(yt)),i!==n&&(o=ba())!==n?(58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?(58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=ba())!==n?(58===e.charCodeAt(ms)?(d=D,ms++):(d=n,0===bs&&Os(U)),d!==n&&(h=ba())!==n?(58===e.charCodeAt(ms)?(p=D,ms++):(p=n,0===bs&&Os(U)),p!==n&&(l=_a())!==n?r=i=[i,o,s,a,c,u,d,h,p,l]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,e.substr(ms,2)===mt?(i=mt,ms+=2):(i=n,0===bs&&Os(yt)),i!==n&&(o=ba())!==n?(58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?(58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=ba())!==n?(58===e.charCodeAt(ms)?(d=D,ms++):(d=n,0===bs&&Os(U)),d!==n&&(h=_a())!==n?r=i=[i,o,s,a,c,u,d,h]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,e.substr(ms,2)===mt?(i=mt,ms+=2):(i=n,0===bs&&Os(yt)),i!==n&&(o=ba())!==n?(58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?(58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=_a())!==n?r=i=[i,o,s,a,c,u]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,e.substr(ms,2)===mt?(i=mt,ms+=2):(i=n,0===bs&&Os(yt)),i!==n&&(o=ba())!==n?(58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=_a())!==n?r=i=[i,o,s,a]:(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,e.substr(ms,2)===mt?(i=mt,ms+=2):(i=n,0===bs&&Os(yt)),i!==n&&(o=_a())!==n?r=i=[i,o]:(ms=r,r=n),r===n&&(r=ms,e.substr(ms,2)===mt?(i=mt,ms+=2):(i=n,0===bs&&Os(yt)),i!==n&&(o=ba())!==n?r=i=[i,o]:(ms=r,r=n),r===n&&(r=ms,(i=ba())!==n?(e.substr(ms,2)===mt?(o=mt,ms+=2):(o=n,0===bs&&Os(yt)),o!==n&&(s=ba())!==n?(58===e.charCodeAt(ms)?(a=D,ms++):(a=n,0===bs&&Os(U)),a!==n&&(c=ba())!==n?(58===e.charCodeAt(ms)?(u=D,ms++):(u=n,0===bs&&Os(U)),u!==n&&(d=ba())!==n?(58===e.charCodeAt(ms)?(h=D,ms++):(h=n,0===bs&&Os(U)),h!==n&&(p=ba())!==n?(58===e.charCodeAt(ms)?(l=D,ms++):(l=n,0===bs&&Os(U)),l!==n&&(f=_a())!==n?r=i=[i,o,s,a,c,u,d,h,p,l,f]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,(i=ba())!==n?(o=ms,58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?o=s=[s,a]:(ms=o,o=n),o===n&&(o=null),o!==n?(e.substr(ms,2)===mt?(s=mt,ms+=2):(s=n,0===bs&&Os(yt)),s!==n&&(a=ba())!==n?(58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=ba())!==n?(58===e.charCodeAt(ms)?(d=D,ms++):(d=n,0===bs&&Os(U)),d!==n&&(h=ba())!==n?(58===e.charCodeAt(ms)?(p=D,ms++):(p=n,0===bs&&Os(U)),p!==n&&(l=_a())!==n?r=i=[i,o,s,a,c,u,d,h,p,l]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,(i=ba())!==n?(o=ms,58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?o=s=[s,a]:(ms=o,o=n),o===n&&(o=null),o!==n?(s=ms,58===e.charCodeAt(ms)?(a=D,ms++):(a=n,0===bs&&Os(U)),a!==n&&(c=ba())!==n?s=a=[a,c]:(ms=s,s=n),s===n&&(s=null),s!==n?(e.substr(ms,2)===mt?(a=mt,ms+=2):(a=n,0===bs&&Os(yt)),a!==n&&(c=ba())!==n?(58===e.charCodeAt(ms)?(u=D,ms++):(u=n,0===bs&&Os(U)),u!==n&&(d=ba())!==n?(58===e.charCodeAt(ms)?(h=D,ms++):(h=n,0===bs&&Os(U)),h!==n&&(p=_a())!==n?r=i=[i,o,s,a,c,u,d,h,p]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,(i=ba())!==n?(o=ms,58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?o=s=[s,a]:(ms=o,o=n),o===n&&(o=null),o!==n?(s=ms,58===e.charCodeAt(ms)?(a=D,ms++):(a=n,0===bs&&Os(U)),a!==n&&(c=ba())!==n?s=a=[a,c]:(ms=s,s=n),s===n&&(s=null),s!==n?(a=ms,58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=ba())!==n?a=c=[c,u]:(ms=a,a=n),a===n&&(a=null),a!==n?(e.substr(ms,2)===mt?(c=mt,ms+=2):(c=n,0===bs&&Os(yt)),c!==n&&(u=ba())!==n?(58===e.charCodeAt(ms)?(d=D,ms++):(d=n,0===bs&&Os(U)),d!==n&&(h=_a())!==n?r=i=[i,o,s,a,c,u,d,h]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,(i=ba())!==n?(o=ms,58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?o=s=[s,a]:(ms=o,o=n),o===n&&(o=null),o!==n?(s=ms,58===e.charCodeAt(ms)?(a=D,ms++):(a=n,0===bs&&Os(U)),a!==n&&(c=ba())!==n?s=a=[a,c]:(ms=s,s=n),s===n&&(s=null),s!==n?(a=ms,58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=ba())!==n?a=c=[c,u]:(ms=a,a=n),a===n&&(a=null),a!==n?(c=ms,58===e.charCodeAt(ms)?(u=D,ms++):(u=n,0===bs&&Os(U)),u!==n&&(d=ba())!==n?c=u=[u,d]:(ms=c,c=n),c===n&&(c=null),c!==n?(e.substr(ms,2)===mt?(u=mt,ms+=2):(u=n,0===bs&&Os(yt)),u!==n&&(d=_a())!==n?r=i=[i,o,s,a,c,u,d]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,(i=ba())!==n?(o=ms,58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?o=s=[s,a]:(ms=o,o=n),o===n&&(o=null),o!==n?(s=ms,58===e.charCodeAt(ms)?(a=D,ms++):(a=n,0===bs&&Os(U)),a!==n&&(c=ba())!==n?s=a=[a,c]:(ms=s,s=n),s===n&&(s=null),s!==n?(a=ms,58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=ba())!==n?a=c=[c,u]:(ms=a,a=n),a===n&&(a=null),a!==n?(c=ms,58===e.charCodeAt(ms)?(u=D,ms++):(u=n,0===bs&&Os(U)),u!==n&&(d=ba())!==n?c=u=[u,d]:(ms=c,c=n),c===n&&(c=null),c!==n?(u=ms,58===e.charCodeAt(ms)?(d=D,ms++):(d=n,0===bs&&Os(U)),d!==n&&(h=ba())!==n?u=d=[d,h]:(ms=u,u=n),u===n&&(u=null),u!==n?(e.substr(ms,2)===mt?(d=mt,ms+=2):(d=n,0===bs&&Os(yt)),d!==n&&(h=ba())!==n?r=i=[i,o,s,a,c,u,d,h]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n),r===n&&(r=ms,(i=ba())!==n?(o=ms,58===e.charCodeAt(ms)?(s=D,ms++):(s=n,0===bs&&Os(U)),s!==n&&(a=ba())!==n?o=s=[s,a]:(ms=o,o=n),o===n&&(o=null),o!==n?(s=ms,58===e.charCodeAt(ms)?(a=D,ms++):(a=n,0===bs&&Os(U)),a!==n&&(c=ba())!==n?s=a=[a,c]:(ms=s,s=n),s===n&&(s=null),s!==n?(a=ms,58===e.charCodeAt(ms)?(c=D,ms++):(c=n,0===bs&&Os(U)),c!==n&&(u=ba())!==n?a=c=[c,u]:(ms=a,a=n),a===n&&(a=null),a!==n?(c=ms,58===e.charCodeAt(ms)?(u=D,ms++):(u=n,0===bs&&Os(U)),u!==n&&(d=ba())!==n?c=u=[u,d]:(ms=c,c=n),c===n&&(c=null),c!==n?(u=ms,58===e.charCodeAt(ms)?(d=D,ms++):(d=n,0===bs&&Os(U)),d!==n&&(h=ba())!==n?u=d=[d,h]:(ms=u,u=n),u===n&&(u=null),u!==n?(d=ms,58===e.charCodeAt(ms)?(h=D,ms++):(h=n,0===bs&&Os(U)),h!==n&&(p=ba())!==n?d=h=[h,p]:(ms=d,d=n),d===n&&(d=null),d!==n?(e.substr(ms,2)===mt?(h=mt,ms+=2):(h=n,0===bs&&Os(yt)),h!==n?r=i=[i,o,s,a,c,u,d,h]:(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n)):(ms=r,r=n))))))))))))))),r!==n&&(ys=t,r=St()),t=r}function ba(){var e,t,r,i,o;return e=ms,(t=Us())!==n?((r=Us())===n&&(r=null),r!==n?((i=Us())===n&&(i=null),i!==n?((o=Us())===n&&(o=null),o!==n?e=t=[t,r,i,o]:(ms=e,e=n)):(ms=e,e=n)):(ms=e,e=n)):(ms=e,e=n),e}function _a(){var t,r,i,o;return t=ms,(r=ba())!==n?(58===e.charCodeAt(ms)?(i=D,ms++):(i=n,0===bs&&Os(U)),i!==n&&(o=ba())!==n?t=r=[r,i,o]:(ms=t,t=n)):(ms=t,t=n),t===n&&(t=Aa()),t}function Aa(){var t,r,i,o;return t=ms,wa()!==n?(46===e.charCodeAt(ms)?(r=J,ms++):(r=n,0===bs&&Os(Q)),r!==n&&wa()!==n?(46===e.charCodeAt(ms)?(i=J,ms++):(i=n,0===bs&&Os(Q)),i!==n&&wa()!==n?(46===e.charCodeAt(ms)?(o=J,ms++):(o=n,0===bs&&Os(Q)),o!==n&&wa()!==n?(ys=t,t=Tt()):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t}function wa(){var t,r,i,o;return t=ms,e.substr(ms,2)===Ct?(r=Ct,ms+=2):(r=n,0===bs&&Os(bt)),r!==n?(_t.test(e.charAt(ms))?(i=e.charAt(ms),ms++):(i=n,0===bs&&Os(At)),i!==n?t=r=[r,i]:(ms=t,t=n)):(ms=t,t=n),t===n&&(t=ms,50===e.charCodeAt(ms)?(r=wt,ms++):(r=n,0===bs&&Os(Et)),r!==n?(Rt.test(e.charAt(ms))?(i=e.charAt(ms),ms++):(i=n,0===bs&&Os(It)),i!==n&&(o=Ns())!==n?t=r=[r,i,o]:(ms=t,t=n)):(ms=t,t=n),t===n&&(t=ms,49===e.charCodeAt(ms)?(r=Ot,ms++):(r=n,0===bs&&Os(xt)),r!==n&&(i=Ns())!==n&&(o=Ns())!==n?t=r=[r,i,o]:(ms=t,t=n),t===n&&(t=ms,Pt.test(e.charAt(ms))?(r=e.charAt(ms),ms++):(r=n,0===bs&&Os(Nt)),r!==n&&(i=Ns())!==n?t=r=[r,i]:(ms=t,t=n),t===n&&(t=Ns())))),t}function Ea(){var e,t,r,i,o,s,a;return e=ms,t=ms,(r=Ns())===n&&(r=null),r!==n?((i=Ns())===n&&(i=null),i!==n?((o=Ns())===n&&(o=null),o!==n?((s=Ns())===n&&(s=null),s!==n?((a=Ns())===n&&(a=null),a!==n?t=r=[r,i,o,s,a]:(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t!==n&&(ys=e,t=Dt(t)),e=t}function Ra(){var t;return(t=function(){var t,r,i;return t=ms,e.substr(ms,10).toLowerCase()===Ut?(r=e.substr(ms,10),ms+=10):(r=n,0===bs&&Os(Ht)),r!==n?(e.substr(ms,3).toLowerCase()===kt?(i=e.substr(ms,3),ms+=3):(i=n,0===bs&&Os(Mt)),i===n&&(e.substr(ms,3).toLowerCase()===qt?(i=e.substr(ms,3),ms+=3):(i=n,0===bs&&Os(jt)),i===n&&(e.substr(ms,4).toLowerCase()===Lt?(i=e.substr(ms,4),ms+=4):(i=n,0===bs&&Os(Ft)),i===n&&(e.substr(ms,3).toLowerCase()===Bt?(i=e.substr(ms,3),ms+=3):(i=n,0===bs&&Os(Gt)),i===n&&(i=Xs())))),i!==n?(ys=t,r=Wt(i),t=r):(ms=t,t=n)):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,5).toLowerCase()===zt?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(Kt)),r!==n?(e.substr(ms,5).toLowerCase()===Vt?(i=e.substr(ms,5),ms+=5):(i=n,0===bs&&Os(Yt)),i===n&&(e.substr(ms,2).toLowerCase()===$t?(i=e.substr(ms,2),ms+=2):(i=n,0===bs&&Os(Xt)),i===n&&(i=Xs())),i!==n?(ys=t,r=Jt(i),t=r):(ms=t,t=n)):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,7).toLowerCase()===Qt?(r=e.substr(ms,7),ms+=7):(r=n,0===bs&&Os(Zt)),r!==n&&(i=La())!==n?(ys=t,r=er(i),t=r):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,4).toLowerCase()===tr?(r=e.substr(ms,4),ms+=4):(r=n,0===bs&&Os(rr)),r!==n&&(i=lc())!==n?(ys=t,r=nr(i),t=r):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,6).toLowerCase()===ir?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(or)),r!==n&&(i=ma())!==n?(ys=t,r=sr(i),t=r):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s;return t=ms,e.substr(ms,2).toLowerCase()===ar?(r=e.substr(ms,2),ms+=2):(r=n,0===bs&&Os(cr)),r!==n?(i=ms,61===e.charCodeAt(ms)?(o=j,ms++):(o=n,0===bs&&Os(L)),o!==n&&(s=Xs())!==n?i=o=[o,s]:(ms=i,i=n),i===n&&(i=null),i!==n?(ys=t,r=ur(),t=r):(ms=t,t=n)):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s;return t=ms,(r=function(){var t,r,i;if(t=ms,r=[],(i=Ia())!==n)for(;i!==n;)r.push(i),i=Ia();else r=n;return t=r!==n?e.substring(t,ms):r}())!==n?(i=ms,61===e.charCodeAt(ms)?(o=j,ms++):(o=n,0===bs&&Os(L)),o!==n&&(s=function(){var t,r,i;if(t=ms,r=[],(i=Ia())!==n)for(;i!==n;)r.push(i),i=Ia();else r=n;return t=r!==n?e.substring(t,ms):r}())!==n?i=o=[o,s]:(ms=i,i=n),i===n&&(i=null),i!==n?(ys=t,r=dr(r,i),t=r):(ms=t,t=n)):(ms=t,t=n),t}()),t}function Ia(){var t;return(t=function(){var t;return 91===e.charCodeAt(ms)?(t=Re,ms++):(t=n,0===bs&&Os(Ie)),t===n&&(93===e.charCodeAt(ms)?(t=Oe,ms++):(t=n,0===bs&&Os(xe)),t===n&&(47===e.charCodeAt(ms)?(t=O,ms++):(t=n,0===bs&&Os(x)),t===n&&(58===e.charCodeAt(ms)?(t=D,ms++):(t=n,0===bs&&Os(U)),t===n&&(38===e.charCodeAt(ms)?(t=M,ms++):(t=n,0===bs&&Os(q)),t===n&&(43===e.charCodeAt(ms)?(t=F,ms++):(t=n,0===bs&&Os(B)),t===n&&(36===e.charCodeAt(ms)?(t=G,ms++):(t=n,0===bs&&Os(W)))))))),t}())===n&&(t=Bs())===n&&(t=Ws()),t}function Oa(){var t,r,i,o;return t=ms,(r=function(){var e,t;if(e=[],(t=xa())===n&&(t=Bs())===n&&(t=Ws()),t!==n)for(;t!==n;)e.push(t),(t=xa())===n&&(t=Bs())===n&&(t=Ws());else e=n;return e}())!==n?(61===e.charCodeAt(ms)?(i=j,ms++):(i=n,0===bs&&Os(L)),i!==n&&(o=function(){var e,t;for(e=[],(t=xa())===n&&(t=Bs())===n&&(t=Ws());t!==n;)e.push(t),(t=xa())===n&&(t=Bs())===n&&(t=Ws());return e}())!==n?(ys=t,t=r=hr(r,o)):(ms=t,t=n)):(ms=t,t=n),t}function xa(){var t;return 91===e.charCodeAt(ms)?(t=Re,ms++):(t=n,0===bs&&Os(Ie)),t===n&&(93===e.charCodeAt(ms)?(t=Oe,ms++):(t=n,0===bs&&Os(xe)),t===n&&(47===e.charCodeAt(ms)?(t=O,ms++):(t=n,0===bs&&Os(x)),t===n&&(63===e.charCodeAt(ms)?(t=P,ms++):(t=n,0===bs&&Os(N)),t===n&&(58===e.charCodeAt(ms)?(t=D,ms++):(t=n,0===bs&&Os(U)),t===n&&(43===e.charCodeAt(ms)?(t=F,ms++):(t=n,0===bs&&Os(B)),t===n&&(36===e.charCodeAt(ms)?(t=G,ms++):(t=n,0===bs&&Os(W)))))))),t}function Pa(){var e;return(e=function(){var e,t,r,i,o,s;return e=ms,(t=ja())!==n&&(r=qs())!==n&&(i=function(){var e,t;return e=ms,(t=function(){var e,t,r,i;return e=ms,(t=Ns())!==n&&(r=Ns())!==n&&(i=Ns())!==n?e=t=[t,r,i]:(ms=e,e=n),e}())!==n&&(ys=e,t=jr(t)),e=t}())!==n&&(o=qs())!==n&&(s=function(){var e,t,r;for(e=ms,t=[],(r=Fs())===n&&(r=Bs())===n&&(r=Ws())===n&&(r=Ys())===n&&(r=$s())===n&&(r=qs())===n&&(r=js());r!==n;)t.push(r),(r=Fs())===n&&(r=Bs())===n&&(r=Ws())===n&&(r=Ys())===n&&(r=$s())===n&&(r=qs())===n&&(r=js());return t!==n&&(ys=e,t=Lr()),e=t}())!==n?e=t=[t,r,i,o,s]:(ms=e,e=n),e}())===n&&(e=function(){var e,t,r,i,o,s;return e=ms,(t=La())!==n&&(r=qs())!==n&&(i=function(){var e;return(e=pa())===n&&(e=Na()),e}())!==n&&(o=qs())!==n&&(s=ja())!==n?e=t=[t,r,i,o,s]:(ms=e,e=n),e}()),e}function Na(){var t,r,i;return t=ms,function(){var t,r,i,o,s;if(t=ms,r=ms,(i=Ds())!==n){for(o=[],(s=Ds())===n&&(s=Ns())===n&&(43===e.charCodeAt(ms)?(s=F,ms++):(s=n,0===bs&&Os(B)),s===n&&(45===e.charCodeAt(ms)?(s=V,ms++):(s=n,0===bs&&Os(Y)),s===n&&(46===e.charCodeAt(ms)?(s=J,ms++):(s=n,0===bs&&Os(Q)))));s!==n;)o.push(s),(s=Ds())===n&&(s=Ns())===n&&(43===e.charCodeAt(ms)?(s=F,ms++):(s=n,0===bs&&Os(B)),s===n&&(45===e.charCodeAt(ms)?(s=V,ms++):(s=n,0===bs&&Os(Y)),s===n&&(46===e.charCodeAt(ms)?(s=J,ms++):(s=n,0===bs&&Os(Q)))));o!==n?r=i=[i,o]:(ms=r,r=n)}else ms=r,r=n;return r!==n&&(ys=t,r=gr()),t=r}()!==n?(58===e.charCodeAt(ms)?(r=D,ms++):(r=n,0===bs&&Os(U)),r!==n?((i=function(){var t,r,i,o,s;return t=ms,(r=function(){var t,r,i,o;return t=ms,e.substr(ms,2)===lr?(r=lr,ms+=2):(r=n,0===bs&&Os(fr)),r!==n&&(i=function(){var t;return(t=function(){var t,r,i,o;return t=ms,r=ms,(i=fa())!==n?(64===e.charCodeAt(ms)?(o=H,ms++):(o=n,0===bs&&Os(k)),o!==n?r=i=[i,o]:(ms=r,r=n)):(ms=r,r=n),r===n&&(r=null),r!==n&&(i=va())!==n?t=r=[r,i]:(ms=t,t=n),t===n&&(t=null),t}())===n&&(t=qa()),t}())!==n?((o=Da())===n&&(o=null),o!==n?t=r=[r,i,o]:(ms=t,t=n)):(ms=t,t=n),t}())===n&&(r=Da()),r!==n?(i=ms,63===e.charCodeAt(ms)?(o=P,ms++):(o=n,0===bs&&Os(N)),o!==n&&(s=function(){var e,t;for(e=[],t=Ua();t!==n;)e.push(t),t=Ua();return e}())!==n?i=o=[o,s]:(ms=i,i=n),i===n&&(i=null),i!==n?t=r=[r,i]:(ms=t,t=n)):(ms=t,t=n),t}())===n&&(i=function(){var t,r,i,o;if(t=ms,(r=function(){var t;return(t=Bs())===n&&(t=Ws())===n&&(59===e.charCodeAt(ms)?(t=R,ms++):(t=n,0===bs&&Os(I)),t===n&&(63===e.charCodeAt(ms)?(t=P,ms++):(t=n,0===bs&&Os(N)),t===n&&(58===e.charCodeAt(ms)?(t=D,ms++):(t=n,0===bs&&Os(U)),t===n&&(64===e.charCodeAt(ms)?(t=H,ms++):(t=n,0===bs&&Os(k)),t===n&&(38===e.charCodeAt(ms)?(t=M,ms++):(t=n,0===bs&&Os(q)),t===n&&(61===e.charCodeAt(ms)?(t=j,ms++):(t=n,0===bs&&Os(L)),t===n&&(43===e.charCodeAt(ms)?(t=F,ms++):(t=n,0===bs&&Os(B)),t===n&&(36===e.charCodeAt(ms)?(t=G,ms++):(t=n,0===bs&&Os(W)),t===n&&(44===e.charCodeAt(ms)?(t=z,ms++):(t=n,0===bs&&Os(K))))))))))),t}())!==n){for(i=[],o=Ua();o!==n;)i.push(o),o=Ua();i!==n?t=r=[r,i]:(ms=t,t=n)}else ms=t,t=n;return t}()),i!==n?(ys=t,t=pr()):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t}function Da(){var t,r,i;return t=ms,47===e.charCodeAt(ms)?(r=O,ms++):(r=n,0===bs&&Os(x)),r!==n&&(i=function(){var t,r,i,o,s,a;if(t=ms,(r=Ha())!==n){for(i=[],o=ms,47===e.charCodeAt(ms)?(s=O,ms++):(s=n,0===bs&&Os(x)),s!==n&&(a=Ha())!==n?o=s=[s,a]:(ms=o,o=n);o!==n;)i.push(o),o=ms,47===e.charCodeAt(ms)?(s=O,ms++):(s=n,0===bs&&Os(x)),s!==n&&(a=Ha())!==n?o=s=[s,a]:(ms=o,o=n);i!==n?t=r=[r,i]:(ms=t,t=n)}else ms=t,t=n;return t}())!==n?t=r=[r,i]:(ms=t,t=n),t}function Ua(){var e;return(e=Fs())===n&&(e=Bs())===n&&(e=Ws()),e}function Ha(){var t,r,i,o,s,a;for(t=ms,r=[],i=Ma();i!==n;)r.push(i),i=Ma();if(r!==n){for(i=[],o=ms,59===e.charCodeAt(ms)?(s=R,ms++):(s=n,0===bs&&Os(I)),s!==n&&(a=ka())!==n?o=s=[s,a]:(ms=o,o=n);o!==n;)i.push(o),o=ms,59===e.charCodeAt(ms)?(s=R,ms++):(s=n,0===bs&&Os(I)),s!==n&&(a=ka())!==n?o=s=[s,a]:(ms=o,o=n);i!==n?t=r=[r,i]:(ms=t,t=n)}else ms=t,t=n;return t}function ka(){var e,t;for(e=[],t=Ma();t!==n;)e.push(t),t=Ma();return e}function Ma(){var t;return(t=Bs())===n&&(t=Ws())===n&&(58===e.charCodeAt(ms)?(t=D,ms++):(t=n,0===bs&&Os(U)),t===n&&(64===e.charCodeAt(ms)?(t=H,ms++):(t=n,0===bs&&Os(k)),t===n&&(38===e.charCodeAt(ms)?(t=M,ms++):(t=n,0===bs&&Os(q)),t===n&&(61===e.charCodeAt(ms)?(t=j,ms++):(t=n,0===bs&&Os(L)),t===n&&(43===e.charCodeAt(ms)?(t=F,ms++):(t=n,0===bs&&Os(B)),t===n&&(36===e.charCodeAt(ms)?(t=G,ms++):(t=n,0===bs&&Os(W)),t===n&&(44===e.charCodeAt(ms)?(t=z,ms++):(t=n,0===bs&&Os(K))))))))),t}function qa(){var t,r;if(t=[],(r=Bs())===n&&(r=Ws())===n&&(36===e.charCodeAt(ms)?(r=G,ms++):(r=n,0===bs&&Os(W)),r===n&&(44===e.charCodeAt(ms)?(r=z,ms++):(r=n,0===bs&&Os(K)),r===n&&(59===e.charCodeAt(ms)?(r=R,ms++):(r=n,0===bs&&Os(I)),r===n&&(58===e.charCodeAt(ms)?(r=D,ms++):(r=n,0===bs&&Os(U)),r===n&&(64===e.charCodeAt(ms)?(r=H,ms++):(r=n,0===bs&&Os(k)),r===n&&(38===e.charCodeAt(ms)?(r=M,ms++):(r=n,0===bs&&Os(q)),r===n&&(61===e.charCodeAt(ms)?(r=j,ms++):(r=n,0===bs&&Os(L)),r===n&&(43===e.charCodeAt(ms)?(r=F,ms++):(r=n,0===bs&&Os(B)))))))))),r!==n)for(;r!==n;)t.push(r),(r=Bs())===n&&(r=Ws())===n&&(36===e.charCodeAt(ms)?(r=G,ms++):(r=n,0===bs&&Os(W)),r===n&&(44===e.charCodeAt(ms)?(r=z,ms++):(r=n,0===bs&&Os(K)),r===n&&(59===e.charCodeAt(ms)?(r=R,ms++):(r=n,0===bs&&Os(I)),r===n&&(58===e.charCodeAt(ms)?(r=D,ms++):(r=n,0===bs&&Os(U)),r===n&&(64===e.charCodeAt(ms)?(r=H,ms++):(r=n,0===bs&&Os(k)),r===n&&(38===e.charCodeAt(ms)?(r=M,ms++):(r=n,0===bs&&Os(q)),r===n&&(61===e.charCodeAt(ms)?(r=j,ms++):(r=n,0===bs&&Os(L)),r===n&&(43===e.charCodeAt(ms)?(r=F,ms++):(r=n,0===bs&&Os(B))))))))));else t=n;return t}function ja(){var t,r,i,o,s,a,c;if(t=ms,e.substr(ms,3).toLowerCase()===ot?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(vr)),r!==n)if(47===e.charCodeAt(ms)?(i=O,ms++):(i=n,0===bs&&Os(x)),i!==n){if(o=[],(s=Ns())!==n)for(;s!==n;)o.push(s),s=Ns();else o=n;if(o!==n)if(46===e.charCodeAt(ms)?(s=J,ms++):(s=n,0===bs&&Os(Q)),s!==n){if(a=[],(c=Ns())!==n)for(;c!==n;)a.push(c),c=Ns();else a=n;a!==n?(ys=t,t=r=mr()):(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n}else ms=t,t=n;else ms=t,t=n;return t}function La(){var t,r;return t=ms,(r=function(){var t;return e.substr(ms,6)===yr?(t=yr,ms+=6):(t=n,0===bs&&Os(Sr)),t}())===n&&(r=function(){var t;return e.substr(ms,3)===Tr?(t=Tr,ms+=3):(t=n,0===bs&&Os(Cr)),t}())===n&&(r=function(){var t;return e.substr(ms,7)===br?(t=br,ms+=7):(t=n,0===bs&&Os(_r)),t}())===n&&(r=function(){var t;return e.substr(ms,3)===Ar?(t=Ar,ms+=3):(t=n,0===bs&&Os(wr)),t}())===n&&(r=function(){var t;return e.substr(ms,6)===Er?(t=Er,ms+=6):(t=n,0===bs&&Os(Rr)),t}())===n&&(r=function(){var t;return e.substr(ms,8)===Ir?(t=Ir,ms+=8):(t=n,0===bs&&Os(Or)),t}())===n&&(r=function(){var t;return e.substr(ms,9)===xr?(t=xr,ms+=9):(t=n,0===bs&&Os(Pr)),t}())===n&&(r=function(){var t;return e.substr(ms,7)===kr?(t=kr,ms+=7):(t=n,0===bs&&Os(Mr)),t}())===n&&(r=function(){var t;return e.substr(ms,6)===Nr?(t=Nr,ms+=6):(t=n,0===bs&&Os(Dr)),t}())===n&&(r=function(){var t;return e.substr(ms,5)===Ur?(t=Ur,ms+=5):(t=n,0===bs&&Os(Hr)),t}())===n&&(r=Xs()),r!==n&&(ys=t,r=qr()),t=r}function Fa(){var t,r,i,o;return t=ms,Qs()!==n?(r=ms,64===e.charCodeAt(ms)?(i=H,ms++):(i=n,0===bs&&Os(k)),i!==n&&(o=Qs())!==n?r=i=[i,o]:(ms=r,r=n),r===n&&(r=null),r!==n?(ys=t,t=Fr()):(ms=t,t=n)):(ms=t,t=n),t}function Ba(){var t,r,i,o,s,a,c;if(t=ms,(r=function(){var t,r;return t=ms,Ks()!==n?(42===e.charCodeAt(ms)?(r=ne,ms++):(r=n,0===bs&&Os(ie)),r!==n&&Ks()!==n?(ys=t,t=He()):(ms=t,t=n)):(ms=t,t=n),t}())===n)if(r=ms,(i=Ga())!==n){for(o=[],s=ms,(a=na())!==n&&(c=Ga())!==n?s=a=[a,c]:(ms=s,s=n);s!==n;)o.push(s),s=ms,(a=na())!==n&&(c=Ga())!==n?s=a=[a,c]:(ms=s,s=n);o!==n?r=i=[i,o]:(ms=r,r=n)}else ms=r,r=n;return r!==n&&(ys=t,r=Br()),t=r}function Ga(){var e,t,r,i,o,s;if(e=ms,(t=ha())===n&&(t=Wa()),t!==n){for(r=[],i=ms,(o=ia())!==n&&(s=Ka())!==n?i=o=[o,s]:(ms=i,i=n);i!==n;)r.push(i),i=ms,(o=ia())!==n&&(s=Ka())!==n?i=o=[o,s]:(ms=i,i=n);r!==n?(ys=e,e=t=Gr()):(ms=e,e=n)}else ms=e,e=n;return e}function Wa(){var e,t,r,i,o;return e=ms,(t=za())===n&&(t=null),t!==n&&(r=ra())!==n&&(i=pa())!==n&&(o=ta())!==n?e=t=[t,r,i,o]:(ms=e,e=n),e}function za(){var e,t,r,i,o,s,a;if(e=ms,t=ms,(r=Xs())!==n){for(i=[],o=ms,(s=zs())!==n&&(a=Xs())!==n?o=s=[s,a]:(ms=o,o=n);o!==n;)i.push(o),o=ms,(s=zs())!==n&&(a=Xs())!==n?o=s=[s,a]:(ms=o,o=n);i!==n?t=r=[r,i]:(ms=t,t=n)}else ms=t,t=n;return t===n&&(t=aa()),t!==n&&(ys=e,t=Wr(t)),e=t}function Ka(){var t;return(t=function(){var t,r,i;return t=ms,e.substr(ms,1).toLowerCase()===zr?(r=e.charAt(ms),ms++):(r=n,0===bs&&Os(Kr)),r!==n&&ea()!==n&&(i=function(){var t,r,i,o,s,a,c;return t=ms,48===e.charCodeAt(ms)?(r=Qr,ms++):(r=n,0===bs&&Os(Zr)),r!==n?(i=ms,46===e.charCodeAt(ms)?(o=J,ms++):(o=n,0===bs&&Os(Q)),o!==n?((s=Ns())===n&&(s=null),s!==n?((a=Ns())===n&&(a=null),a!==n?((c=Ns())===n&&(c=null),c!==n?i=o=[o,s,a,c]:(ms=i,i=n)):(ms=i,i=n)):(ms=i,i=n)):(ms=i,i=n),i===n&&(i=null),i!==n?(ys=t,r=en(),t=r):(ms=t,t=n)):(ms=t,t=n),t}())!==n?(ys=t,r=Vr(i),t=r):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,7).toLowerCase()===Yr?(r=e.substr(ms,7),ms+=7):(r=n,0===bs&&Os($r)),r!==n&&ea()!==n&&(i=Va())!==n?(ys=t,r=Xr(i),t=r):(ms=t,t=n),t}())===n&&(t=Ya()),t}function Va(){var e,t,r;if(e=ms,t=[],(r=Ns())!==n)for(;r!==n;)t.push(r),r=Ns();else t=n;return t!==n&&(ys=e,t=Jr(t)),e=t}function Ya(){var e,t,r,i,o;return e=ms,(t=Xs())!==n?(r=ms,(i=ea())!==n&&(o=function(){var e;return(e=Xs())===n&&(e=ma())===n&&(e=aa()),e}())!==n?r=i=[i,o]:(ms=r,r=n),r===n&&(r=null),r!==n?(ys=e,e=t=tn(t,r)):(ms=e,e=n)):(ms=e,e=n),e}function $a(){var t;return(t=function(){var t,r,i,o;return t=ms,e.substr(ms,8).toLowerCase()===pn?(r=e.substr(ms,8),ms+=8):(r=n,0===bs&&Os(ln)),r!==n&&(i=ea())!==n?(e.substr(ms,8).toLowerCase()===fn?(o=e.substr(ms,8),ms+=8):(o=n,0===bs&&Os(gn)),o===n&&(e.substr(ms,8).toLowerCase()===vn?(o=e.substr(ms,8),ms+=8):(o=n,0===bs&&Os(mn)),o===n&&(o=Xs())),o!==n?t=r=[r,i,o]:(ms=t,t=n)):(ms=t,t=n),t}())===n&&(t=Ya()),t}function Xa(){var t;return(t=Xs())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,2).toLowerCase()===Un?(r=e.substr(ms,2),ms+=2):(r=n,0===bs&&Os(Hn)),r!==n&&(i=Xs())!==n?t=r=[r,i]:(ms=t,t=n),t}()),t}function Ja(){var e,t,r,i;return e=ms,(t=Xs())!==n&&(r=ea())!==n&&(i=function(){var e;return(e=Xs())===n&&(e=aa()),e}())!==n?e=t=[t,r,i]:(ms=e,e=n),e}function Qa(){var t,r,i,o,s,a,c;if(t=ms,r=ms,(i=Js())!==n){for(o=[],s=ms,46===e.charCodeAt(ms)?(a=J,ms++):(a=n,0===bs&&Os(Q)),a!==n&&(c=Js())!==n?s=a=[a,c]:(ms=s,s=n);s!==n;)o.push(s),s=ms,46===e.charCodeAt(ms)?(a=J,ms++):(a=n,0===bs&&Os(Q)),a!==n&&(c=Js())!==n?s=a=[a,c]:(ms=s,s=n);o!==n?r=i=[i,o]:(ms=r,r=n)}else ms=r,r=n;return t=r!==n?e.substring(t,ms):r}function Za(){var e;return(e=ec())===n&&(e=Ya()),e}function ec(){var t,r,i;return t=ms,e.substr(ms,3).toLowerCase()===jn?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(Ln)),r!==n&&ea()!==n&&(i=Xs())!==n?(ys=t,t=r=Fn(i)):(ms=t,t=n),t}function tc(){var t,r,i,o,s,a,c,u;if(t=ms,e.substr(ms,6).toLowerCase()===Wn?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(zn)),r!==n)if((i=zs())!==n)if((o=nc())!==n){for(s=[],a=ms,(c=na())!==n&&(u=nc())!==n?a=c=[c,u]:(ms=a,a=n);a!==n;)s.push(a),a=ms,(c=na())!==n&&(u=nc())!==n?a=c=[c,u]:(ms=a,a=n);s!==n?t=r=[r,i,o,s]:(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;else ms=t,t=n;return t===n&&(t=function(){var e,t,r,i,o,s,a,c;if(e=ms,(t=Xs())!==n)if((r=zs())!==n)if((i=rc())!==n){for(o=[],s=ms,(a=na())!==n&&(c=rc())!==n?s=a=[a,c]:(ms=s,s=n);s!==n;)o.push(s),s=ms,(a=na())!==n&&(c=rc())!==n?s=a=[a,c]:(ms=s,s=n);o!==n?e=t=[t,r,i,o]:(ms=e,e=n)}else ms=e,e=n;else ms=e,e=n;else ms=e,e=n;return e}()),t}function rc(){var e,t,r,i;return e=ms,(t=Xs())!==n&&(r=ea())!==n?((i=Xs())===n&&(i=aa()),i!==n?e=t=[t,r,i]:(ms=e,e=n)):(ms=e,e=n),e}function nc(){var t;return(t=function(){var t,r,i,o;return t=ms,e.substr(ms,5).toLowerCase()===Kn?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(Vn)),r!==n&&(i=ea())!==n&&(o=function(){var e,t;return e=ms,(t=ca())!==n&&(ys=e,t=Yn(t)),e=t}())!==n?t=r=[r,i,o]:(ms=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s,a,c,u,d;if(t=ms,e.substr(ms,6).toLowerCase()===$n?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(Xn)),r!==n)if((i=ea())!==n)if((o=oa())!==n)if((s=ic())!==n){if(a=[],c=ms,u=[],(d=qs())!==n)for(;d!==n;)u.push(d),d=qs();else u=n;for(u!==n&&(d=ic())!==n?c=u=[u,d]:(ms=c,c=n);c!==n;){if(a.push(c),c=ms,u=[],(d=qs())!==n)for(;d!==n;)u.push(d),d=qs();else u=n;u!==n&&(d=ic())!==n?c=u=[u,d]:(ms=c,c=n)}a!==n&&(c=sa())!==n?t=r=[r,i,o,s,a,c]:(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;else ms=t,t=n;else ms=t,t=n;return t}())===n&&(t=function(){var t,r,i,o;return t=ms,e.substr(ms,5).toLowerCase()===Jn?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(Qn)),r!==n&&(i=ea())!==n&&(o=function(){var e,t;return e=ms,(t=ca())!==n&&(ys=e,t=Zn(t)),e=t}())!==n?t=r=[r,i,o]:(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,6).toLowerCase()===ei?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(ti)),r!==n&&ea()!==n&&(i=ca())!==n?(ys=t,r=ri(i),t=r):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s;return t=ms,e.substr(ms,5).toLowerCase()===ni?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(ii)),r!==n&&(i=ea())!==n?(o=ms,e.substr(ms,4).toLowerCase()===oi?(s=e.substr(ms,4),ms+=4):(s=n,0===bs&&Os(si)),s!==n&&(ys=o,s=ai()),(o=s)===n&&(o=ms,e.substr(ms,5).toLowerCase()===ci?(s=e.substr(ms,5),ms+=5):(s=n,0===bs&&Os(ui)),s!==n&&(ys=o,s=di()),o=s),o!==n?t=r=[r,i,o]:(ms=t,t=n)):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,9).toLowerCase()===hi?(r=e.substr(ms,9),ms+=9):(r=n,0===bs&&Os(pi)),r!==n&&ea()!==n?(e.substr(ms,3).toLowerCase()===li?(i=e.substr(ms,3),ms+=3):(i=n,0===bs&&Os(fi)),i===n&&(e.substr(ms,8).toLowerCase()===gi?(i=e.substr(ms,8),ms+=8):(i=n,0===bs&&Os(vi)),i===n&&(i=Xs())),i!==n?(ys=t,r=mi(i),t=r):(ms=t,t=n)):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s,a,c,u,d,h;if(t=ms,e.substr(ms,3).toLowerCase()===yi?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(Si)),r!==n)if((i=ea())!==n)if((o=oa())!==n){if(s=ms,(a=oc())!==n){for(c=[],u=ms,44===e.charCodeAt(ms)?(d=z,ms++):(d=n,0===bs&&Os(K)),d!==n&&(h=oc())!==n?u=d=[d,h]:(ms=u,u=n);u!==n;)c.push(u),u=ms,44===e.charCodeAt(ms)?(d=z,ms++):(d=n,0===bs&&Os(K)),d!==n&&(h=oc())!==n?u=d=[d,h]:(ms=u,u=n);c!==n?s=a=[a,c]:(ms=s,s=n)}else ms=s,s=n;s!==n&&(a=sa())!==n?t=r=[r,i,o,s,a]:(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;else ms=t,t=n;return t}())===n&&(t=rc()),t}function ic(){var e;return(e=Na())===n&&(e=Da()),e}function oc(){var t,r;return t=ms,e.substr(ms,8).toLowerCase()===Ti?(r=e.substr(ms,8),ms+=8):(r=n,0===bs&&Os(Ci)),r===n&&(e.substr(ms,4).toLowerCase()===bi?(r=e.substr(ms,4),ms+=4):(r=n,0===bs&&Os(_i)),r===n&&(r=Xs())),r!==n&&(ys=t,r=Ai(r)),t=r}function sc(){var e,t,r,i,o;if(e=ms,Wa()!==n){for(t=[],r=ms,(i=ia())!==n&&(o=Ya())!==n?r=i=[i,o]:(ms=r,r=n);r!==n;)t.push(r),r=ms,(i=ia())!==n&&(o=Ya())!==n?r=i=[i,o]:(ms=r,r=n);t!==n?(ys=e,e=Ei()):(ms=e,e=n)}else ms=e,e=n;return e}function ac(){var t,r,i;return t=ms,e.substr(ms,8).toLowerCase()===xi?(r=e.substr(ms,8),ms+=8):(r=n,0===bs&&Os(Pi)),r!==n&&ea()!==n&&(i=Xs())!==n?(ys=t,t=r=Ni(i)):(ms=t,t=n),t===n&&(t=ms,e.substr(ms,6).toLowerCase()===Di?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(Ui)),r!==n&&ea()!==n&&(i=Xs())!==n?(ys=t,t=r=Hi(i)):(ms=t,t=n),t===n&&(t=ms,e.substr(ms,10).toLowerCase()===ki?(r=e.substr(ms,10),ms+=10):(r=n,0===bs&&Os(Mi)),r!==n&&(ys=t,r=qi()),(t=r)===n&&(t=Ya()))),t}function cc(){var t,r,i;return t=ms,e.substr(ms,6).toLowerCase()===$i?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(Xi)),r!==n&&ea()!==n&&(i=function(){var t;return e.substr(ms,11).toLowerCase()===ro?(t=e.substr(ms,11),ms+=11):(t=n,0===bs&&Os(no)),t===n&&(e.substr(ms,9).toLowerCase()===io?(t=e.substr(ms,9),ms+=9):(t=n,0===bs&&Os(oo)),t===n&&(e.substr(ms,8).toLowerCase()===so?(t=e.substr(ms,8),ms+=8):(t=n,0===bs&&Os(ao)),t===n&&(e.substr(ms,7).toLowerCase()===co?(t=e.substr(ms,7),ms+=7):(t=n,0===bs&&Os(uo)),t===n&&(e.substr(ms,6).toLowerCase()===ho?(t=e.substr(ms,6),ms+=6):(t=n,0===bs&&Os(po)),t===n&&(e.substr(ms,10).toLowerCase()===lo?(t=e.substr(ms,10),ms+=10):(t=n,0===bs&&Os(fo)),t===n&&(e.substr(ms,9).toLowerCase()===go?(t=e.substr(ms,9),ms+=9):(t=n,0===bs&&Os(vo)),t===n&&(t=Xs()))))))),t}())!==n?(ys=t,t=r=Ji(i)):(ms=t,t=n),t===n&&(t=ms,e.substr(ms,7).toLowerCase()===Yr?(r=e.substr(ms,7),ms+=7):(r=n,0===bs&&Os($r)),r!==n&&ea()!==n&&(i=Va())!==n?(ys=t,t=r=Qi(i)):(ms=t,t=n),t===n&&(t=ms,e.substr(ms,11).toLowerCase()===Zi?(r=e.substr(ms,11),ms+=11):(r=n,0===bs&&Os(eo)),r!==n&&ea()!==n&&(i=Va())!==n?(ys=t,t=r=to(i)):(ms=t,t=n),t===n&&(t=Ya()))),t}function uc(){var e;return(e=ec())===n&&(e=Ya()),e}function dc(){var t,r,i,o,s,a,c,u;if(t=ms,(r=function(){var t,r,i,o,s,a;return t=ms,(r=function(){var t,r;return t=ms,e.substr(ms,3).toLowerCase()===ot?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(vr)),r===n&&(r=Xs()),r!==n&&(ys=t,r=Uo(r)),t=r}())!==n&&(i=Zs())!==n&&(o=Xs())!==n&&(s=Zs())!==n&&(a=pc())!==n?t=r=[r,i,o,s,a]:(ms=t,t=n),t}())!==n)if((i=zs())!==n)if((o=function(){var t,r,i,o,s;return t=ms,(r=function(){var e,t;return e=ms,(t=ya())===n&&(t=Aa())===n&&(t=Ta()),t!==n&&(ys=e,t=Lo()),e=t}())!==n?(i=ms,(o=function(){var t,r;return t=ms,Ks()!==n?(58===e.charCodeAt(ms)?(r=D,ms++):(r=n,0===bs&&Os(U)),r!==n&&Ks()!==n?(ys=t,t=Be()):(ms=t,t=n)):(ms=t,t=n),t}())!==n&&(s=function(){var e,t,r,i,o,s,a;return e=ms,t=ms,(r=Ns())===n&&(r=null),r!==n?((i=Ns())===n&&(i=null),i!==n?((o=Ns())===n&&(o=null),o!==n?((s=Ns())===n&&(s=null),s!==n?((a=Ns())===n&&(a=null),a!==n?t=r=[r,i,o,s,a]:(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t!==n&&(ys=e,t=Fo(t)),e=t}())!==n?i=o=[o,s]:(ms=i,i=n),i===n&&(i=null),i!==n?t=r=[r,i]:(ms=t,t=n)):(ms=t,t=n),t}())!==n){for(s=[],a=ms,(c=ia())!==n&&(u=hc())!==n?a=c=[c,u]:(ms=a,a=n);a!==n;)s.push(a),a=ms,(c=ia())!==n&&(u=hc())!==n?a=c=[c,u]:(ms=a,a=n);s!==n?t=r=[r,i,o,s]:(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;else ms=t,t=n;return t}function hc(){var t;return(t=function(){var t,r,i;return t=ms,e.substr(ms,3).toLowerCase()===So?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(To)),r!==n&&ea()!==n&&(i=lc())!==n?(ys=t,r=Co(i),t=r):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,5).toLowerCase()===bo?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(_o)),r!==n&&ea()!==n&&(i=ma())!==n?(ys=t,r=Ao(i),t=r):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,8).toLowerCase()===wo?(r=e.substr(ms,8),ms+=8):(r=n,0===bs&&Os(Eo)),r!==n&&ea()!==n?((i=Aa())===n&&(i=Ca())===n&&(i=Ta()),i!==n?(ys=t,r=Ro(i),t=r):(ms=t,t=n)):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=ms,e.substr(ms,6).toLowerCase()===Io?(r=e.substr(ms,6),ms+=6):(r=n,0===bs&&Os(Oo)),r!==n&&ea()!==n&&(i=Xs())!==n?(ys=t,r=xo(i),t=r):(ms=t,t=n),t}())===n&&(t=function(){var t,r,i,o;if(t=ms,e.substr(ms,5).toLowerCase()===Po?(r=e.substr(ms,5),ms+=5):(r=n,0===bs&&Os(No)),r!==n)if(ea()!==n){for(i=[],o=Ns();o!==n;)i.push(o),o=Ns();i!==n?(ys=t,r=Do(i),t=r):(ms=t,t=n)}else ms=t,t=n;else ms=t,t=n;return t}())===n&&(t=Ya()),t}function pc(){var t,r;return t=ms,e.substr(ms,3).toLowerCase()===kt?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(Ho)),r===n&&(e.substr(ms,3).toLowerCase()===qt?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(ko)),r===n&&(e.substr(ms,3).toLowerCase()===Bt?(r=e.substr(ms,3),ms+=3):(r=n,0===bs&&Os(Mo)),r===n&&(e.substr(ms,4).toLowerCase()===Lt?(r=e.substr(ms,4),ms+=4):(r=n,0===bs&&Os(qo)),r===n&&(r=Xs())))),r!==n&&(ys=t,r=jo(r)),t=r}function lc(){var e,t,r,i,o;return e=ms,t=ms,(r=Ns())!==n?((i=Ns())===n&&(i=null),i!==n?((o=Ns())===n&&(o=null),o!==n?t=r=[r,i,o]:(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t!==n&&(ys=e,t=Bo(t)),e=t}function fc(){var t;return(t=function(){var t,r,i;return t=ms,e.substr(ms,9)===Wo?(r=Wo,ms+=9):(r=n,0===bs&&Os(zo)),r!==n&&ea()!==n?(e.substr(ms,3)===Ko?(i=Ko,ms+=3):(i=n,0===bs&&Os(Vo)),i===n&&(e.substr(ms,3)===Yo?(i=Yo,ms+=3):(i=n,0===bs&&Os($o))),i!==n?(ys=t,r=Xo(i),t=r):(ms=t,t=n)):(ms=t,t=n),t}())===n&&(t=Ya()),t}function gc(){var t,r,i,o,s;return t=ms,(r=function(){var e,t;return e=ms,(t=Aa())===n&&(t=Ta())===n&&(t=qa()),t!==n&&(ys=e,t=ns(t)),e=t}())!==n?(i=ms,58===e.charCodeAt(ms)?(o=D,ms++):(o=n,0===bs&&Os(U)),o!==n&&(s=Ea())!==n?i=o=[o,s]:(ms=i,i=n),i===n&&(i=null),i!==n?t=r=[r,i]:(ms=t,t=n)):(ms=t,t=n),t}function vc(){var e,t,r,i,o;return e=ms,(t=Us())!==n&&(r=Us())!==n&&(i=Us())!==n&&(o=Us())!==n?e=t=[t,r,i,o]:(ms=e,e=n),e}function mc(){var t,r,i,o;return t=ms,e.substr(ms,3)===gs?(r=gs,ms+=3):(r=n,0===bs&&Os(vs)),r!==n&&(i=ea())!==n&&(o=function(){var t,r,i,o,s,a;return t=ms,(r=oa())!==n&&(i=Gs())!==n?(64===e.charCodeAt(ms)?(o=H,ms++):(o=n,0===bs&&Os(k)),o!==n?((s=Gs())===n&&(s=ma()),s!==n&&(a=sa())!==n?t=r=[r,i,o,s,a]:(ms=t,t=n)):(ms=t,t=n)):(ms=t,t=n),t}())!==n?t=r=[r,i,o]:(ms=t,t=n),t}if(t.data={},(r=c())!==n&&ms===e.length)return r;throw r!==n&&ms<e.length&&Os({type:"end"}),xs(Cs,Ts<e.length?e.charAt(Ts):null,Ts<e.length?Is(Ts,Ts+1):Is(Ts,Ts))}},function(e,t,r){var n;e.exports=(n=r(0),r(21),r(67),r(68),r(16),r(17),r(25),r(38),r(69),r(39),r(70),r(71),r(72),r(26),r(73),r(13),r(4),r(74),r(75),r(76),r(77),r(78),r(79),r(80),r(81),r(82),r(83),r(84),r(85),r(86),r(87),r(88),r(89),n)},function(e,t,r){var n;e.exports=(n=r(0),function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,n=[],i=0;i<r;i++)n[i>>>2]|=e[i]<<24-i%4*8;t.call(this,n,r)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)},function(e,t,r){var n;e.exports=(n=r(0),function(){var e=n,t=e.lib.WordArray,r=e.enc;function i(e){return e<<8&4278255360|e>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=2){var o=t[i>>>2]>>>16-i%4*8&65535;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var r=e.length,n=[],i=0;i<r;i++)n[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return t.create(n,2*r)}},r.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o+=2){var s=i(t[o>>>2]>>>16-o%4*8&65535);n.push(String.fromCharCode(s))}return n.join("")},parse:function(e){for(var r=e.length,n=[],o=0;o<r;o++)n[o>>>1]|=i(e.charCodeAt(o)<<16-o%2*16);return t.create(n,2*r)}}}(),n.enc.Utf16)},function(e,t,r){var n,i,o,s,a,c;e.exports=(n=r(0),r(38),o=(i=n).lib.WordArray,s=i.algo,a=s.SHA256,c=s.SHA224=a.extend({_doReset:function(){this._hash=new o.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),i.SHA224=a._createHelper(c),i.HmacSHA224=a._createHmacHelper(c),n.SHA224)},function(e,t,r){var n,i,o,s,a,c,u,d;e.exports=(n=r(0),r(21),r(39),o=(i=n).x64,s=o.Word,a=o.WordArray,c=i.algo,u=c.SHA512,d=c.SHA384=u.extend({_doReset:function(){this._hash=new a.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var e=u._doFinalize.call(this);return e.sigBytes-=16,e}}),i.SHA384=u._createHelper(d),i.HmacSHA384=u._createHmacHelper(d),n.SHA384)},function(e,t,r){var n;e.exports=(n=r(0),r(21),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,s=t.x64.Word,a=t.algo,c=[],u=[],d=[];!function(){for(var e=1,t=0,r=0;r<24;r++){c[e+5*t]=(r+1)*(r+2)/2%64;var n=(2*e+3*t)%5;e=t%5,t=n}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,o=0;o<24;o++){for(var a=0,h=0,p=0;p<7;p++){if(1&i){var l=(1<<p)-1;l<32?h^=1<<l:a^=1<<l-32}128&i?i=i<<1^113:i<<=1}d[o]=s.create(a,h)}}();var h=[];!function(){for(var e=0;e<25;e++)h[e]=s.create()}();var p=a.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,n=this.blockSize/2,i=0;i<n;i++){var o=e[t+2*i],s=e[t+2*i+1];o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),(I=r[i]).high^=s,I.low^=o}for(var a=0;a<24;a++){for(var p=0;p<5;p++){for(var l=0,f=0,g=0;g<5;g++)l^=(I=r[p+5*g]).high,f^=I.low;var v=h[p];v.high=l,v.low=f}for(p=0;p<5;p++){var m=h[(p+4)%5],y=h[(p+1)%5],S=y.high,T=y.low;for(l=m.high^(S<<1|T>>>31),f=m.low^(T<<1|S>>>31),g=0;g<5;g++)(I=r[p+5*g]).high^=l,I.low^=f}for(var C=1;C<25;C++){var b=(I=r[C]).high,_=I.low,A=c[C];A<32?(l=b<<A|_>>>32-A,f=_<<A|b>>>32-A):(l=_<<A-32|b>>>64-A,f=b<<A-32|_>>>64-A);var w=h[u[C]];w.high=l,w.low=f}var E=h[0],R=r[0];for(E.high=R.high,E.low=R.low,p=0;p<5;p++)for(g=0;g<5;g++){var I=r[C=p+5*g],O=h[C],x=h[(p+1)%5+5*g],P=h[(p+2)%5+5*g];I.high=O.high^~x.high&P.high,I.low=O.low^~x.low&P.low}I=r[0];var N=d[a];I.high^=N.high,I.low^=N.low}},_doFinalize:function(){var t=this._data,r=t.words,n=(this._nDataBytes,8*t.sigBytes),o=32*this.blockSize;r[n>>>5]|=1<<24-n%32,r[(e.ceil((n+1)/o)*o>>>5)-1]|=128,t.sigBytes=4*r.length,this._process();for(var s=this._state,a=this.cfg.outputLength/8,c=a/8,u=[],d=0;d<c;d++){var h=s[d],p=h.high,l=h.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),l=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8),u.push(l),u.push(p)}return new i.init(u,a)},clone:function(){for(var e=o.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}});t.SHA3=o._createHelper(p),t.HmacSHA3=o._createHmacHelper(p)}(Math),n.SHA3)},function(e,t,r){var n;e.exports=(n=r(0),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,s=t.algo,a=i.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=i.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=i.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=i.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=i.create([0,1518500249,1859775393,2400959708,2840853838]),p=i.create([1352829926,1548603684,1836072691,2053994217,0]),l=s.RIPEMD160=o.extend({_doReset:function(){this._hash=i.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o,s,l,T,C,b,_,A,w,E,R,I=this._hash.words,O=h.words,x=p.words,P=a.words,N=c.words,D=u.words,U=d.words;for(b=o=I[0],_=s=I[1],A=l=I[2],w=T=I[3],E=C=I[4],r=0;r<80;r+=1)R=o+e[t+P[r]]|0,R+=r<16?f(s,l,T)+O[0]:r<32?g(s,l,T)+O[1]:r<48?v(s,l,T)+O[2]:r<64?m(s,l,T)+O[3]:y(s,l,T)+O[4],R=(R=S(R|=0,D[r]))+C|0,o=C,C=T,T=S(l,10),l=s,s=R,R=b+e[t+N[r]]|0,R+=r<16?y(_,A,w)+x[0]:r<32?m(_,A,w)+x[1]:r<48?v(_,A,w)+x[2]:r<64?g(_,A,w)+x[3]:f(_,A,w)+x[4],R=(R=S(R|=0,U[r]))+E|0,b=E,E=w,w=S(A,10),A=_,_=R;R=I[1]+l+w|0,I[1]=I[2]+T+E|0,I[2]=I[3]+C+b|0,I[3]=I[4]+o+_|0,I[4]=I[0]+s+A|0,I[0]=R},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,o=i.words,s=0;s<5;s++){var a=o[s];o[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return i},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function f(e,t,r){return e^t^r}function g(e,t,r){return e&t|~e&r}function v(e,t,r){return(e|~t)^r}function m(e,t,r){return e&r|t&~r}function y(e,t,r){return e^(t|~r)}function S(e,t){return e<<t|e>>>32-t}t.RIPEMD160=o._createHelper(l),t.HmacRIPEMD160=o._createHmacHelper(l)}(Math),n.RIPEMD160)},function(e,t,r){var n,i,o,s,a,c,u,d,h;e.exports=(n=r(0),r(25),r(26),o=(i=n).lib,s=o.Base,a=o.WordArray,c=i.algo,u=c.SHA1,d=c.HMAC,h=c.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:u,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=d.create(r.hasher,e),i=a.create(),o=a.create([1]),s=i.words,c=o.words,u=r.keySize,h=r.iterations;s.length<u;){var p=n.update(t).finalize(o);n.reset();for(var l=p.words,f=l.length,g=p,v=1;v<h;v++){g=n.finalize(g),n.reset();for(var m=g.words,y=0;y<f;y++)l[y]^=m[y]}i.concat(p),c[0]++}return i.sigBytes=4*u,i}}),i.PBKDF2=function(e,t,r){return h.create(r).compute(e,t)},n.PBKDF2)},function(e,t,r){var n;e.exports=(n=r(0),r(4),n.mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,r,n){var i=this._iv;if(i){var o=i.slice(0);this._iv=void 0}else o=this._prevBlock;n.encryptBlock(o,0);for(var s=0;s<r;s++)e[t+s]^=o[s]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize;t.call(this,e,r,i,n),this._prevBlock=e.slice(r,r+i)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=e.slice(r,r+i);t.call(this,e,r,i,n),this._prevBlock=o}}),e}(),n.mode.CFB)},function(e,t,r){var n,i,o;e.exports=(n=r(0),r(4),n.mode.CTR=(i=n.lib.BlockCipherMode.extend(),o=i.Encryptor=i.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=this._iv,o=this._counter;i&&(o=this._counter=i.slice(0),this._iv=void 0);var s=o.slice(0);r.encryptBlock(s,0),o[n-1]=o[n-1]+1|0;for(var a=0;a<n;a++)e[t+a]^=s[a]}}),i.Decryptor=o,i),n.mode.CTR)},function(e,t,r){var n;e.exports=(n=r(0),r(4),n.mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,r=e>>8&255,n=255&e;255===t?(t=0,255===r?(r=0,255===n?n=0:++n):++r):++t,e=0,e+=t<<16,e+=r<<8,e+=n}else e+=1<<24;return e}var r=e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,i=n.blockSize,o=this._iv,s=this._counter;o&&(s=this._counter=o.slice(0),this._iv=void 0),function(e){0===(e[0]=t(e[0]))&&(e[1]=t(e[1]))}(s);var a=s.slice(0);n.encryptBlock(a,0);for(var c=0;c<i;c++)e[r+c]^=a[c]}});return e.Decryptor=r,e}(),n.mode.CTRGladman)},function(e,t,r){var n,i,o;e.exports=(n=r(0),r(4),n.mode.OFB=(i=n.lib.BlockCipherMode.extend(),o=i.Encryptor=i.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=this._iv,o=this._keystream;i&&(o=this._keystream=i.slice(0),this._iv=void 0),r.encryptBlock(o,0);for(var s=0;s<n;s++)e[t+s]^=o[s]}}),i.Decryptor=o,i),n.mode.OFB)},function(e,t,r){var n,i;e.exports=(n=r(0),r(4),n.mode.ECB=((i=n.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),i.Decryptor=i.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),i),n.mode.ECB)},function(e,t,r){var n;e.exports=(n=r(0),r(4),n.pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,n=4*t,i=n-r%n,o=r+i-1;e.clamp(),e.words[o>>>2]|=i<<24-o%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)},function(e,t,r){var n;e.exports=(n=r(0),r(4),n.pad.Iso10126={pad:function(e,t){var r=4*t,i=r-e.sigBytes%r;e.concat(n.lib.WordArray.random(i-1)).concat(n.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)},function(e,t,r){var n;e.exports=(n=r(0),r(4),n.pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)},function(e,t,r){var n;e.exports=(n=r(0),r(4),n.pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){for(var t=e.words,r=e.sigBytes-1;!(t[r>>>2]>>>24-r%4*8&255);)r--;e.sigBytes=r+1}},n.pad.ZeroPadding)},function(e,t,r){var n;e.exports=(n=r(0),r(4),n.pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)},function(e,t,r){var n,i,o,s;e.exports=(n=r(0),r(4),o=(i=n).lib.CipherParams,s=i.enc.Hex,i.format.Hex={stringify:function(e){return e.ciphertext.toString(s)},parse:function(e){var t=s.parse(e);return o.create({ciphertext:t})}},n.format.Hex)},function(e,t,r){var n;e.exports=(n=r(0),r(16),r(17),r(13),r(4),function(){var e=n,t=e.lib.BlockCipher,r=e.algo,i=[],o=[],s=[],a=[],c=[],u=[],d=[],h=[],p=[],l=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var f=n^n<<1^n<<2^n<<3^n<<4;f=f>>>8^255&f^99,i[r]=f,o[f]=r;var g=e[r],v=e[g],m=e[v],y=257*e[f]^16843008*f;s[r]=y<<24|y>>>8,a[r]=y<<16|y>>>16,c[r]=y<<8|y>>>24,u[r]=y,y=16843009*m^65537*v^257*g^16843008*r,d[f]=y<<24|y>>>8,h[f]=y<<16|y>>>16,p[f]=y<<8|y>>>24,l[f]=y,r?(r=g^e[e[e[m^g]]],n^=e[e[n]]):r=n=1}}();var f=[0,1,2,4,8,16,32,64,128,27,54],g=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),o=this._keySchedule=[],s=0;s<n;s++)if(s<r)o[s]=t[s];else{var a=o[s-1];s%r?r>6&&s%r==4&&(a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a]):(a=i[(a=a<<8|a>>>24)>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a],a^=f[s/r|0]<<24),o[s]=o[s-r]^a}for(var c=this._invKeySchedule=[],u=0;u<n;u++)s=n-u,a=u%4?o[s]:o[s-4],c[u]=u<4||s<=4?a:d[i[a>>>24]]^h[i[a>>>16&255]]^p[i[a>>>8&255]]^l[i[255&a]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,a,c,u,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,d,h,p,l,o),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,o,s,a){for(var c=this._nRounds,u=e[t]^r[0],d=e[t+1]^r[1],h=e[t+2]^r[2],p=e[t+3]^r[3],l=4,f=1;f<c;f++){var g=n[u>>>24]^i[d>>>16&255]^o[h>>>8&255]^s[255&p]^r[l++],v=n[d>>>24]^i[h>>>16&255]^o[p>>>8&255]^s[255&u]^r[l++],m=n[h>>>24]^i[p>>>16&255]^o[u>>>8&255]^s[255&d]^r[l++],y=n[p>>>24]^i[u>>>16&255]^o[d>>>8&255]^s[255&h]^r[l++];u=g,d=v,h=m,p=y}g=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&p])^r[l++],v=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[p>>>8&255]<<8|a[255&u])^r[l++],m=(a[h>>>24]<<24|a[p>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^r[l++],y=(a[p>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^r[l++],e[t]=g,e[t+1]=v,e[t+2]=m,e[t+3]=y},keySize:8});e.AES=t._createHelper(g)}(),n.AES)},function(e,t,r){var n;e.exports=(n=r(0),r(16),r(17),r(13),r(4),function(){var e=n,t=e.lib,r=t.WordArray,i=t.BlockCipher,o=e.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=o.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var n=s[r]-1;t[r]=e[n>>>5]>>>31-n%32&1}for(var i=this._subKeys=[],o=0;o<16;o++){var u=i[o]=[],d=c[o];for(r=0;r<24;r++)u[r/6|0]|=t[(a[r]-1+d)%28]<<31-r%6,u[4+(r/6|0)]|=t[28+(a[r+24]-1+d)%28]<<31-r%6;for(u[0]=u[0]<<1|u[0]>>>31,r=1;r<7;r++)u[r]=u[r]>>>4*(r-1)+3;u[7]=u[7]<<5|u[7]>>>27}var h=this._invSubKeys=[];for(r=0;r<16;r++)h[r]=i[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),l.call(this,2,858993459),l.call(this,8,16711935),p.call(this,1,1431655765);for(var n=0;n<16;n++){for(var i=r[n],o=this._lBlock,s=this._rBlock,a=0,c=0;c<8;c++)a|=u[c][((s^i[c])&d[c])>>>0];this._lBlock=s,this._rBlock=o^a}var h=this._lBlock;this._lBlock=this._rBlock,this._rBlock=h,p.call(this,1,1431655765),l.call(this,8,16711935),l.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function l(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}e.DES=i._createHelper(h);var f=o.TripleDES=i.extend({_doReset:function(){var e=this._key.words;this._des1=h.createEncryptor(r.create(e.slice(0,2))),this._des2=h.createEncryptor(r.create(e.slice(2,4))),this._des3=h.createEncryptor(r.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=i._createHelper(f)}(),n.TripleDES)},function(e,t,r){var n;e.exports=(n=r(0),r(16),r(17),r(13),r(4),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,i=r.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var o=0;i<256;i++){var s=i%r,a=t[s>>>2]>>>24-s%4*8&255;o=(o+n[i]+a)%256;var c=n[i];n[i]=n[o],n[o]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=o.call(this)},keySize:8,ivSize:0});function o(){for(var e=this._S,t=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+e[t=(t+1)%256])%256;var o=e[t];e[t]=e[r],e[r]=o,n|=e[(e[t]+e[r])%256]<<24-8*i}return this._i=t,this._j=r,n}e.RC4=t._createHelper(i);var s=r.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)o.call(this)}});e.RC4Drop=t._createHelper(s)}(),n.RC4)},function(e,t,r){var n;e.exports=(n=r(0),r(16),r(17),r(13),r(4),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,i=[],o=[],s=[],a=r.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)i[r]^=n[r+4&7];if(t){var o=t.words,s=o[0],a=o[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),h=u>>>16|4294901760&d,p=d<<16|65535&u;for(i[0]^=u,i[1]^=h,i[2]^=d,i[3]^=p,i[4]^=u,i[5]^=h,i[6]^=d,i[7]^=p,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)i[n]=16711935&(i[n]<<8|i[n]>>>24)|4278255360&(i[n]<<24|i[n]>>>8),e[t+n]^=i[n]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)o[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],i=65535&n,a=n>>>16,c=((i*i>>>17)+i*a>>>15)+a*a,u=((4294901760&n)*n|0)+((65535&n)*n|0);s[r]=c^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.Rabbit=t._createHelper(a)}(),n.Rabbit)},function(e,t,r){var n;e.exports=(n=r(0),r(16),r(17),r(13),r(4),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,i=[],o=[],s=[],a=r.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)c.call(this);for(i=0;i<8;i++)n[i]^=r[i+4&7];if(t){var o=t.words,s=o[0],a=o[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),d=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),h=u>>>16|4294901760&d,p=d<<16|65535&u;for(n[0]^=u,n[1]^=h,n[2]^=d,n[3]^=p,n[4]^=u,n[5]^=h,n[6]^=d,n[7]^=p,i=0;i<4;i++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)i[n]=16711935&(i[n]<<8|i[n]>>>24)|4278255360&(i[n]<<24|i[n]>>>8),e[t+n]^=i[n]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)o[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<o[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<o[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<o[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<o[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<o[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<o[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<o[6]>>>0?1:0)|0,this._b=t[7]>>>0<o[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],i=65535&n,a=n>>>16,c=((i*i>>>17)+i*a>>>15)+a*a,u=((4294901760&n)*n|0)+((65535&n)*n|0);s[r]=c^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.RabbitLegacy=t._createHelper(a)}(),n.RabbitLegacy)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(12),a=r(30),c=r(20),u=function(e){function t(t,r,n){return e.call(this,t,r,n,c.TransactionState.Proceeding,"sip.transaction.ist")||this}return i(t,e),t.prototype.dispose=function(){this.stopProgressExtensionTimer(),this.H&&(clearTimeout(this.H),this.H=void 0),this.I&&(clearTimeout(this.I),this.I=void 0),this.L&&(clearTimeout(this.L),this.L=void 0),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"kind",{get:function(){return"ist"},enumerable:!0,configurable:!0}),t.prototype.receiveRequest=function(e){var t=this;switch(this.state){case c.TransactionState.Proceeding:if(e.method===o.C.INVITE)return void(this.lastProvisionalResponse&&this.send(this.lastProvisionalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")}));break;case c.TransactionState.Accepted:if(e.method===o.C.INVITE)return;break;case c.TransactionState.Completed:if(e.method===o.C.INVITE){if(!this.lastFinalResponse)throw new Error("Last final response undefined.");return void this.send(this.lastFinalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")})}if(e.method===o.C.ACK)return void this.stateTransition(c.TransactionState.Confirmed);break;case c.TransactionState.Confirmed:case c.TransactionState.Terminated:if(e.method===o.C.INVITE||e.method===o.C.ACK)return;break;default:throw new Error("Invalid state "+this.state)}var r="INVITE server transaction received unexpected "+e.method+" request while in state "+this.state+".";this.logger.warn(r)},t.prototype.receiveResponse=function(e,t){var r=this;if(e<100||e>699)throw new Error("Invalid status code "+e);switch(this.state){case c.TransactionState.Proceeding:if(e>=100&&e<=199)return this.lastProvisionalResponse=t,e>100&&this.startProgressExtensionTimer(),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 1xx response.")});if(e>=200&&e<=299)return this.lastFinalResponse=t,this.stateTransition(c.TransactionState.Accepted),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});if(e>=300&&e<=699)return this.lastFinalResponse=t,this.stateTransition(c.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send non-2xx final response.")});break;case c.TransactionState.Accepted:if(e>=200&&e<=299)return void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});break;case c.TransactionState.Completed:case c.TransactionState.Confirmed:case c.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var n="INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";throw this.logger.error(n),new Error(n)},t.prototype.retransmitAcceptedResponse=function(){var e=this;this.state===c.TransactionState.Accepted&&this.lastFinalResponse&&this.send(this.lastFinalResponse).catch(function(t){e.logTransportError(t,"Failed to send 2xx response.")})},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e)},t.prototype.typeToString=function(){return"INVITE server transaction"},t.prototype.stateTransition=function(e){var t=this,r=function(){throw new Error("Invalid state transition from "+t.state+" to "+e)};switch(e){case c.TransactionState.Proceeding:r();break;case c.TransactionState.Accepted:case c.TransactionState.Completed:this.state!==c.TransactionState.Proceeding&&r();break;case c.TransactionState.Confirmed:this.state!==c.TransactionState.Completed&&r();break;case c.TransactionState.Terminated:this.state!==c.TransactionState.Accepted&&this.state!==c.TransactionState.Completed&&this.state!==c.TransactionState.Confirmed&&r();break;default:r()}this.stopProgressExtensionTimer(),e===c.TransactionState.Accepted&&(this.L=setTimeout(function(){return t.timer_L()},s.Timers.TIMER_L)),e===c.TransactionState.Completed&&(this.H=setTimeout(function(){return t.timer_H()},s.Timers.TIMER_H)),e===c.TransactionState.Confirmed&&(this.I=setTimeout(function(){return t.timer_I()},s.Timers.TIMER_I)),e===c.TransactionState.Terminated&&this.dispose(),this.setState(e)},t.prototype.startProgressExtensionTimer=function(){var e=this;void 0===this.progressExtensionTimer&&(this.progressExtensionTimer=setInterval(function(){if(e.logger.debug("Progress extension timer expired for INVITE server transaction "+e.id+"."),!e.lastProvisionalResponse)throw new Error("Last provisional response undefined.");e.send(e.lastProvisionalResponse).catch(function(t){e.logTransportError(t,"Failed to send retransmission of provisional response.")})},s.Timers.PROVISIONAL_RESPONSE_INTERVAL))},t.prototype.stopProgressExtensionTimer=function(){void 0!==this.progressExtensionTimer&&(clearInterval(this.progressExtensionTimer),this.progressExtensionTimer=void 0)},t.prototype.timer_G=function(){},t.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id+"."),this.state===c.TransactionState.Completed&&(this.logger.warn("ACK to negative final response was never received, terminating transaction."),this.stateTransition(c.TransactionState.Terminated))},t.prototype.timer_I=function(){this.logger.debug("Timer I expired for INVITE server transaction "+this.id+"."),this.stateTransition(c.TransactionState.Terminated)},t.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id+"."),this.state===c.TransactionState.Accepted&&this.stateTransition(c.TransactionState.Terminated)},t}(a.ServerTransaction);t.InviteServerTransaction=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(12),s=r(28),a=r(20),c=function(e){function t(t,r,n){var i=e.call(this,t,r,n,a.TransactionState.Trying,"sip.transaction.nict")||this;return i.F=setTimeout(function(){return i.timer_F()},o.Timers.TIMER_F),i.send(t.toString()).catch(function(e){i.logTransportError(e,"Failed to send initial outgoing request.")}),i}return i(t,e),t.prototype.dispose=function(){this.F&&(clearTimeout(this.F),this.F=void 0),this.K&&(clearTimeout(this.K),this.K=void 0),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"kind",{get:function(){return"nict"},enumerable:!0,configurable:!0}),t.prototype.receiveResponse=function(e){var t=e.statusCode;if(!t||t<100||t>699)throw new Error("Invalid status code "+t);switch(this.state){case a.TransactionState.Trying:if(t>=100&&t<=199)return this.stateTransition(a.TransactionState.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=699)return this.stateTransition(a.TransactionState.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case a.TransactionState.Proceeding:if(t>=100&&t<=199&&this.user.receiveResponse)return this.user.receiveResponse(e);if(t>=200&&t<=699)return this.stateTransition(a.TransactionState.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));case a.TransactionState.Completed:case a.TransactionState.Terminated:return;default:throw new Error("Invalid state "+this.state)}var r="Non-INVITE client transaction received unexpected "+t+" response while in state "+this.state+".";this.logger.warn(r)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(a.TransactionState.Terminated,!0)},t.prototype.typeToString=function(){return"non-INVITE client transaction"},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var n=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case a.TransactionState.Trying:n();break;case a.TransactionState.Proceeding:this.state!==a.TransactionState.Trying&&n();break;case a.TransactionState.Completed:this.state!==a.TransactionState.Trying&&this.state!==a.TransactionState.Proceeding&&n();break;case a.TransactionState.Terminated:this.state!==a.TransactionState.Trying&&this.state!==a.TransactionState.Proceeding&&this.state!==a.TransactionState.Completed&&(t||n());break;default:n()}e===a.TransactionState.Completed&&(this.F&&(clearTimeout(this.F),this.F=void 0),this.K=setTimeout(function(){return r.timer_K()},o.Timers.TIMER_K)),e===a.TransactionState.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id+"."),this.state!==a.TransactionState.Trying&&this.state!==a.TransactionState.Proceeding||(this.onRequestTimeout(),this.stateTransition(a.TransactionState.Terminated))},t.prototype.timer_K=function(){this.state===a.TransactionState.Completed&&this.stateTransition(a.TransactionState.Terminated)},t}(s.ClientTransaction);t.NonInviteClientTransaction=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(12),s=r(30),a=r(20),c=function(e){function t(t,r,n){return e.call(this,t,r,n,a.TransactionState.Trying,"sip.transaction.nist")||this}return i(t,e),t.prototype.dispose=function(){this.J&&(clearTimeout(this.J),this.J=void 0),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"kind",{get:function(){return"nist"},enumerable:!0,configurable:!0}),t.prototype.receiveRequest=function(e){var t=this;switch(this.state){case a.TransactionState.Trying:break;case a.TransactionState.Proceeding:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")});break;case a.TransactionState.Completed:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")});break;case a.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}},t.prototype.receiveResponse=function(e,t){var r=this;if(e<100||e>699)throw new Error("Invalid status code "+e);if(e>100&&e<=199)throw new Error("Provisional response other than 100 not allowed.");switch(this.state){case a.TransactionState.Trying:if(this.lastResponse=t,e>=100&&e<200)return this.stateTransition(a.TransactionState.Proceeding),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send provisional response.")});if(e>=200&&e<=699)return this.stateTransition(a.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});break;case a.TransactionState.Proceeding:if(this.lastResponse=t,e>=200&&e<=699)return this.stateTransition(a.TransactionState.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});break;case a.TransactionState.Completed:return;case a.TransactionState.Terminated:break;default:throw new Error("Invalid state "+this.state)}var n="Non-INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";throw this.logger.error(n),new Error(n)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(a.TransactionState.Terminated,!0)},t.prototype.typeToString=function(){return"non-INVITE server transaction"},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var n=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case a.TransactionState.Trying:n();break;case a.TransactionState.Proceeding:this.state!==a.TransactionState.Trying&&n();break;case a.TransactionState.Completed:this.state!==a.TransactionState.Trying&&this.state!==a.TransactionState.Proceeding&&n();break;case a.TransactionState.Terminated:this.state!==a.TransactionState.Proceeding&&this.state!==a.TransactionState.Completed&&(t||n());break;default:n()}e===a.TransactionState.Completed&&(this.J=setTimeout(function(){return r.timer_J()},o.Timers.TIMER_J)),e===a.TransactionState.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_J=function(){this.logger.debug("Timer J expired for NON-INVITE server transaction "+this.id+"."),this.state===a.TransactionState.Completed&&this.stateTransition(a.TransactionState.Terminated)},t}(s.ServerTransaction);t.NonInviteServerTransaction=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8);function i(e){return!(!e||"string"!=typeof e.content||"string"!=typeof e.contentType||void 0!==e.contentDisposition)||"string"==typeof e.contentDisposition}function o(e){return"application/sdp"===e?"session":"render"}t.fromBodyObj=function(e){var t=e.body,r=e.contentType;return{contentDisposition:o(r),contentType:r,content:t}},t.fromBodyLegacy=function(e){var t="string"==typeof e?e:e.body,r="string"==typeof e?"application/sdp":e.contentType;return{contentDisposition:o(r),contentType:r,content:t}},t.getBody=function(e){var t,r,s,a;if(e instanceof n.IncomingRequest&&e.body&&(t=(a=e.parseHeader("Content-Disposition"))?a.type:void 0,r=e.parseHeader("Content-Type"),s=e.body),e instanceof n.IncomingResponse&&e.body&&(t=(a=e.parseHeader("Content-Disposition"))?a.type:void 0,r=e.parseHeader("Content-Type"),s=e.body),e instanceof n.OutgoingRequest&&e.body)if(t=e.getHeader("Content-Disposition"),r=e.getHeader("Content-Type"),"string"==typeof e.body){if(!r)throw new Error("Header content type header does not equal body content type.");s=e.body}else{if(r&&r!==e.body.contentType)throw new Error("Header content type header does not equal body content type.");r=e.body.contentType,s=e.body.body}if(i(e)&&(t=e.contentDisposition,r=e.contentType,s=e.content),s){if(r&&!t&&(t=o(r)),!t)throw new Error("Content disposition undefined.");if(!r)throw new Error("Content type undefined.");return{contentDisposition:t,contentType:r,content:s}}},t.isBody=i,t.toBodyObj=function(e){return{body:e.content,contentType:e.contentType}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8),i=r(5);t.constructOutgoingResponse=function(e,t){var r="\r\n",o=i.Utils.buildStatusLine(t.statusCode,t.reasonPhrase);t.statusCode>=100&&t.statusCode,t.statusCode;var s="From: "+e.getHeader("From")+r,a="Call-ID: "+e.callId+r,c="CSeq: "+e.cseq+" "+e.method+r,u=e.getHeaders("via").reduce(function(e,t){return e+"Via: "+t+r},""),d="To: "+e.getHeader("to");if(t.statusCode>100&&!e.parseHeader("to").hasParam("tag")){var h=t.toTag;h||(h=i.Utils.newTag()),d+=";tag="+h}d+=r;var p=n.getSupportedHeader(e),l="";t.userAgent&&(l="User-Agent: "+t.userAgent+r);var f="";return t.extraHeaders&&(f=t.extraHeaders.reduce(function(e,t){return e+t.trim()+r},"")),o+=u,o+=s,o+=d,o+=c,o+=a,o+=p,o+=l,o+=f,t.body?(o+="Content-Type: "+t.body.contentType+r,o+="Content-Length: "+i.Utils.str_utf8_length(t.body.content)+r+r,o+=t.body.content):o+="Content-Length: 0\r\n\r\n",{message:o}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Initial="Initial",e.Early="Early",e.AckWait="AckWait",e.Confirmed="Confirmed",e.Terminated="Terminated"}(t.SessionState||(t.SessionState={})),function(e){e.Initial="Initial",e.HaveLocalOffer="HaveLocalOffer",e.HaveRemoteOffer="HaveRemoteOffer",e.Stable="Stable",e.Closed="Closed"}(t.SignalingState||(t.SignalingState={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),s=r(2),a=r(14),c=r(3),u=r(7),d=r(5),h=function(e){function t(t,r,n){void 0===n&&(n={});var i=e.call(this)||this;if(i.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},i.type=c.TypeStrings.DTMF,void 0===r)throw new TypeError("Not enough arguments");if(i.logger=t.ua.getLogger("sip.invitecontext.dtmf",t.id),i.owner=t,"string"==typeof r)r=r.toUpperCase();else{if("number"!=typeof r)throw new TypeError("Invalid tone: "+r);r=r.toString()}if(!r.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+r);i.tone=r;var o=n.duration,s=n.interToneGap;if(o&&!d.Utils.isDecimal(o))throw new TypeError("Invalid tone duration: "+o);if(o?o<i.C.MIN_DURATION?(i.logger.warn("'duration' value is lower than the minimum allowed, setting it to "+i.C.MIN_DURATION+" milliseconds"),o=i.C.MIN_DURATION):o>i.C.MAX_DURATION?(i.logger.warn("'duration' value is greater than the maximum allowed, setting it to "+i.C.MAX_DURATION+" milliseconds"),o=i.C.MAX_DURATION):o=Math.abs(o):o=i.C.DEFAULT_DURATION,i.duration=o,s&&!d.Utils.isDecimal(s))throw new TypeError("Invalid interToneGap: "+s);return s?s<i.C.MIN_INTER_TONE_GAP?(i.logger.warn("'interToneGap' value is lower than the minimum allowed, setting it to "+i.C.MIN_INTER_TONE_GAP+" milliseconds"),s=i.C.MIN_INTER_TONE_GAP):s=Math.abs(s):s=i.C.DEFAULT_INTER_TONE_GAP,i.interToneGap=s,i}return i(t,e),t.prototype.send=function(e){if(void 0===e&&(e={}),this.owner.status!==c.SessionStatus.STATUS_CONFIRMED&&this.owner.status!==c.SessionStatus.STATUS_WAITING_FOR_ACK)throw new u.Exceptions.InvalidStateError(this.owner.status);var t=e.extraHeaders?e.extraHeaders.slice():[],r={contentType:"application/dtmf-relay",body:"Signal= "+this.tone+"\r\nDuration= "+this.duration};if(this.owner.session){var n=this.owner.session.info(void 0,{extraHeaders:t,body:a.fromBodyObj(r)});this.owner.emit("dtmf",n.message,this)}else;},t.prototype.init_incoming=function(e){e.accept(),this.tone&&this.duration?this.owner.emit("dtmf",e.message,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;switch(!0){case/^1[0-9]{2}$/.test(t.toString()):break;case/^2[0-9]{2}$/.test(t.toString()):this.emit("succeeded",{originator:"remote",response:e});break;default:var r=d.Utils.sipErrorCause(t);this.emit("failed",e,r)}},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(e){this.emit("failed",e,s.C.causes.DIALOG_ERROR),this.owner.onDialogError(e)},t}(o.EventEmitter);t.DTMF=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Initial="Initial",e.NotifyWait="NotifyWait",e.Pending="Pending",e.Active="Active",e.Terminated="Terminated"}(t.SubscriptionState||(t.SubscriptionState={}))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(99)),n(r(113))},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=r(14),s=r(1),a=r(100),c=r(23),u=["application/sdp","application/dtmf-relay"],d=function(){function e(e,t){void 0===t&&(t={}),this.userAgentClients=new Map,this.userAgentServers=new Map,this.configuration=e,this.delegate=t,this.dialogs=new Map,this.subscribers=new Map,this.logger=e.loggerFactory.getLogger("sip.user-agent-core")}return e.prototype.dispose=function(){this.dialogs.forEach(function(e){return e.dispose()}),this.dialogs.clear(),this.subscribers.forEach(function(e){return e.dispose()}),this.subscribers.clear(),this.userAgentClients.forEach(function(e){return e.dispose()}),this.userAgentClients.clear(),this.userAgentServers.forEach(function(e){return e.dispose()}),this.userAgentServers.clear()},Object.defineProperty(e.prototype,"loggerFactory",{get:function(){return this.configuration.loggerFactory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transport",{get:function(){var e=this.configuration.transportAccessor();if(!e)throw new Error("Transport undefined.");return e},enumerable:!0,configurable:!0}),e.prototype.invite=function(e,t){return new a.InviteUserAgentClient(this,e,t)},e.prototype.message=function(e,t){return new a.MessageUserAgentClient(this,e,t)},e.prototype.publish=function(e,t){return new a.PublishUserAgentClient(this,e,t)},e.prototype.register=function(e,t){return new a.RegisterUserAgentClient(this,e,t)},e.prototype.subscribe=function(e,t){return new a.SubscribeUserAgentClient(this,e,t)},e.prototype.request=function(e,t){return new a.UserAgentClient(s.NonInviteClientTransaction,this,e,t)},e.prototype.receiveIncomingRequestFromTransport=function(e){this.receiveRequestFromTransport(e)},e.prototype.receiveIncomingResponseFromTransport=function(e){this.receiveResponseFromTransport(e)},e.prototype.replyStateless=function(e,t){var r=this.configuration.userAgentHeaderFieldValue;t=n({},t,{userAgent:r});var i=o.constructOutgoingResponse(e,t);return this.transport.send(i.message),i},e.prototype.receiveRequestFromTransport=function(e){var t=e.viaBranch,r=this.userAgentServers.get(t);e.method===i.C.ACK&&r&&r.transaction.state===s.TransactionState.Accepted&&r instanceof a.InviteUserAgentServer?this.logger.warn("Discarding out of dialog ACK after 2xx response sent on transaction "+t+"."):e.method!==i.C.CANCEL?r?r.transaction.receiveRequest(e):this.receiveRequest(e):r?(this.replyStateless(e,{statusCode:200}),r.transaction instanceof s.InviteServerTransaction&&r.transaction.state===s.TransactionState.Proceeding&&r instanceof a.InviteUserAgentServer&&r.receiveCancel(e)):this.replyStateless(e,{statusCode:481})},e.prototype.receiveRequest=function(e){if(c.AllowedMethods.includes(e.method)){if(!e.ruri)throw new Error("Request-URI undefined.");if(e.ruri.scheme===i.C.SIP){var t=e.ruri,r=function(e){return!!e&&e.user===t.user};if(!r(this.configuration.aor)&&!(r(this.configuration.contact.uri)||r(this.configuration.contact.pubGruu)||r(this.configuration.contact.tempGruu)))return this.logger.warn("Request-URI does not point to us."),void(e.method!==i.C.ACK&&this.replyStateless(e,{statusCode:404}));if(e.method!==i.C.INVITE||e.hasHeader("Contact")){if(!e.toTag){var n=e.viaBranch;if(!this.userAgentServers.has(n))if(Array.from(this.userAgentServers.values()).some(function(t){return t.transaction.request.fromTag===e.fromTag&&t.transaction.request.callId===e.callId&&t.transaction.request.cseq===e.cseq}))return void this.replyStateless(e,{statusCode:482})}e.toTag?this.receiveInsideDialogRequest(e):this.receiveOutsideDialogRequest(e)}else this.replyStateless(e,{statusCode:400,reasonPhrase:"Missing Contact Header"})}else this.replyStateless(e,{statusCode:416})}else{var o="Allow: "+c.AllowedMethods.toString();this.replyStateless(e,{statusCode:405,extraHeaders:[o]})}},e.prototype.receiveInsideDialogRequest=function(e){if(e.method===i.C.NOTIFY){var t=e.parseHeader("Event");if(!t||!t.event)return void this.replyStateless(e,{statusCode:489});var r=e.callId+e.toTag+t.event,n=this.subscribers.get(r);if(n){var o=new a.NotifyUserAgentServer(this,e);return void n.onNotify(o)}}var s=e.callId+e.toTag+e.fromTag,d=this.dialogs.get(s);if(d){if(e.method===i.C.OPTIONS){var h="Allow: "+c.AllowedMethods.toString(),p="Accept: "+u.toString();return void this.replyStateless(e,{statusCode:200,extraHeaders:[h,p]})}d.receiveRequest(e)}else e.method!==i.C.ACK&&this.replyStateless(e,{statusCode:481})},e.prototype.receiveOutsideDialogRequest=function(e){switch(e.method){case i.C.ACK:break;case i.C.BYE:this.replyStateless(e,{statusCode:481});break;case i.C.CANCEL:throw new Error("Unexpected out of dialog request method "+e.method+".");case i.C.INFO:this.replyStateless(e,{statusCode:405});break;case i.C.INVITE:var t=new a.InviteUserAgentServer(this,e);this.delegate.onInvite?this.delegate.onInvite(t):t.reject();break;case i.C.MESSAGE:t=new a.MessageUserAgentServer(this,e);this.delegate.onMessage?this.delegate.onMessage(t):t.accept();break;case i.C.NOTIFY:t=new a.NotifyUserAgentServer(this,e);this.delegate.onNotify?this.delegate.onNotify(t):this.replyStateless(e,{statusCode:405});break;case i.C.OPTIONS:var r="Allow: "+c.AllowedMethods.toString(),n="Accept: "+u.toString();this.replyStateless(e,{statusCode:200,extraHeaders:[r,n]});break;case i.C.REFER:t=new a.ReferUserAgentServer(this,e);this.delegate.onRefer?this.delegate.onRefer(t):this.replyStateless(e,{statusCode:405});break;case i.C.SUBSCRIBE:t=new a.SubscribeUserAgentServer(this,e);this.delegate.onSubscribe?this.delegate.onSubscribe(t):t.reject();break;default:throw new Error("Unexpected out of dialog request method "+e.method+".")}},e.prototype.receiveResponseFromTransport=function(e){if(e.getHeaders("via").length>1)this.logger.warn("More than one Via header field present in the response, dropping");else{var t=e.viaBranch+e.method,r=this.userAgentClients.get(t);r?r.transaction.receiveResponse(e):this.logger.warn("Discarding unmatched "+e.statusCode+" response to "+e.method+" "+t+".")}},e}();t.UserAgentCore=d},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(49)),n(r(50)),n(r(101)),n(r(51)),n(r(102)),n(r(105)),n(r(106)),n(r(107)),n(r(53)),n(r(34)),n(r(108)),n(r(54)),n(r(55)),n(r(56)),n(r(57)),n(r(61)),n(r(109)),n(r(58)),n(r(59)),n(r(110)),n(r(111)),n(r(112)),n(r(6)),n(r(9))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){return e.call(this,o.NonInviteClientTransaction,t,r,n)||this}return i(t,e),t}(r(6).UserAgentClient);t.CancelUserAgentClient=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(52),s=r(1),a=function(e){function t(t,r,n){var i=e.call(this,s.InviteClientTransaction,t,r,n)||this;return i.confirmedDialogAcks=new Map,i.confirmedDialogs=new Map,i.earlyDialogs=new Map,i.delegate=n,i}return i(t,e),t.prototype.dispose=function(){this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),e.prototype.dispose.call(this)},t.prototype.receiveResponse=function(e){var t=this;if(this.authenticationGuard(e)){var r=e.statusCode?e.statusCode.toString():"";if(!r)throw new Error("Response status code undefined.");switch(!0){case/^100$/.test(r):return void(this.delegate&&this.delegate.onTrying&&this.delegate.onTrying({message:e}));case/^1[0-9]{2}$/.test(r):if(!e.toTag)return void this.logger.warn("Non-100 1xx INVITE response received without a to tag, dropping.");var n=o.Dialog.initialDialogStateForUserAgentClient(this.message,e),i=this.earlyDialogs.get(n.id);if(!i){if(!((u=this.transaction)instanceof s.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");i=new o.SessionDialog(u,this.core,n),this.earlyDialogs.set(i.id,i)}if(!i.reliableSequenceGuard(e))return void this.logger.warn("1xx INVITE reliable response received out of order, dropping.");i.signalingStateTransition(e);var a=i;return void(this.delegate&&this.delegate.onProgress&&this.delegate.onProgress({message:e,session:a,prack:function(e){return a.prack(void 0,e)}}));case/^2[0-9]{2}$/.test(r):n=o.Dialog.initialDialogStateForUserAgentClient(this.message,e);var c=this.confirmedDialogs.get(n.id);if(c){if(h=this.confirmedDialogAcks.get(n.id)){if(!((u=this.transaction)instanceof s.InviteClientTransaction))throw new Error("Client transaction not instance of InviteClientTransaction.");u.ackResponse(h.message)}return}if(c=this.earlyDialogs.get(n.id))c.confirm(),c.recomputeRouteSet(e),this.earlyDialogs.delete(c.id),this.confirmedDialogs.set(c.id,c);else{var u;if(!((u=this.transaction)instanceof s.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");c=new o.SessionDialog(u,this.core,n),this.confirmedDialogs.set(c.id,c)}c.signalingStateTransition(e);var d=c;if(this.delegate&&this.delegate.onAccept)this.delegate.onAccept({message:e,session:d,ack:function(e){var r=d.ack(e);return t.confirmedDialogAcks.set(d.id,r),r}});else{var h=d.ack();this.confirmedDialogAcks.set(d.id,h)}return;case/^3[0-9]{2}$/.test(r):return this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onRedirect&&this.delegate.onRedirect({message:e}));case/^[4-6][0-9]{2}$/.test(r):return this.earlyDialogs.forEach(function(e){return e.dispose()}),this.earlyDialogs.clear(),void(this.delegate&&this.delegate.onReject&&this.delegate.onReject({message:e}));default:throw new Error("Invalid status code "+r)}throw new Error("Executing what should be an unreachable code path receiving "+r+" response.")}},t}(r(6).UserAgentClient);t.InviteUserAgentClient=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(18),a=r(8),c=r(12),u=r(14),d=r(31),h=r(1),p=r(49),l=r(50),f=r(104),g=r(51),v=r(53),m=r(34),y=r(54),S=r(55),T=r(56),C=r(57),b=r(58),_=r(59),A=function(e){function t(t,r,n,i){var o=e.call(this,r,n)||this;return o.initialTransaction=t,o._signalingState=d.SignalingState.Initial,o.ackWait=!1,o.delegate=i,t instanceof h.InviteServerTransaction&&(o.ackWait=!0),o.early||o.start2xxRetransmissionTimer(),o.signalingStateTransition(t.request),o.logger=r.loggerFactory.getLogger("sip.invite-dialog"),o.logger.log("INVITE dialog "+o.id+" constructed"),o}return i(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._signalingState=d.SignalingState.Closed,this._offer=void 0,this._answer=void 0,this.invite2xxTimer&&(clearTimeout(this.invite2xxTimer),this.invite2xxTimer=void 0),this.logger.log("INVITE dialog "+this.id+" destroyed")},Object.defineProperty(t.prototype,"sessionState",{get:function(){return this.early?d.SessionState.Early:this.ackWait?d.SessionState.AckWait:this._signalingState===d.SignalingState.Closed?d.SessionState.Terminated:d.SessionState.Confirmed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return this._signalingState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offer",{get:function(){return this._offer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"answer",{get:function(){return this._answer},enumerable:!0,configurable:!0}),t.prototype.confirm=function(){this.early&&this.start2xxRetransmissionTimer(),e.prototype.confirm.call(this)},t.prototype.reConfirm=function(){this.reinviteUserAgentServer&&this.startReInvite2xxRetransmissionTimer()},t.prototype.ack=function(e){var t;if(void 0===e&&(e={}),this.logger.log("INVITE dialog "+this.id+" sending ACK request"),this.reinviteUserAgentClient){if(!(this.reinviteUserAgentClient.transaction instanceof h.InviteClientTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");t=this.reinviteUserAgentClient.transaction,this.reinviteUserAgentClient=void 0}else{if(!(this.initialTransaction instanceof h.InviteClientTransaction))throw new Error("Initial transaction not instance of InviteClientTransaction.");t=this.initialTransaction}e.cseq=t.request.cseq;var r=this.createOutgoingRequestMessage(o.C.ACK,e);return t.ackResponse(r),this.signalingStateTransition(r),{message:r}},t.prototype.bye=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending BYE request"),this.initialTransaction instanceof h.InviteServerTransaction){if(this.early)throw new Error("UAS MUST NOT send a BYE on early dialogs.");if(this.ackWait&&this.initialTransaction.state!==h.TransactionState.Terminated)throw new Error("UAS MUST NOT send a BYE on a confirmed dialog until it has received an ACK for its 2xx response or until the server transaction times out.")}return new p.ByeUserAgentClient(this,e,t)},t.prototype.info=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending INFO request"),this.early)throw new Error("Dialog not confirmed.");return new f.InfoUserAgentClient(this,e,t)},t.prototype.invite=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending INVITE request"),this.early)throw new Error("Dialog not confirmed.");if(this.reinviteUserAgentClient)throw new Error("There is an ongoing re-INVITE client transaction.");if(this.reinviteUserAgentServer)throw new Error("There is an ongoing re-INVITE server transaction.");return new T.ReInviteUserAgentClient(this,e,t)},t.prototype.notify=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending NOTIFY request"),this.early)throw new Error("Dialog not confirmed.");return new v.NotifyUserAgentClient(this,e,t)},t.prototype.prack=function(e,t){return this.logger.log("INVITE dialog "+this.id+" sending PRACK request"),new y.PrackUserAgentClient(this,e,t)},t.prototype.refer=function(e,t){if(this.logger.log("INVITE dialog "+this.id+" sending REFER request"),this.early)throw new Error("Dialog not confirmed.");return new b.ReferUserAgentClient(this,e,t)},t.prototype.receiveRequest=function(t){if(this.logger.log("INVITE dialog "+this.id+" received "+t.method+" request"),t.method===o.C.ACK){if(this.ackWait){if(this.initialTransaction instanceof h.InviteClientTransaction)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+t.method+" request, dropping.");if(this.initialTransaction.request.cseq!==t.cseq)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+t.method+" request, dropping.");this.ackWait=!1}else{if(!this.reinviteUserAgentServer)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+t.method+" request, dropping.");if(this.reinviteUserAgentServer.transaction.request.cseq!==t.cseq)return void this.logger.warn("INVITE dialog "+this.id+" received unexpected "+t.method+" request, dropping.");this.reinviteUserAgentServer=void 0}return this.signalingStateTransition(t),void(this.delegate&&this.delegate.onAck&&this.delegate.onAck({message:t}))}if(this.sequenceGuard(t)){if(t.method===o.C.INVITE){if(this.reinviteUserAgentServer){var r=["Retry-After: "+(Math.floor(10*Math.random())+1)];return void this.core.replyStateless(t,{statusCode:500,extraHeaders:r})}if(this.reinviteUserAgentClient)return void this.core.replyStateless(t,{statusCode:491})}if(e.prototype.receiveRequest.call(this,t),t.method===o.C.INVITE){var n=t.parseHeader("contact");if(!n)throw new Error("Contact undefined.");if(!(n instanceof s.NameAddrHeader))throw new Error("Contact not instance of NameAddrHeader.");this.dialogState.remoteTarget=n.uri}switch(t.method){case o.C.BYE:var i=new l.ByeUserAgentServer(this,t);this.delegate&&this.delegate.onBye?this.delegate.onBye(i):i.accept(),this.dispose();break;case o.C.INFO:i=new g.InfoUserAgentServer(this,t);this.delegate&&this.delegate.onInfo?this.delegate.onInfo(i):i.reject({statusCode:469,extraHeaders:["Recv-Info :"]});break;case o.C.INVITE:i=new C.ReInviteUserAgentServer(this,t);this.delegate&&this.delegate.onInvite?this.delegate.onInvite(i):i.reject({statusCode:488});break;case o.C.NOTIFY:i=new m.NotifyUserAgentServer(this,t);this.delegate&&this.delegate.onNotify?this.delegate.onNotify(i):i.accept();break;case o.C.PRACK:i=new S.PrackUserAgentServer(this,t);this.delegate&&this.delegate.onPrack?this.delegate.onPrack(i):i.accept();break;case o.C.REFER:i=new _.ReferUserAgentServer(this,t);this.delegate&&this.delegate.onRefer?this.delegate.onRefer(i):i.reject();break;default:this.logger.log("INVITE dialog "+this.id+" received unimplemented "+t.method+" request"),this.core.replyStateless(t,{statusCode:501})}}else this.logger.log("INVITE dialog "+this.id+" rejected out of order "+t.method+" request.")},t.prototype.reliableSequenceGuard=function(e){var t=e.statusCode;if(!t)throw new Error("Status code undefined");if(t>100&&t<200){var r=e.getHeader("require"),n=e.getHeader("rseq"),i=r&&r.includes("100rel")&&n?Number(n):void 0;if(i){if(this.rseq&&this.rseq+1!==i)return!1;this.rseq||(this.rseq=i)}}return!0},t.prototype.signalingStateTransition=function(e){var t=u.getBody(e);if(t&&"session"===t.contentDisposition){if(e instanceof a.IncomingRequest)switch(this._signalingState){case d.SignalingState.Initial:case d.SignalingState.Stable:this._signalingState=d.SignalingState.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case d.SignalingState.HaveLocalOffer:this._signalingState=d.SignalingState.Stable,this._answer=t;break;case d.SignalingState.HaveRemoteOffer:case d.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof a.IncomingResponse)switch(this._signalingState){case d.SignalingState.Initial:case d.SignalingState.Stable:this._signalingState=d.SignalingState.HaveRemoteOffer,this._offer=t,this._answer=void 0;break;case d.SignalingState.HaveLocalOffer:this._signalingState=d.SignalingState.Stable,this._answer=t;break;case d.SignalingState.HaveRemoteOffer:case d.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(e instanceof a.OutgoingRequest)switch(this._signalingState){case d.SignalingState.Initial:case d.SignalingState.Stable:this._signalingState=d.SignalingState.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case d.SignalingState.HaveLocalOffer:break;case d.SignalingState.HaveRemoteOffer:this._signalingState=d.SignalingState.Stable,this._answer=t;break;case d.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}if(u.isBody(e))switch(this._signalingState){case d.SignalingState.Initial:case d.SignalingState.Stable:this._signalingState=d.SignalingState.HaveLocalOffer,this._offer=t,this._answer=void 0;break;case d.SignalingState.HaveLocalOffer:break;case d.SignalingState.HaveRemoteOffer:this._signalingState=d.SignalingState.Stable,this._answer=t;break;case d.SignalingState.Closed:break;default:throw new Error("Unexpected signaling state.")}}},t.prototype.start2xxRetransmissionTimer=function(){var e=this;if(this.initialTransaction instanceof h.InviteServerTransaction){var t=this.initialTransaction,r=c.Timers.T1,n=function(){e.ackWait?(e.logger.log("No ACK for 2xx response received, attempting retransmission"),t.retransmitAcceptedResponse(),r=Math.min(2*r,c.Timers.T2),e.invite2xxTimer=setTimeout(n,r)):e.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(n,r);var i=function(){t.state===h.TransactionState.Terminated&&(t.removeListener("stateChanged",i),e.invite2xxTimer&&(clearTimeout(e.invite2xxTimer),e.invite2xxTimer=void 0),e.ackWait&&(e.delegate&&e.delegate.onAckTimeout?e.delegate.onAckTimeout():e.bye()))};t.addListener("stateChanged",i)}},t.prototype.startReInvite2xxRetransmissionTimer=function(){var e=this;if(this.reinviteUserAgentServer&&this.reinviteUserAgentServer.transaction instanceof h.InviteServerTransaction){var t=this.reinviteUserAgentServer.transaction,r=c.Timers.T1,n=function(){e.reinviteUserAgentServer?(e.logger.log("No ACK for 2xx response received, attempting retransmission"),t.retransmitAcceptedResponse(),r=Math.min(2*r,c.Timers.T2),e.invite2xxTimer=setTimeout(n,r)):e.invite2xxTimer=void 0};this.invite2xxTimer=setTimeout(n,r);var i=function(){t.state===h.TransactionState.Terminated&&(t.removeListener("stateChanged",i),e.invite2xxTimer&&(clearTimeout(e.invite2xxTimer),e.invite2xxTimer=void 0),e.reinviteUserAgentServer)};t.addListener("stateChanged",i)}},t}(r(33).Dialog);t.SessionDialog=A},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(1),a=function(e){function t(t,r,n){var i=t.createOutgoingRequestMessage(o.C.INFO,n);return e.call(this,s.NonInviteClientTransaction,t.userAgentCore,i,r)||this}return i(t,e),t}(r(6).UserAgentClient);t.InfoUserAgentClient=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=r(7),a=r(52),c=r(31),u=r(1),d=r(23),h=function(e){function t(t,r,n){var i=e.call(this,u.InviteServerTransaction,t,r,n)||this;return i.core=t,i}return i(t,e),t.prototype.dispose=function(){this.earlyDialog&&this.earlyDialog.dispose(),e.prototype.dispose.call(this)},t.prototype.accept=function(t){if(void 0===t&&(t={statusCode:200}),!this.acceptable)throw new s.Exceptions.TransactionStateError(this.message.method+" not acceptable in state "+this.transaction.state+".");if(!this.confirmedDialog)if(this.earlyDialog)this.earlyDialog.confirm(),this.confirmedDialog=this.earlyDialog,this.earlyDialog=void 0;else{var r=this.transaction;if(!(r instanceof u.InviteServerTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");var n=a.Dialog.initialDialogStateForUserAgentServer(this.message,this.toTag);this.confirmedDialog=new a.SessionDialog(r,this.core,n)}var i=this.message.getHeaders("record-route").map(function(e){return"Record-Route: "+e}),h="Contact: "+this.core.configuration.contact.toString(),p="Allow: "+d.AllowedMethods.toString();if(!t.body&&(this.confirmedDialog.signalingState===c.SignalingState.Initial||this.confirmedDialog.signalingState===c.SignalingState.HaveRemoteOffer))throw new Error("Response must have a body.");t.statusCode=t.statusCode||200,t.extraHeaders=t.extraHeaders||[],t.extraHeaders=t.extraHeaders.concat(i),t.extraHeaders.push(p),t.extraHeaders.push(h);var l=e.prototype.accept.call(this,t),f=this.confirmedDialog,g=o({},l,{session:f});return t.body&&this.confirmedDialog.signalingStateTransition(t.body),g},t.prototype.progress=function(t){if(void 0===t&&(t={statusCode:180}),!this.progressable)throw new s.Exceptions.TransactionStateError(this.message.method+" not progressable in state "+this.transaction.state+".");if(!this.earlyDialog){var r=this.transaction;if(!(r instanceof u.InviteServerTransaction))throw new Error("Transaction not instance of InviteClientTransaction.");var n=a.Dialog.initialDialogStateForUserAgentServer(this.message,this.toTag,!0);this.earlyDialog=new a.SessionDialog(r,this.core,n)}var i=this.message.getHeaders("record-route").map(function(e){return"Record-Route: "+e}),c="Contact: "+this.core.configuration.contact;t.extraHeaders=t.extraHeaders||[],t.extraHeaders=t.extraHeaders.concat(i),t.extraHeaders.push(c);var d=e.prototype.progress.call(this,t),h=this.earlyDialog,p=o({},d,{session:h});return t.body&&this.earlyDialog.signalingStateTransition(t.body),p},t.prototype.redirect=function(t,r){return void 0===r&&(r={statusCode:302}),e.prototype.redirect.call(this,t,r)},t.prototype.reject=function(t){return void 0===t&&(t={statusCode:486}),e.prototype.reject.call(this,t)},t}(r(9).UserAgentServer);t.InviteUserAgentServer=h},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){return e.call(this,o.NonInviteClientTransaction,t,r,n)||this}return i(t,e),t}(r(6).UserAgentClient);t.MessageUserAgentClient=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){var i=e.call(this,o.NonInviteServerTransaction,t,r,n)||this;return i.core=t,i}return i(t,e),t}(r(9).UserAgentServer);t.MessageUserAgentServer=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){return e.call(this,o.NonInviteClientTransaction,t,r,n)||this}return i(t,e),t}(r(6).UserAgentClient);t.PublishUserAgentClient=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){return e.call(this,o.NonInviteServerTransaction,t.userAgentCore,r,n)||this}return i(t,e),t}(r(9).UserAgentServer);t.ReSubscribeUserAgentServer=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){return e.call(this,o.NonInviteClientTransaction,t,r,n)||this}return i(t,e),t}(r(6).UserAgentClient);t.RegisterUserAgentClient=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(12),s=r(60),a=r(32),c=r(1),u=function(e){function t(t,r,n){var i=this,o=r.getHeader("Event");if(!o)throw new Error("Event undefined");var s=r.getHeader("Expires");if(!s)throw new Error("Expires undefined");return(i=e.call(this,c.NonInviteClientTransaction,t,r,n)||this).delegate=n,i.subscriberId=r.callId+r.fromTag+o,i.subscriptionExpiresRequested=i.subscriptionExpires=Number(s),i.subscriptionEvent=o,i.subscriptionState=a.SubscriptionState.NotifyWait,i.waitNotifyStart(),i}return i(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.prototype.onNotify=function(e){var t=e.message.parseHeader("Event").event;if(!t||t!==this.subscriptionEvent)return this.logger.warn("Failed to parse event."),void e.reject({statusCode:489});var r=e.message.parseHeader("Subscription-State");if(!r||!r.state)return this.logger.warn("Failed to parse subscription state."),void e.reject({statusCode:489});var n=r.state;switch(n){case"pending":case"active":case"terminated":break;default:return this.logger.warn("Invalid subscription state "+n),void e.reject({statusCode:489})}if("terminated"!==n&&!e.message.parseHeader("contact"))return this.logger.warn("Failed to parse contact."),void e.reject({statusCode:489});if(this.dialog)throw new Error("Dialog already created. This implementation only supports install of single subscriptions.");switch(this.waitNotifyStop(),this.subscriptionExpires=r.expires?Math.min(this.subscriptionExpires,Math.max(r.expires,0)):this.subscriptionExpires,n){case"pending":this.subscriptionState=a.SubscriptionState.Pending;break;case"active":this.subscriptionState=a.SubscriptionState.Active;break;case"terminated":this.subscriptionState=a.SubscriptionState.Terminated;break;default:throw new Error("Unrecognized state "+n+".")}if(this.subscriptionState!==a.SubscriptionState.Terminated){var i=s.SubscriptionDialog.initialDialogStateForSubscription(this.message,e.message);this.dialog=new s.SubscriptionDialog(this.subscriptionEvent,this.subscriptionExpires,this.subscriptionState,this.core,i)}if(this.delegate&&this.delegate.onNotify){var o=e,c=this.dialog;this.delegate.onNotify({request:o,subscription:c})}else e.accept()},t.prototype.waitNotifyStart=function(){var e=this;this.N||(this.core.subscribers.set(this.subscriberId,this),this.N=setTimeout(function(){return e.timer_N()},o.Timers.TIMER_N))},t.prototype.waitNotifyStop=function(){this.N&&(this.core.subscribers.delete(this.subscriberId),clearTimeout(this.N),this.N=void 0)},t.prototype.receiveResponse=function(t){if(this.authenticationGuard(t)){if(t.statusCode&&t.statusCode>=200&&t.statusCode<300){var r=t.getHeader("Expires");if(r){var n=Number(r);n>this.subscriptionExpiresRequested&&this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),n<this.subscriptionExpires&&(this.subscriptionExpires=n)}else this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE");this.dialog&&this.dialog.subscriptionExpires>this.subscriptionExpires&&(this.dialog.subscriptionExpires=this.subscriptionExpires)}t.statusCode&&t.statusCode>=300&&t.statusCode<700&&this.waitNotifyStop(),e.prototype.receiveResponse.call(this,t)}},t.prototype.timer_N=function(){this.logger.warn("Timer N expired for SUBSCRIBE user agent client. Timed out waiting for NOTIFY."),this.waitNotifyStop(),this.delegate&&this.delegate.onNotifyTimeout&&this.delegate.onNotifyTimeout()},t}(r(6).UserAgentClient);t.SubscribeUserAgentClient=u},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),s=function(e){function t(t,r,n){var i=e.call(this,o.NonInviteServerTransaction,t,r,n)||this;return i.core=t,i}return i(t,e),t}(r(9).UserAgentServer);t.SubscribeUserAgentServer=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8),i=r(19);t.makeUserAgentCoreConfigurationFromUA=function(e){if(!(e.configuration.uri instanceof i.URI))throw new Error("Configuration URI not instance of URI.");return{aor:e.configuration.uri,contact:e.contact,loggerFactory:e.getLoggerFactory(),userAgentHeaderFieldValue:e.configuration.userAgentString,authenticationFactory:function(){if(e.configuration.authenticationFactory)return e.configuration.authenticationFactory(e)},onRequestTimeoutResponseMessageFactory:function(){var t=new n.IncomingResponse(e);return t.statusCode=408,t.reasonPhrase="Request Timeout",t},onTransportErrorResponseMessageFactory:function(){var t=new n.IncomingResponse(e);return t.statusCode=503,t.reasonPhrase="Service Unavailable",t},outgoingRequestMessageFactory:function(t,r,i,o,s){return new n.OutgoingRequest(t,r,e,i,o,s)},transportAccessor:function(){return e.transport}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),i=function(){function e(e,t){this.type=n.TypeStrings.SessionDescriptionHandlerObserver,this.session=e,this.options=t}return e.prototype.trackAdded=function(){this.session.emit("trackAdded")},e.prototype.directionChanged=function(){this.session.emit("directionChanged")},e}();t.SessionDescriptionHandlerObserver=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(35);t.Modifiers=n;var i=r(116);t.Simple=i.Simple;var o=r(62);t.SessionDescriptionHandler=o.SessionDescriptionHandler;var s=r(63);t.Transport=s.Transport},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(10),a=r(48),c=r(35);!function(e){e[e.STATUS_NULL=0]="STATUS_NULL",e[e.STATUS_NEW=1]="STATUS_NEW",e[e.STATUS_CONNECTING=2]="STATUS_CONNECTING",e[e.STATUS_CONNECTED=3]="STATUS_CONNECTED",e[e.STATUS_COMPLETED=4]="STATUS_COMPLETED"}(o=t.SimpleStatus||(t.SimpleStatus={}));var u=function(t){function r(r){var n=t.call(this)||this;if(r.media.remote.video?n.video=!0:n.video=!1,r.media.remote.audio?n.audio=!0:n.audio=!1,!n.audio&&!n.video)throw new Error("At least one remote audio or video element is required for Simple.");n.options=r;var i=e.navigator.userAgent.toLowerCase(),s=!1,u=!1;i.indexOf("safari")>-1&&i.indexOf("chrome")<0?s=!0:i.indexOf("firefox")>-1&&i.indexOf("chrome")<0&&(u=!0);var d={};return s&&(d.modifiers=[c.stripG722]),u&&(d.alwaysAcquireMediaFirst=!0),n.options.ua.uri?n.anonymous=!1:n.anonymous=!0,n.ua=new a.UA({uri:n.options.ua.uri,authorizationUser:n.options.ua.authorizationUser,password:n.options.ua.password,displayName:n.options.ua.displayName,userAgentString:n.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:d,transportOptions:{traceSip:n.options.ua.traceSip,wsServers:n.options.ua.wsServers}}),n.state=o.STATUS_NULL,n.logger=n.ua.getLogger("sip.simple"),n.ua.on("registered",function(){n.emit("registered",n.ua)}),n.ua.on("unregistered",function(){n.emit("unregistered",n.ua)}),n.ua.on("registrationFailed",function(){n.emit("unregistered",n.ua)}),n.ua.on("invite",function(e){if(n.state!==o.STATUS_NULL&&n.state!==o.STATUS_COMPLETED)return n.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();n.session=e,n.setupSession(),n.emit("ringing",n.session)}),n.ua.on("message",function(e){n.emit("message",e)}),n}return i(r,t),r.prototype.call=function(e){if(this.ua&&this.checkRegistration()){if(this.state===o.STATUS_NULL||this.state===o.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},r.prototype.answer=function(){if(this.state===o.STATUS_NEW||this.state===o.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},r.prototype.reject=function(){if(this.state===o.STATUS_NEW||this.state===o.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},r.prototype.hangup=function(){if(this.state===o.STATUS_CONNECTED||this.state===o.STATUS_CONNECTING||this.state===o.STATUS_NEW)return this.state!==o.STATUS_CONNECTED?this.session.cancel():this.session?this.session.bye():void 0;this.logger.warn("No active call to hang up on")},r.prototype.hold=function(){if(this.state===o.STATUS_CONNECTED&&this.session&&!this.session.localHold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},r.prototype.unhold=function(){if(this.state===o.STATUS_CONNECTED&&this.session&&this.session.localHold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},r.prototype.mute=function(){this.state===o.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},r.prototype.unmute=function(){this.state===o.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},r.prototype.sendDTMF=function(e){this.state===o.STATUS_CONNECTED&&this.session?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},r.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},r.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},r.prototype.setupRemoteMedia=function(){var t=this;if(this.session){var r,n=this.session.sessionDescriptionHandler.peerConnection;n.getReceivers?(r=new e.window.MediaStream,n.getReceivers().forEach(function(e){var t=e.track;t&&r.addTrack(t)})):r=n.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=r,this.options.media.remote.video.play().catch(function(){t.logger.log("play was rejected")})):this.audio&&(this.options.media.remote.audio.srcObject=r,this.options.media.remote.audio.play().catch(function(){t.logger.log("play was rejected")}))}else this.logger.warn("No session to set remote media on")},r.prototype.setupLocalMedia=function(){if(this.session){if(this.video&&this.options.media.local&&this.options.media.local.video){var t,r=this.session.sessionDescriptionHandler.peerConnection;r.getSenders?(t=new e.window.MediaStream,r.getSenders().forEach(function(e){var r=e.track;r&&"video"===r.kind&&t.addTrack(r)})):t=r.getLocalStreams()[0],this.options.media.local.video.srcObject=t,this.options.media.local.video.volume=0,this.options.media.local.video.play()}}else this.logger.warn("No session to set local media on")},r.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},r.prototype.setupSession=function(){var e=this;this.session?(this.state=o.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",function(){return e.onProgress()}),this.session.on("accepted",function(){return e.onAccepted()}),this.session.on("rejected",function(){return e.onEnded()}),this.session.on("failed",function(){return e.onFailed()}),this.session.on("terminated",function(){return e.onEnded()})):this.logger.warn("No session to set up")},r.prototype.destroyMedia=function(){this.session&&this.session.sessionDescriptionHandler&&this.session.sessionDescriptionHandler.close()},r.prototype.toggleMute=function(e){if(this.session){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach(function(t){t.track&&(t.track.enabled=!e)}):t.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(t){t.enabled=!e}),t.getVideoTracks().forEach(function(t){t.enabled=!e})})}else this.logger.warn("No session to toggle mute")},r.prototype.onAccepted=function(){var e=this;this.session?(this.state=o.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler&&(this.session.sessionDescriptionHandler.on("addTrack",function(){e.logger.log("A track has been added, triggering new remoteMedia setup"),e.setupRemoteMedia()}),this.session.sessionDescriptionHandler.on("addStream",function(){e.logger.log("A stream has been added, trigger new remoteMedia setup"),e.setupRemoteMedia()})),this.session.on("dtmf",function(t,r){e.emit("dtmf",r.tone)}),this.session.on("bye",function(){return e.onEnded()})):this.logger.warn("No session for accepting")},r.prototype.onProgress=function(){this.state=o.STATUS_CONNECTING,this.emit("connecting",this.session)},r.prototype.onFailed=function(){this.onEnded()},r.prototype.onEnded=function(){this.state=o.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},r.C=o,r}(s.EventEmitter);t.Simple=u}).call(this,r(24))}])});